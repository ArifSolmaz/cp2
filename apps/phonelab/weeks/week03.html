<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week 03 â€” PhoneLab</title>
  <link rel="stylesheet" href="../assets/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">Week 03 â€” Human Sensor Calibration</div>
      <div class="brand-sub"><a href="../index.html">â† Back to PhoneLab Hub</a></div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h1 style="margin:0 0 4px;">ğŸ¯ Human Sensor Calibration</h1>
      <p class="muted" style="margin:0 0 12px;">
        How precise is <em>your internal clock</em>?
        Try to stop a stopwatch at exactly <b>5.000 seconds</b> â€” ten times â€”
        then analyze your precision, accuracy, and learning curve.
      </p>

      <div class="concepts-box">
        <b>ğŸ“š Concepts you'll practice (from Week 03):</b>
        <span class="concept-tag">for loop</span>
        <span class="concept-tag">range()</span>
        <span class="concept-tag">accumulator pattern</span>
        <span class="concept-tag">break / continue</span>
        <span class="concept-tag">manual min/max</span>
      </div>

      <!-- Step indicator -->
      <div class="steps" style="margin-top:14px;">
        <div class="step-pill active" data-step="1">â‘  Identity</div>
        <div class="step-pill" data-step="2">â‘¡ Data</div>
        <div class="step-pill" data-step="3">â‘¢ Code</div>
        <div class="step-pill" data-step="4">â‘£ Run & Submit</div>
      </div>

      <details open id="sec1">
        <summary><b>1) Identity</b> <span class="muted">(required)</span></summary>
        <div class="row">
          <div>
            <label>Student ID (6â€“12 digits)</label>
            <input id="studentId" inputmode="numeric" minlength="6" maxlength="12"
                   pattern="^\d{6,12}$" required placeholder="e.g., 202612345" />
          </div>
          <div>
            <label>Name Surname</label>
            <input id="nameSurname" required placeholder="e.g., Arif Solmaz" />
          </div>
        </div>
        <label>Email (@istun.edu.tr)</label>
        <input id="email" type="email"
               pattern="^[A-Za-z0-9._%+-]+@istun\.edu\.tr$"
               required placeholder="name@istun.edu.tr" />
        <small class="hint">Draft auto-saves on this device.</small>
      </details>

      <hr />

      <details open id="sec2">
        <summary><b>2) Collect your data</b> <span class="muted">(from your phone)</span></summary>

        <div class="scenario-box">
          <b>ğŸ”¬ What to do:</b>
          <ol class="muted" style="margin:6px 0 0; padding-left:20px;">
            <li>Open the <b>stopwatch</b> on your phone (built-in Clock app).</li>
            <li>Your goal: start the stopwatch, then stop it at <b>exactly 5.000 seconds</b>.</li>
            <li>Don't look at the screen while counting! Close your eyes or look away, count to 5 in your head, then tap stop.</li>
            <li>Record the <b>exact time shown</b> (e.g., 4.87, 5.23, 5.01).</li>
            <li>Repeat <b>10 times</b>. Enter all 10 readings below, separated by commas.</li>
          </ol>
          <small>ğŸ’¡ <b>Challenge:</b> Can you get within Â±0.10s? Under Â±0.05s makes you a "precision instrument"!</small>
        </div>

        <label>Your 10 readings (comma-separated, in seconds)</label>
        <textarea id="dataBox" spellcheck="false"></textarea>
        <small class="hint">âš ï¸ These must be <b>your own</b> attempts. Default values will be rejected.</small>
      </details>

      <hr />

      <details id="sec3">
        <summary><b>3) Python code</b> <span class="muted">(fill in the TODOs)</span></summary>
        <label>Python â€” analyze your calibration data with loops</label>
        <textarea id="codeBox" class="codebox" spellcheck="false"></textarea>
        <small class="hint">
          Use <b>for loops</b> and <b>accumulators</b> â€” do NOT use built-in
          <code>sum()</code>, <code>min()</code>, or <code>max()</code>.
        </small>
      </details>

      <hr />

      <details id="sec4">
        <summary><b>4) Output</b> <span class="muted">(auto-captured after Run)</span></summary>
        <pre id="output" class="out">Click "â–¶ Run Python" to see output here.</pre>
      </details>

      <div class="stickybar">
        <div class="bar-actions">
          <button id="helpBtn" class="helpbtn" type="button">?</button>
          <button id="runBtn" type="button">â–¶ Run Python</button>
          <button id="submitBtn" class="primary" type="button">Submit âœ“</button>
        </div>
        <small id="status" class="hint"></small>
      </div>
    </section>
  </main>

  <!-- Help Modal -->
  <div id="helpModal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>ğŸ¯ Week 03 â€” Instructions</h3>
      <ol class="muted">
        <li><b>Identity:</b> Student ID (6â€“12 digits), Name Surname, <b>@istun.edu.tr</b> email.</li>
        <li><b>Measure:</b> Open your phone's stopwatch. Try to stop it at exactly 5.000 seconds â€” 10 times. Don't peek while counting!</li>
        <li><b>Enter data:</b> Type all 10 readings separated by commas (e.g., 4.87, 5.23, 5.01, ...).</li>
        <li><b>Write code:</b> Complete the TODO lines â€” use <b>for loops</b> and <b>accumulators</b> to analyze your data.</li>
        <li><b>Run:</b> Tap "â–¶ Run Python" and check the calibration report.</li>
        <li><b>Submit:</b> One submission only. Confirmation opens in a new tab.</li>
      </ol>
      <p class="muted" style="margin-top:10px;">
        <b>ğŸ“ The engineering:</b> In mechatronics, every sensor must be <em>calibrated</em> â€”
        you check how close (accuracy) and how consistent (precision) its readings are
        compared to a known reference. Here, YOU are the sensor and 5.000s is the reference.
        This is exactly how engineers validate instruments in real labs!
      </p>
      <div class="modal-actions">
        <button id="closeHelpBtn" type="button">Got it</button>
      </div>
    </div>
  </div>

  <script src="../assets/app.js"></script>
  <script>
    const WEEK = "week03";
    const DEADLINE = new Date("2026-03-04T23:59:00+03:00");

    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxu_JAL7pMXz_7bSGC7kIYvs76UGJji8ubbmr6h7rnLY-M2deKSubTxTiekeKecMclC/exec";

    const studentIdEl   = document.getElementById("studentId");
    const nameSurnameEl = document.getElementById("nameSurname");
    const emailEl       = document.getElementById("email");
    const dataEl        = document.getElementById("dataBox");
    const codeEl        = document.getElementById("codeBox");
    const outEl         = document.getElementById("output");
    const statusEl      = document.getElementById("status");

    // â”€â”€ Default data â”€â”€
    const defaultData =
`5.23, 4.87, 5.14, 4.95, 5.08, 5.31, 4.76, 5.02, 4.91, 5.19`;

    // â”€â”€ Starter code: ONLY Week 03 concepts â”€â”€
    // for, range(), accumulator, break/continue
    // NO sum(), min(), max(), NO functions, NO dicts, NO list comprehensions
    const starterCode =
`# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Week 03 â€” Human Sensor Calibration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# DATA is a string with 10 comma-separated times.
# The lines below split them into a list of floats.
# (You'll learn list methods properly later â€” just use the loop below)

_parts = DATA.strip().split(",")
readings = []
for _p in _parts:
    readings.append(float(_p.strip()))

TARGET = 5.0    # the reference value: exactly 5 seconds
NUM = len(readings)   # should be 10

print("=" * 50)
print("ğŸ¯ HUMAN SENSOR CALIBRATION REPORT")
print("=" * 50)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 1: Print each trial and its error
#         error = reading - TARGET  (can be + or -)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

for i in range(NUM):
    error = readings[i] - TARGET
    if error >= 0:
        sign = "+"
    else:
        sign = ""
    print(f"  Trial {i + 1:2d}: {readings[i]:.3f}s  (error: {sign}{error:.3f}s)")

print("-" * 50)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 2: Calculate TOTAL and AVERAGE absolute error
#         Use an accumulator â€” do NOT use sum()!
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

total_abs_error = 0
for i in range(NUM):
    error = abs(readings[i] - TARGET)
    total_abs_error = total_abs_error + error

avg_abs_error = total_abs_error / NUM

print(f"Total absolute error   : {total_abs_error:.3f}s")
print(f"Average absolute error : {avg_abs_error:.3f}s")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 3: Find the BEST and WORST attempts
#         (smallest and largest absolute error)
#         Do NOT use min() or max()!
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

best_error = abs(readings[0] - TARGET)
best_trial = 1
worst_error = abs(readings[0] - TARGET)
worst_trial = 1

for i in range(1, NUM):
    error = abs(readings[i] - TARGET)
    if error < best_error:
        best_error = error
        best_trial = i + 1
    if error > worst_error:
        worst_error = error
        worst_trial = i + 1

print(f"Best attempt  : Trial {best_trial} (error: {best_error:.3f}s)")
print(f"Worst attempt : Trial {worst_trial} (error: {worst_error:.3f}s)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 4: Count how many attempts were "precise"
#         Precise = within Â±0.10s of the target
#         Use continue to skip non-precise ones
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

precise_count = 0
for i in range(NUM):
    error = abs(readings[i] - TARGET)
    if error > 0.10:
        continue    # skip â€” not precise enough
    precise_count = precise_count + 1

print(f"Precise hits (Â±0.10s) : {precise_count}/{NUM}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 5: Calculate BIAS (systematic error)
#         bias = average of (reading - TARGET), with sign
#         Positive bias = you tend to overshoot
#         Negative bias = you tend to undershoot
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

total_signed_error = 0
for i in range(NUM):
    total_signed_error = total_signed_error + (readings[i] - TARGET)

bias = total_signed_error / NUM

print(f"Bias (systematic error): {bias:+.3f}s", end="")
if bias > 0.05:
    print("  â†’ You tend to OVERSHOOT")
elif bias < -0.05:
    print("  â†’ You tend to UNDERSHOOT")
else:
    print("  â†’ Well calibrated!")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 6: LEARNING EFFECT â€” compare first 5 vs last 5
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

first_half_error = 0
for i in range(5):
    first_half_error = first_half_error + abs(readings[i] - TARGET)
first_half_avg = first_half_error / 5

second_half_error = 0
for i in range(5, NUM):
    second_half_error = second_half_error + abs(readings[i] - TARGET)
second_half_avg = second_half_error / 5

improvement = first_half_avg - second_half_avg

print("-" * 50)
print(f"First 5 avg error  : {first_half_avg:.3f}s")
print(f"Last 5 avg error   : {second_half_avg:.3f}s")
print(f"Improvement         : {improvement:+.3f}s", end="")
if improvement > 0.02:
    print("  â†’ You got BETTER with practice!")
elif improvement < -0.02:
    print("  â†’ You got WORSE (fatigue?)")
else:
    print("  â†’ Consistent throughout")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 7: PRECISION GRADE
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print("-" * 50)

if avg_abs_error < 0.05:
    grade = "S â€” Precision Instrument"
elif avg_abs_error < 0.10:
    grade = "A â€” Excellent"
elif avg_abs_error < 0.20:
    grade = "B â€” Good"
elif avg_abs_error < 0.35:
    grade = "C â€” Needs Calibration"
else:
    grade = "D â€” Unreliable Sensor"

print(f"CALIBRATION GRADE: {grade}")
print(f"  Average error: {avg_abs_error:.3f}s")
print(f"  Precise hits:  {precise_count}/{NUM}")
print(f"  Bias:          {bias:+.3f}s")
print("=" * 50)
`;

    // â”€â”€ Wiring â”€â”€
    function save(){
      PhoneLabUI.saveDraft(WEEK, {
        studentId: studentIdEl.value, nameSurname: nameSurnameEl.value,
        email: emailEl.value, data: dataEl.value, code: codeEl.value,
        output: outEl.textContent, savedAt: new Date().toISOString()
      });
      statusEl.textContent = "Draft saved.";
    }

    function submitViaForm(payload){
      const form = document.createElement("form");
      form.method = "POST"; form.action = SCRIPT_URL; form.target = "_blank";
      const inp = document.createElement("input");
      inp.type = "hidden"; inp.name = "payload"; inp.value = JSON.stringify(payload);
      form.appendChild(inp); document.body.appendChild(form); form.submit(); form.remove();
    }

    const draft = PhoneLabUI.loadDraft(WEEK);
    if (draft){
      studentIdEl.value   = draft.studentId || "";
      nameSurnameEl.value = draft.nameSurname || "";
      emailEl.value       = draft.email || "";
      dataEl.value        = draft.data || defaultData;
      codeEl.value        = draft.code || starterCode;
      outEl.textContent   = draft.output || 'Click "â–¶ Run Python" to see output here.';
      statusEl.textContent = "Draft loaded.";
    } else {
      dataEl.value = defaultData;
      codeEl.value = starterCode;
    }

    [studentIdEl, nameSurnameEl, emailEl, dataEl, codeEl].forEach(el =>
      el.addEventListener("input", save));

    document.getElementById("runBtn").addEventListener("click", async () => {
      statusEl.textContent = "Loading Python runtimeâ€¦";
      const dataLiteral = JSON.stringify(dataEl.value);
      const codeToRun = `DATA = ${dataLiteral}\n\n` + codeEl.value;
      try {
        const out = await PhoneLabUI.runPythonCapture(codeToRun);
        outEl.textContent = out || "(no output)";
        statusEl.textContent = "âœ… Run complete.";
        save();
      } catch (e) {
        outEl.textContent = String(e);
        statusEl.textContent = "âŒ Error â€” check your code.";
        save();
      }
    });

    document.getElementById("submitBtn").addEventListener("click", () => {
      const studentId   = studentIdEl.value.trim();
      const nameSurname = nameSurnameEl.value.trim();
      const email       = emailEl.value.trim().toLowerCase();

      if (!/^\d{6,12}$/.test(studentId))
        { statusEl.textContent = "Student ID must be 6â€“12 digits."; return; }
      if (nameSurname.split(/\s+/).filter(Boolean).length < 2)
        { statusEl.textContent = "Enter Name and Surname."; return; }
      if (!/^[A-Za-z0-9._%+-]+@istun\.edu\.tr$/.test(email))
        { statusEl.textContent = "Email must be @istun.edu.tr"; return; }

      // Block after deadline
      if (new Date() > DEADLINE) {
        statusEl.textContent = "â° Submission closed â€” deadline was Mar 4, 23:59.";
        return;
      }

      // Block default data
      if (dataEl.value.replace(/\s+/g,"") === defaultData.replace(/\s+/g,"")) {
        statusEl.textContent = "âš ï¸ Enter YOUR OWN stopwatch readings â€” default values are not accepted.";
        dataEl.style.outline = "2px solid #ef4444";
        setTimeout(() => dataEl.style.outline = "", 3000);
        return;
      }

      if (!outEl.textContent || outEl.textContent.includes("Click") || outEl.textContent === "(no output)")
        { statusEl.textContent = "âš ï¸ Run your code first before submitting."; return; }

      const payload = {
        week: WEEK, studentId, nameSurname, email,
        data: dataEl.value, code: codeEl.value, output: outEl.textContent,
        userAgent: navigator.userAgent, submittedAt: new Date().toISOString()
      };
      statusEl.textContent = "Submittingâ€¦";
      submitViaForm(payload);
      PhoneLabUI.setStatus(WEEK, "submitted");
    });

    // Help modal
    const helpModal = document.getElementById("helpModal");
    document.getElementById("helpBtn").addEventListener("click", () => helpModal.style.display = "flex");
    document.getElementById("closeHelpBtn").addEventListener("click", () => helpModal.style.display = "none");
    helpModal.addEventListener("click", e => { if (e.target === helpModal) helpModal.style.display = "none"; });
    document.addEventListener("keydown", e => { if (e.key === "Escape") helpModal.style.display = "none"; });
  </script>
</body>
</html>
