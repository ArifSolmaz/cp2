<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week 12 â€” PhoneLab</title>
  <link rel="stylesheet" href="../assets/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">Week 12 â€” Personal Stats Dashboard</div>
      <div class="brand-sub"><a href="../index.html">â† Back to PhoneLab Hub</a></div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h1 style="margin:0 0 4px;">ğŸ“Š Personal Stats Dashboard</h1>
      <p class="muted" style="margin:0 0 12px;">
        Track 7 days of your daily numbers and analyze them using
        <b>Python's standard library</b> â€” statistics, collections, datetime,
        dataclasses, enum, and more.
      </p>

      <div class="concepts-box">
        <b>ğŸ“š Concepts you'll practice (from Week 12):</b>
        <span class="concept-tag">import / as / fromâ€¦import</span>
        <span class="concept-tag">statistics module</span>
        <span class="concept-tag">collections (Counter, defaultdict)</span>
        <span class="concept-tag">datetime</span>
        <span class="concept-tag">dataclasses</span>
        <span class="concept-tag">enum</span>
        <span class="concept-tag">json / math / itertools / functools</span>
      </div>

      <!-- Step indicator -->
      <div class="steps" style="margin-top:14px;">
        <div class="step-pill active" data-step="1">â‘  Identity</div>
        <div class="step-pill" data-step="2">â‘¡ Data</div>
        <div class="step-pill" data-step="3">â‘¢ Code</div>
        <div class="step-pill" data-step="4">â‘£ Run & Submit</div>
      </div>

      <details open id="sec1">
        <summary><b>1) Identity</b> <span class="muted">(required)</span></summary>
        <div class="row">
          <div>
            <label>Student ID (6â€“12 digits)</label>
            <input id="studentId" inputmode="numeric" minlength="6" maxlength="12"
                   pattern="^\d{6,12}$" required placeholder="e.g., 202612345" />
          </div>
          <div>
            <label>Name Surname</label>
            <input id="nameSurname" required placeholder="e.g., Arif Solmaz" />
          </div>
        </div>
        <label>Email (@istun.edu.tr)</label>
        <input id="email" type="email"
               pattern="^[A-Za-z0-9._%+-]+@istun\.edu\.tr$"
               required placeholder="name@istun.edu.tr" />
        <small class="hint">Draft auto-saves on this device.</small>
      </details>

      <hr />

      <details open id="sec2">
        <summary><b>2) Collect your data</b> <span class="muted">(past 7 days)</span></summary>

        <div class="scenario-box">
          <b>ğŸ”¬ What to do:</b>
          <ol class="muted" style="margin:6px 0 0; padding-left:20px;">
            <li>Think back over the <b>last 7 days</b> (Monâ†’Sun or any 7 consecutive days).</li>
            <li>For each day, estimate these 5 metrics:
              <ul style="margin-top:4px;">
                <li><b>Sleep</b> (hours, e.g., 7.5)</li>
                <li><b>Water</b> (glasses, e.g., 6)</li>
                <li><b>Screen time</b> (hours, e.g., 4.5 â€” from Digital Wellbeing)</li>
                <li><b>Steps</b> (from Health app, e.g., 8200)</li>
                <li><b>Mood</b> (1â€“5: 1=terrible, 2=bad, 3=ok, 4=good, 5=great)</li>
              </ul>
            </li>
            <li>Format: <code>date,sleep,water,screen,steps,mood</code></li>
            <li>Date format: <code>YYYY-MM-DD</code> (e.g., 2026-02-09)</li>
          </ol>
          <small>ğŸ’¡ <b>Tip:</b> Check your Health/Wellbeing app for steps and screen time. Estimate the rest!</small>
        </div>

        <label>Your 7 days of data (one per line)</label>
        <textarea id="dataBox" spellcheck="false"></textarea>
        <small class="hint">âš ï¸ Enter <b>your own</b> daily stats. Default values will be rejected.</small>
      </details>

      <hr />

      <details id="sec3">
        <summary><b>3) Python code</b> <span class="muted">(standard library showcase)</span></summary>
        <label>Python â€” analyze with stdlib modules</label>
        <textarea id="codeBox" class="codebox" spellcheck="false"></textarea>
        <small class="hint">
          Use <b>statistics</b>, <b>collections</b>, <b>datetime</b>,
          <b>dataclasses</b>, <b>enum</b>, <b>json</b>, <b>math</b>,
          <b>itertools</b>, and <b>functools</b>.
        </small>
      </details>

      <hr />

      <details id="sec4">
        <summary><b>4) Output</b> <span class="muted">(auto-captured after Run)</span></summary>
        <pre id="output" class="out">Click "â–¶ Run Python" to see output here.</pre>
      </details>

      <div class="stickybar">
        <div class="bar-actions">
          <button id="helpBtn" class="helpbtn" type="button">?</button>
          <button id="runBtn" type="button">â–¶ Run Python</button>
          <button id="submitBtn" class="primary" type="button">Submit âœ“</button>
        </div>
        <small id="status" class="hint"></small>
      </div>
    </section>
  </main>

  <!-- Help Modal -->
  <div id="helpModal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>ğŸ“Š Week 12 â€” Instructions</h3>
      <ol class="muted">
        <li><b>Identity:</b> Student ID (6â€“12 digits), Name Surname, <b>@istun.edu.tr</b> email.</li>
        <li><b>Recall your week:</b> Think about last 7 days. Estimate sleep, water, screen time. Check Health app for steps.</li>
        <li><b>Enter data:</b> One day per line: <code>YYYY-MM-DD,sleep,water,screen,steps,mood</code></li>
        <li><b>Write code:</b> Complete the TODOs â€” each uses a different stdlib module.</li>
        <li><b>Run &amp; Submit.</b></li>
      </ol>
      <p class="muted" style="margin-top:10px;">
        <b>ğŸ“ The engineering:</b> Real-world mechatronics projects are built from
        standard library modules â€” <code>datetime</code> for timestamps,
        <code>statistics</code> for sensor analysis, <code>dataclasses</code> for
        clean data models, <code>enum</code> for state machines, <code>json</code>
        for configuration. Knowing your stdlib is what separates a script-writer
        from an engineer!
      </p>
      <div class="modal-actions">
        <button id="closeHelpBtn" type="button">Got it</button>
      </div>
    </div>
  </div>

  <script src="../assets/app.js"></script>
  <script>
    const WEEK = "week12";
    const DEADLINE = new Date("2026-05-06T23:59:00+03:00");

    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxu_JAL7pMXz_7bSGC7kIYvs76UGJji8ubbmr6h7rnLY-M2deKSubTxTiekeKecMclC/exec";

    const studentIdEl   = document.getElementById("studentId");
    const nameSurnameEl = document.getElementById("nameSurname");
    const emailEl       = document.getElementById("email");
    const dataEl        = document.getElementById("dataBox");
    const codeEl        = document.getElementById("codeBox");
    const outEl         = document.getElementById("output");
    const statusEl      = document.getElementById("status");

    // â”€â”€ Default data â”€â”€
    const defaultData =
`2026-02-09,7.5,6,4.5,8200,4
2026-02-10,6.0,4,6.0,3100,2
2026-02-11,8.0,8,3.0,10500,5
2026-02-12,5.5,5,5.5,4200,3
2026-02-13,7.0,7,4.0,9300,4
2026-02-14,9.0,6,2.5,11200,5
2026-02-15,6.5,3,7.0,2800,2`;

    const starterCode =
`# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Week 12 â€” Personal Stats Dashboard
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 1: IMPORT modules â€” use ALL THREE import styles
#         import X
#         import X as Y
#         from X import Z
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import statistics                        # import X
import datetime as dt                    # import X as Y
import math
import json
import re
from collections import Counter, defaultdict   # from X import Z
from dataclasses import dataclass, field
from enum import Enum
from itertools import combinations
from functools import reduce

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 2: Define ENUM for mood levels
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

class Mood(Enum):
    TERRIBLE = 1
    BAD = 2
    OK = 3
    GOOD = 4
    GREAT = 5

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 3: Define DATACLASS for a daily record
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

@dataclass
class DayRecord:
    date: str
    sleep: float
    water: int
    screen: float
    steps: int
    mood: Mood

    @property
    def weekday_name(self):
        """Use datetime to get the weekday name."""
        d = dt.datetime.strptime(self.date, "%Y-%m-%d")
        return d.strftime("%A")

    def __str__(self):
        return (f"{self.weekday_name:9s} {self.date} | "
                f"sleep:{self.sleep:4.1f}h water:{self.water} "
                f"screen:{self.screen:4.1f}h steps:{self.steps:5d} "
                f"mood:{self.mood.name}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 4: Parse data into DayRecord objects
#         Use re module for input validation
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

_lines = DATA.strip().split("\\n")
DATE_PATTERN = re.compile(r"^\\d{4}-\\d{2}-\\d{2}$")

days = []
for line in _lines:
    parts = [p.strip() for p in line.split(",")]
    date_str = parts[0]

    # Validate date format with regex
    if not DATE_PATTERN.match(date_str):
        print(f"  âš ï¸ Skipping invalid date: {date_str}")
        continue

    record = DayRecord(
        date=date_str,
        sleep=float(parts[1]),
        water=int(parts[2]),
        screen=float(parts[3]),
        steps=int(parts[4]),
        mood=Mood(int(parts[5]))
    )
    days.append(record)

print("=" * 55)
print("ğŸ“Š PERSONAL STATS DASHBOARD")
print("=" * 55)

# â”€â”€ Print all records (uses dataclass __str__) â”€â”€

print("\\nDAILY LOG:")
for day in days:
    print(f"  {day}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 5: Use STATISTICS module for analysis
#         mean, median, stdev for each metric
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print(f"\\n{'â”€' * 55}")
print("STATISTICS MODULE ANALYSIS:")

sleep_vals = [d.sleep for d in days]
water_vals = [d.water for d in days]
screen_vals = [d.screen for d in days]
step_vals = [d.steps for d in days]
mood_vals = [d.mood.value for d in days]

metrics = {
    "Sleep (hrs)":   sleep_vals,
    "Water (glasses)": water_vals,
    "Screen (hrs)":  screen_vals,
    "Steps":         step_vals,
    "Mood (1-5)":    mood_vals,
}

print(f"  {'Metric':18s} {'Mean':>7s} {'Median':>7s} {'StDev':>7s}")
print(f"  {'â”€' * 42}")
for name, vals in metrics.items():
    avg = statistics.mean(vals)
    med = statistics.median(vals)
    std = statistics.stdev(vals) if len(vals) > 1 else 0
    print(f"  {name:18s} {avg:7.1f} {med:7.1f} {std:7.1f}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 6: Use COLLECTIONS â€” Counter and defaultdict
#         Counter for mood frequency
#         defaultdict for grouping by weekday type
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print(f"\\n{'â”€' * 55}")
print("COLLECTIONS ANALYSIS:")

# Counter â€” mood distribution
mood_counts = Counter(d.mood.name for d in days)
print("\\n  Mood distribution (Counter):")
for mood_name, count in mood_counts.most_common():
    bar = "â–ˆ" * count
    print(f"    {mood_name:10s} {count}x {bar}")

# defaultdict â€” group by weekday vs weekend
day_groups = defaultdict(list)
for d in days:
    parsed = dt.datetime.strptime(d.date, "%Y-%m-%d")
    kind = "Weekend" if parsed.weekday() >= 5 else "Weekday"
    day_groups[kind].append(d)

print("\\n  Weekday vs Weekend (defaultdict):")
for kind, records in day_groups.items():
    avg_sleep = statistics.mean([r.sleep for r in records])
    avg_steps = statistics.mean([r.steps for r in records])
    print(f"    {kind:8s} ({len(records)} days): "
          f"avg sleep={avg_sleep:.1f}h, avg steps={avg_steps:.0f}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 7: Use DATETIME for date operations
#         Parse dates, compute span, format output
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print(f"\\n{'â”€' * 55}")
print("DATETIME ANALYSIS:")

dates = [dt.datetime.strptime(d.date, "%Y-%m-%d") for d in days]
first_date = min(dates)
last_date = max(dates)
span = (last_date - first_date).days

print(f"  First day : {first_date.strftime('%A, %B %d, %Y')}")
print(f"  Last day  : {last_date.strftime('%A, %B %d, %Y')}")
print(f"  Span      : {span} days")
print(f"  Today     : {dt.datetime.now().strftime('%Y-%m-%d %H:%M')}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 8: Use ITERTOOLS â€” combinations to find
#         correlations between metric pairs
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print(f"\\n{'â”€' * 55}")
print("METRIC CORRELATIONS (itertools.combinations):")

metric_names = list(metrics.keys())

def simple_correlation(xs, ys):
    """Compute Pearson correlation using math module."""
    n = len(xs)
    if n < 2:
        return 0
    mean_x = statistics.mean(xs)
    mean_y = statistics.mean(ys)
    num = sum((x - mean_x) * (y - mean_y) for x, y in zip(xs, ys))
    den_x = math.sqrt(sum((x - mean_x) ** 2 for x in xs))
    den_y = math.sqrt(sum((y - mean_y) ** 2 for y in ys))
    if den_x == 0 or den_y == 0:
        return 0
    return num / (den_x * den_y)

for m1, m2 in combinations(metric_names, 2):
    r = simple_correlation(metrics[m1], metrics[m2])
    if abs(r) >= 0.5:
        direction = "ğŸ“ˆ positive" if r > 0 else "ğŸ“‰ negative"
        print(f"  {m1:18s} Ã— {m2:18s} r={r:+.2f} {direction}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 9: Use FUNCTOOLS.REDUCE for aggregations
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print(f"\\n{'â”€' * 55}")
print("FUNCTOOLS.REDUCE:")

total_steps = reduce(lambda a, b: a + b, step_vals)
best_day = reduce(lambda a, b: a if a.mood.value > b.mood.value else b, days)
worst_day = reduce(lambda a, b: a if a.mood.value < b.mood.value else b, days)

print(f"  Total steps (reduce)   : {total_steps:,}")
print(f"  Best mood day (reduce) : {best_day.weekday_name} â€” {best_day.mood.name}")
print(f"  Worst mood day (reduce): {worst_day.weekday_name} â€” {worst_day.mood.name}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 10: Use JSON to export the dashboard report
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print(f"\\n{'â”€' * 55}")
print("JSON EXPORT:")

report = {
    "period": f"{first_date.strftime('%Y-%m-%d')} to {last_date.strftime('%Y-%m-%d')}",
    "days_tracked": len(days),
    "averages": {
        "sleep": round(statistics.mean(sleep_vals), 1),
        "water": round(statistics.mean(water_vals), 1),
        "screen": round(statistics.mean(screen_vals), 1),
        "steps": round(statistics.mean(step_vals)),
        "mood": round(statistics.mean(mood_vals), 1),
    },
    "mood_distribution": dict(mood_counts),
}

json_str = json.dumps(report, indent=2)
print(f"  {json_str[:200]}...")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# MODULE DEMO: __name__ guard
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print(f"\\n{'â”€' * 55}")
print("MODULE SYSTEM INFO:")
print(f"  __name__        = {__name__}")
print(f"  Modules used    = statistics, datetime, math, json, re,")
print(f"                    collections, dataclasses, enum,")
print(f"                    itertools, functools")
print(f"  Import styles   = import X, import X as Y, from X import Z")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# WELLNESS VERDICT
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print(f"\\n{'=' * 55}")

avg_mood = statistics.mean(mood_vals)
avg_sleep = statistics.mean(sleep_vals)
avg_screen = statistics.mean(screen_vals)

score = 0
if avg_sleep >= 7: score += 1
if avg_mood >= 3.5: score += 1
if avg_screen <= 4: score += 1
if statistics.mean(step_vals) >= 7000: score += 1
if statistics.mean(water_vals) >= 6: score += 1

verdicts = {
    5: "â­ Excellent â€” you're crushing it!",
    4: "âœ… Good â€” healthy habits overall",
    3: "ğŸŸ¡ Fair â€” some areas need attention",
    2: "ğŸŸ  Needs work â€” multiple metrics below target",
}
verdict = verdicts.get(score, "ğŸ”´ Attention â€” prioritize self-care")

print(f"WELLNESS SCORE: {score}/5 â€” {verdict}")
print(f"  Sleep avg  : {avg_sleep:.1f}h {'âœ…' if avg_sleep >= 7 else 'âŒ'} (target: 7+)")
print(f"  Mood avg   : {avg_mood:.1f}/5 {'âœ…' if avg_mood >= 3.5 else 'âŒ'} (target: 3.5+)")
print(f"  Screen avg : {avg_screen:.1f}h {'âœ…' if avg_screen <= 4 else 'âŒ'} (target: â‰¤4)")
print(f"  Steps avg  : {statistics.mean(step_vals):.0f} {'âœ…' if statistics.mean(step_vals) >= 7000 else 'âŒ'} (target: 7000+)")
print(f"  Water avg  : {statistics.mean(water_vals):.1f} {'âœ…' if statistics.mean(water_vals) >= 6 else 'âŒ'} (target: 6+)")
print("=" * 55)
`;

    // â”€â”€ Wiring â”€â”€
    function save(){
      PhoneLabUI.saveDraft(WEEK, {
        studentId: studentIdEl.value, nameSurname: nameSurnameEl.value,
        email: emailEl.value, data: dataEl.value, code: codeEl.value,
        output: outEl.textContent, savedAt: new Date().toISOString()
      });
      statusEl.textContent = "Draft saved.";
    }

    function submitViaForm(payload){
      const form = document.createElement("form");
      form.method = "POST"; form.action = SCRIPT_URL; form.target = "_blank";
      const inp = document.createElement("input");
      inp.type = "hidden"; inp.name = "payload"; inp.value = JSON.stringify(payload);
      form.appendChild(inp); document.body.appendChild(form); form.submit(); form.remove();
    }

    const draft = PhoneLabUI.loadDraft(WEEK);
    if (draft){
      studentIdEl.value   = draft.studentId || "";
      nameSurnameEl.value = draft.nameSurname || "";
      emailEl.value       = draft.email || "";
      dataEl.value        = draft.data || defaultData;
      codeEl.value        = draft.code || starterCode;
      outEl.textContent   = draft.output || 'Click "â–¶ Run Python" to see output here.';
      statusEl.textContent = "Draft loaded.";
    } else {
      dataEl.value = defaultData;
      codeEl.value = starterCode;
    }

    [studentIdEl, nameSurnameEl, emailEl, dataEl, codeEl].forEach(el =>
      el.addEventListener("input", save));

    document.getElementById("runBtn").addEventListener("click", async () => {
      statusEl.textContent = "Loading Python runtimeâ€¦";
      const dataLiteral = JSON.stringify(dataEl.value);
      const codeToRun = `DATA = ${dataLiteral}\n\n` + codeEl.value;
      try {
        const out = await PhoneLabUI.runPythonCapture(codeToRun);
        outEl.textContent = out || "(no output)";
        statusEl.textContent = "âœ… Run complete.";
        save();
      } catch (e) {
        outEl.textContent = String(e);
        statusEl.textContent = "âŒ Error â€” check your code.";
        save();
      }
    });

    document.getElementById("submitBtn").addEventListener("click", () => {
      const studentId   = studentIdEl.value.trim();
      const nameSurname = nameSurnameEl.value.trim();
      const email       = emailEl.value.trim().toLowerCase();

      if (!/^\d{6,12}$/.test(studentId))
        { statusEl.textContent = "Student ID must be 6â€“12 digits."; return; }
      if (nameSurname.split(/\s+/).filter(Boolean).length < 2)
        { statusEl.textContent = "Enter Name and Surname."; return; }
      if (!/^[A-Za-z0-9._%+-]+@istun\.edu\.tr$/.test(email))
        { statusEl.textContent = "Email must be @istun.edu.tr"; return; }

      if (new Date() > DEADLINE) {
        statusEl.textContent = "â° Submission closed â€” deadline was May 6, 23:59.";
        return;
      }

      if (dataEl.value.replace(/\s+/g,"") === defaultData.replace(/\s+/g,"")) {
        statusEl.textContent = "âš ï¸ Enter YOUR OWN daily stats â€” default values are not accepted.";
        dataEl.style.outline = "2px solid #ef4444";
        setTimeout(() => dataEl.style.outline = "", 3000);
        return;
      }

      if (!outEl.textContent || outEl.textContent.includes("Click") || outEl.textContent === "(no output)")
        { statusEl.textContent = "âš ï¸ Run your code first before submitting."; return; }

      const payload = {
        week: WEEK, studentId, nameSurname, email,
        data: dataEl.value, code: codeEl.value, output: outEl.textContent,
        userAgent: navigator.userAgent, submittedAt: new Date().toISOString()
      };
      statusEl.textContent = "Submittingâ€¦";
      submitViaForm(payload);
      PhoneLabUI.setStatus(WEEK, "submitted");
    });

    const helpModal = document.getElementById("helpModal");
    document.getElementById("helpBtn").addEventListener("click", () => helpModal.style.display = "flex");
    document.getElementById("closeHelpBtn").addEventListener("click", () => helpModal.style.display = "none");
    helpModal.addEventListener("click", e => { if (e.target === helpModal) helpModal.style.display = "none"; });
    document.addEventListener("keydown", e => { if (e.key === "Escape") helpModal.style.display = "none"; });
  </script>
</body>
</html>
