<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week 10 â€” PhoneLab</title>
  <link rel="stylesheet" href="../assets/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">Week 10 â€” Music Library Builder</div>
      <div class="brand-sub"><a href="../index.html">â† Back to PhoneLab Hub</a></div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h1 style="margin:0 0 4px;">ğŸµ Music Library Builder</h1>
      <p class="muted" style="margin:0 0 12px;">
        Turn your playlist into a full <b>object-oriented system</b>!
        Build <code>Song</code> and <code>Playlist</code> classes with constructors,
        dunder methods, properties, and composition.
      </p>

      <div class="concepts-box">
        <b>ğŸ“š Concepts you'll practice (from Week 10):</b>
        <span class="concept-tag">class / __init__ / self</span>
        <span class="concept-tag">__str__ / __repr__</span>
        <span class="concept-tag">__eq__ / __lt__ / __gt__</span>
        <span class="concept-tag">__len__ / __contains__ / __add__</span>
        <span class="concept-tag">@property / @staticmethod / @classmethod</span>
        <span class="concept-tag">class attributes / composition</span>
      </div>

      <!-- Step indicator -->
      <div class="steps" style="margin-top:14px;">
        <div class="step-pill active" data-step="1">â‘  Identity</div>
        <div class="step-pill" data-step="2">â‘¡ Data</div>
        <div class="step-pill" data-step="3">â‘¢ Code</div>
        <div class="step-pill" data-step="4">â‘£ Run & Submit</div>
      </div>

      <details open id="sec1">
        <summary><b>1) Identity</b> <span class="muted">(required)</span></summary>
        <div class="row">
          <div>
            <label>Student ID (6â€“12 digits)</label>
            <input id="studentId" inputmode="numeric" minlength="6" maxlength="12"
                   pattern="^\d{6,12}$" required placeholder="e.g., 202612345" />
          </div>
          <div>
            <label>Name Surname</label>
            <input id="nameSurname" required placeholder="e.g., Arif Solmaz" />
          </div>
        </div>
        <label>Email (@istun.edu.tr)</label>
        <input id="email" type="email"
               pattern="^[A-Za-z0-9._%+-]+@istun\.edu\.tr$"
               required placeholder="name@istun.edu.tr" />
        <small class="hint">Draft auto-saves on this device.</small>
      </details>

      <hr />

      <details open id="sec2">
        <summary><b>2) Collect your data</b> <span class="muted">(from your music app)</span></summary>

        <div class="scenario-box">
          <b>ğŸ”¬ What to do:</b>
          <ol class="muted" style="margin:6px 0 0; padding-left:20px;">
            <li>Open <b>Spotify, YouTube Music, Apple Music</b>, or any music app.</li>
            <li>Pick <b>8 songs</b> you've recently listened to. For each song, note:
              <ul style="margin-top:4px;">
                <li><b>Title</b></li>
                <li><b>Artist</b></li>
                <li><b>Duration</b> in seconds (e.g., 3:24 â†’ 204)</li>
                <li><b>Genre</b> (pop, rock, hip-hop, electronic, classical, r&amp;b, jazz, etc.)</li>
              </ul>
            </li>
            <li>Format: one song per line â€” <code>Title,Artist,Duration_sec,Genre</code></li>
          </ol>
          <small>ğŸ’¡ <b>Tip:</b> To convert m:ss to seconds: 3:24 = 3Ã—60 + 24 = 204 seconds.</small>
        </div>

        <label>Your 8 songs (one per line)</label>
        <textarea id="dataBox" spellcheck="false"></textarea>
        <small class="hint">âš ï¸ Enter <b>your own</b> songs. Default values will be rejected.</small>
      </details>

      <hr />

      <details id="sec3">
        <summary><b>3) Python code</b> <span class="muted">(build the OOP system)</span></summary>
        <label>Python â€” Song and Playlist classes</label>
        <textarea id="codeBox" class="codebox" spellcheck="false"></textarea>
        <small class="hint">
          Build <b>classes</b> with <b>__init__</b>, <b>dunder methods</b>,
          <b>@property</b>, <b>@staticmethod</b>, <b>@classmethod</b>,
          and <b>composition</b>.
        </small>
      </details>

      <hr />

      <details id="sec4">
        <summary><b>4) Output</b> <span class="muted">(auto-captured after Run)</span></summary>
        <pre id="output" class="out">Click "â–¶ Run Python" to see output here.</pre>
      </details>

      <div class="stickybar">
        <div class="bar-actions">
          <button id="helpBtn" class="helpbtn" type="button">?</button>
          <button id="runBtn" type="button">â–¶ Run Python</button>
          <button id="submitBtn" class="primary" type="button">Submit âœ“</button>
        </div>
        <small id="status" class="hint"></small>
      </div>
    </section>
  </main>

  <!-- Help Modal -->
  <div id="helpModal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>ğŸµ Week 10 â€” Instructions</h3>
      <ol class="muted">
        <li><b>Identity:</b> Student ID (6â€“12 digits), Name Surname, <b>@istun.edu.tr</b> email.</li>
        <li><b>Find your music:</b> Open Spotify, YouTube Music, or any player. Pick 8 songs you know.</li>
        <li><b>Enter data:</b> One song per line: <code>Title,Artist,Seconds,Genre</code></li>
        <li><b>Write code:</b> Complete the TODOs â€” build Song and Playlist classes with all OOP features.</li>
        <li><b>Run:</b> Tap "â–¶ Run Python" and check the library report.</li>
        <li><b>Submit:</b> One submission only.</li>
      </ol>
      <p class="muted" style="margin-top:10px;">
        <b>ğŸ“ The engineering:</b> In mechatronics, OOP models real-world entities â€”
        a <code>Motor</code> class with speed/torque attributes, a <code>SensorArray</code>
        composed of <code>Sensor</code> objects, a <code>Robot</code> containing
        <code>Joint</code> instances. The Songâ†’Playlist composition you build here
        is the same pattern as Sensorâ†’SensorStation in industrial systems!
      </p>
      <div class="modal-actions">
        <button id="closeHelpBtn" type="button">Got it</button>
      </div>
    </div>
  </div>

  <script src="../assets/app.js"></script>
  <script>
    const WEEK = "week10";
    const DEADLINE = new Date("2026-04-22T23:59:00+03:00");

    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxu_JAL7pMXz_7bSGC7kIYvs76UGJji8ubbmr6h7rnLY-M2deKSubTxTiekeKecMclC/exec";

    const studentIdEl   = document.getElementById("studentId");
    const nameSurnameEl = document.getElementById("nameSurname");
    const emailEl       = document.getElementById("email");
    const dataEl        = document.getElementById("dataBox");
    const codeEl        = document.getElementById("codeBox");
    const outEl         = document.getElementById("output");
    const statusEl      = document.getElementById("status");

    // â”€â”€ Default data â”€â”€
    const defaultData =
`Blinding Lights,The Weeknd,200,pop
Bohemian Rhapsody,Queen,354,rock
Lose Yourself,Eminem,326,hip-hop
Strobe,Deadmau5,625,electronic
Nuvole Bianche,Ludovico Einaudi,348,classical
Levitating,Dua Lipa,203,pop
One More Time,Daft Punk,320,electronic
Back in Black,AC/DC,255,rock`;

    const starterCode =
`# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Week 10 â€” Music Library Builder
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 1: Define the SONG CLASS
#         - __init__(self, title, artist, duration_sec, genre)
#         - CLASS ATTRIBUTE: song_count (tracks total songs created)
#         - Store all attributes with self
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

class Song:
    """Represents a single music track."""

    song_count = 0     # class attribute â€” shared by all instances

    def __init__(self, title, artist, duration_sec, genre):
        self.title = title
        self.artist = artist
        self._duration_sec = int(duration_sec)   # _ prefix = internal
        self.genre = genre.lower()
        Song.song_count += 1

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # TODO 2: Implement __str__ and __repr__
    #         __str__  â†’ "Title - Artist (3:24)"
    #         __repr__ â†’ "Song('Title', 'Artist', 204, 'pop')"
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    def __str__(self):
        return f"{self.title} - {self.artist} ({self.formatted_duration})"

    def __repr__(self):
        return f"Song('{self.title}', '{self.artist}', {self._duration_sec}, '{self.genre}')"

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # TODO 3: Implement COMPARISON dunder methods
    #         __eq__ â†’ same title AND artist
    #         __lt__ â†’ shorter duration
    #         __gt__ â†’ longer duration
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    def __eq__(self, other):
        if not isinstance(other, Song):
            return False
        return self.title.lower() == other.title.lower() and \\
               self.artist.lower() == other.artist.lower()

    def __lt__(self, other):
        return self._duration_sec < other._duration_sec

    def __gt__(self, other):
        return self._duration_sec > other._duration_sec

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # TODO 4: Implement @property for formatted_duration
    #         Returns "m:ss" string from seconds
    #         Also add a setter that validates > 0
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    @property
    def formatted_duration(self):
        """Return duration as m:ss string."""
        mins = self._duration_sec // 60
        secs = self._duration_sec % 60
        return f"{mins}:{secs:02d}"

    @property
    def duration_sec(self):
        return self._duration_sec

    @duration_sec.setter
    def duration_sec(self, value):
        if value <= 0:
            raise ValueError("Duration must be positive")
        self._duration_sec = int(value)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # TODO 5: Implement @staticmethod and @classmethod
    #         @staticmethod sec_to_min(seconds) â†’ float minutes
    #         @classmethod from_csv(cls, csv_line) â†’ Song object
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    @staticmethod
    def sec_to_min(seconds):
        """Convert seconds to minutes (float)."""
        return seconds / 60

    @classmethod
    def from_csv(cls, csv_line):
        """Create a Song from a CSV line: 'Title,Artist,Duration,Genre'."""
        parts = csv_line.strip().split(",")
        return cls(parts[0].strip(), parts[1].strip(),
                   int(parts[2].strip()), parts[3].strip())


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 6: Define PLAYLIST CLASS (composition)
#         - __init__(self, name)
#         - Contains a LIST of Song objects
#         - Implement: add_song(), remove_song()
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

class Playlist:
    """A playlist composed of Song objects (composition)."""

    def __init__(self, name):
        self.name = name
        self._songs = []      # composition: Playlist HAS Songs

    def add_song(self, song):
        """Add a Song to the playlist."""
        if not isinstance(song, Song):
            raise TypeError("Can only add Song objects")
        self._songs.append(song)

    def remove_song(self, title):
        """Remove a song by title."""
        self._songs = [s for s in self._songs if s.title.lower() != title.lower()]

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # TODO 7: Implement dunder methods for Playlist
    #         __len__      â†’ number of songs
    #         __contains__ â†’ "song_title" in playlist
    #         __str__      â†’ "Playlist 'Name' (N songs, M:SS)"
    #         __add__      â†’ merge two playlists
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    def __len__(self):
        return len(self._songs)

    def __contains__(self, title):
        """Check if a song title is in the playlist."""
        return any(s.title.lower() == title.lower() for s in self._songs)

    def __str__(self):
        total = self.total_duration
        mins = total // 60
        secs = total % 60
        return f"Playlist '{self.name}' ({len(self)} songs, {mins}:{secs:02d})"

    def __add__(self, other):
        """Merge two playlists into a new one."""
        merged = Playlist(f"{self.name} + {other.name}")
        for s in self._songs:
            merged.add_song(s)
        for s in other._songs:
            merged.add_song(s)
        return merged

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # TODO 8: Implement @property and instance methods
    #         total_duration â†’ sum of all song durations
    #         get_genres()   â†’ set of unique genres
    #         longest()      â†’ Song with max duration
    #         shortest()     â†’ Song with min duration
    #         by_genre(g)    â†’ list of songs in genre
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    @property
    def total_duration(self):
        """Total duration in seconds."""
        return sum(s.duration_sec for s in self._songs)

    def get_genres(self):
        """Return set of unique genres."""
        return {s.genre for s in self._songs}

    def longest(self):
        """Return the longest song."""
        return max(self._songs, key=lambda s: s.duration_sec) if self._songs else None

    def shortest(self):
        """Return the shortest song."""
        return min(self._songs, key=lambda s: s.duration_sec) if self._songs else None

    def by_genre(self, genre):
        """Return songs matching a genre."""
        return [s for s in self._songs if s.genre == genre.lower()]

    def sorted_by_duration(self):
        """Return songs sorted by duration (uses __lt__)."""
        return sorted(self._songs)


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MAIN PROGRAM â€” build and use the objects!
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

_lines = DATA.strip().split("\\n")

print("=" * 55)
print("ğŸµ MUSIC LIBRARY BUILDER")
print("=" * 55)

# â”€â”€ Create Song objects using @classmethod factory â”€â”€

print("\\nğŸ“€ CREATING SONGS (from_csv classmethod):")

my_playlist = Playlist("My Favorites")

for line in _lines:
    song = Song.from_csv(line)       # @classmethod
    my_playlist.add_song(song)       # composition
    mins = Song.sec_to_min(song.duration_sec)   # @staticmethod
    print(f"  + {song}  [{mins:.1f} min, {song.genre}]")

print(f"\\n  Song.song_count = {Song.song_count} (class attribute)")

# â”€â”€ Test __str__ on Playlist â”€â”€

print(f"\\n{'â”€' * 55}")
print(f"PLAYLIST: {my_playlist}")      # __str__

# â”€â”€ Test __len__ â”€â”€

print(f"  Length (len): {len(my_playlist)} songs")    # __len__

# â”€â”€ Test __contains__ â”€â”€

print(f"\\n{'â”€' * 55}")
print("MEMBERSHIP TEST (__contains__):")
first_title = _lines[0].split(",")[0].strip()
print(f"  '{first_title}' in playlist? {first_title in my_playlist}")
print(f"  'Nonexistent Song' in playlist? {'Nonexistent Song' in my_playlist}")

# â”€â”€ Test comparison dunders â”€â”€

print(f"\\n{'â”€' * 55}")
print("COMPARISONS (__eq__, __lt__, __gt__):")
longest = my_playlist.longest()
shortest = my_playlist.shortest()
print(f"  Longest  : {longest}")
print(f"  Shortest : {shortest}")
print(f"  longest > shortest? {longest > shortest}")     # __gt__
print(f"  shortest < longest? {shortest < longest}")     # __lt__
print(f"  longest == longest? {longest == longest}")     # __eq__

# â”€â”€ Test __repr__ â”€â”€

print(f"\\n{'â”€' * 55}")
print("REPR (__repr__):")
print(f"  {repr(longest)}")
print(f"  {repr(shortest)}")

# â”€â”€ Test @property â”€â”€

print(f"\\n{'â”€' * 55}")
print("PROPERTIES:")
total = my_playlist.total_duration
print(f"  Total duration : {total // 60}:{total % 60:02d} ({total} sec)")
print(f"  Formatted      : {longest.formatted_duration} (longest)")

# â”€â”€ Test property setter validation â”€â”€
try:
    longest.duration_sec = -10
except ValueError as e:
    print(f"  Setter validation: âœ… caught â€” {e}")

# â”€â”€ Genre analysis â”€â”€

print(f"\\n{'â”€' * 55}")
print("GENRE ANALYSIS:")
genres = my_playlist.get_genres()
print(f"  Unique genres: {genres}")

for genre in sorted(genres):
    songs = my_playlist.by_genre(genre)
    names = [s.title for s in songs]
    print(f"  {genre:12s} : {len(songs)} song(s) â†’ {names}")

# â”€â”€ Sorted by duration â”€â”€

print(f"\\n{'â”€' * 55}")
print("SORTED BY DURATION (uses __lt__):")
for rank, song in enumerate(my_playlist.sorted_by_duration(), 1):
    bar = "â–“" * (song.duration_sec // 30)
    print(f"  {rank}. {song.formatted_duration} {song.title:25s} {bar}")

# â”€â”€ Test __add__ â€” merge playlists â”€â”€

print(f"\\n{'â”€' * 55}")
print("PLAYLIST MERGE (__add__):")

workout = Playlist("Workout")
chill = Playlist("Chill")

# Split: first 4 â†’ workout, last 4 â†’ chill
sorted_songs = my_playlist.sorted_by_duration()
for s in sorted_songs[:4]:
    chill.add_song(s)
for s in sorted_songs[4:]:
    workout.add_song(s)

print(f"  {workout}")
print(f"  {chill}")

combined = workout + chill     # __add__
print(f"  Merged: {combined}")

# â”€â”€ Final stats â”€â”€

print(f"\\n{'=' * 55}")
avg_sec = total / len(my_playlist) if len(my_playlist) > 0 else 0
avg_min = Song.sec_to_min(avg_sec)

if avg_min >= 5:
    style = "ğŸ¼ Epic â€” you love long compositions"
elif avg_min >= 3.5:
    style = "ğŸ¸ Standard â€” typical song lengths"
elif avg_min >= 2:
    style = "âš¡ Quick â€” you like short and punchy tracks"
else:
    style = "ğŸµ Micro â€” snippet listener"

print(f"LISTENING PROFILE: {style}")
print(f"  Average song   : {avg_min:.1f} min")
print(f"  Total songs    : {Song.song_count} (class attr)")
print(f"  Unique genres  : {len(genres)}")
print(f"  Longest track  : {longest.title} ({longest.formatted_duration})")
print("=" * 55)
`;

    // â”€â”€ Wiring â”€â”€
    function save(){
      PhoneLabUI.saveDraft(WEEK, {
        studentId: studentIdEl.value, nameSurname: nameSurnameEl.value,
        email: emailEl.value, data: dataEl.value, code: codeEl.value,
        output: outEl.textContent, savedAt: new Date().toISOString()
      });
      statusEl.textContent = "Draft saved.";
    }

    function submitViaForm(payload){
      const form = document.createElement("form");
      form.method = "POST"; form.action = SCRIPT_URL; form.target = "_blank";
      const inp = document.createElement("input");
      inp.type = "hidden"; inp.name = "payload"; inp.value = JSON.stringify(payload);
      form.appendChild(inp); document.body.appendChild(form); form.submit(); form.remove();
    }

    const draft = PhoneLabUI.loadDraft(WEEK);
    if (draft){
      studentIdEl.value   = draft.studentId || "";
      nameSurnameEl.value = draft.nameSurname || "";
      emailEl.value       = draft.email || "";
      dataEl.value        = draft.data || defaultData;
      codeEl.value        = draft.code || starterCode;
      outEl.textContent   = draft.output || 'Click "â–¶ Run Python" to see output here.';
      statusEl.textContent = "Draft loaded.";
    } else {
      dataEl.value = defaultData;
      codeEl.value = starterCode;
    }

    [studentIdEl, nameSurnameEl, emailEl, dataEl, codeEl].forEach(el =>
      el.addEventListener("input", save));

    document.getElementById("runBtn").addEventListener("click", async () => {
      statusEl.textContent = "Loading Python runtimeâ€¦";
      const dataLiteral = JSON.stringify(dataEl.value);
      const codeToRun = `DATA = ${dataLiteral}\n\n` + codeEl.value;
      try {
        const out = await PhoneLabUI.runPythonCapture(codeToRun);
        outEl.textContent = out || "(no output)";
        statusEl.textContent = "âœ… Run complete.";
        save();
      } catch (e) {
        outEl.textContent = String(e);
        statusEl.textContent = "âŒ Error â€” check your code.";
        save();
      }
    });

    document.getElementById("submitBtn").addEventListener("click", () => {
      const studentId   = studentIdEl.value.trim();
      const nameSurname = nameSurnameEl.value.trim();
      const email       = emailEl.value.trim().toLowerCase();

      if (!/^\d{6,12}$/.test(studentId))
        { statusEl.textContent = "Student ID must be 6â€“12 digits."; return; }
      if (nameSurname.split(/\s+/).filter(Boolean).length < 2)
        { statusEl.textContent = "Enter Name and Surname."; return; }
      if (!/^[A-Za-z0-9._%+-]+@istun\.edu\.tr$/.test(email))
        { statusEl.textContent = "Email must be @istun.edu.tr"; return; }

      if (new Date() > DEADLINE) {
        statusEl.textContent = "â° Submission closed â€” deadline was Apr 22, 23:59.";
        return;
      }

      if (dataEl.value.replace(/\s+/g,"") === defaultData.replace(/\s+/g,"")) {
        statusEl.textContent = "âš ï¸ Enter YOUR OWN songs â€” default values are not accepted.";
        dataEl.style.outline = "2px solid #ef4444";
        setTimeout(() => dataEl.style.outline = "", 3000);
        return;
      }

      if (!outEl.textContent || outEl.textContent.includes("Click") || outEl.textContent === "(no output)")
        { statusEl.textContent = "âš ï¸ Run your code first before submitting."; return; }

      const payload = {
        week: WEEK, studentId, nameSurname, email,
        data: dataEl.value, code: codeEl.value, output: outEl.textContent,
        userAgent: navigator.userAgent, submittedAt: new Date().toISOString()
      };
      statusEl.textContent = "Submittingâ€¦";
      submitViaForm(payload);
      PhoneLabUI.setStatus(WEEK, "submitted");
    });

    const helpModal = document.getElementById("helpModal");
    document.getElementById("helpBtn").addEventListener("click", () => helpModal.style.display = "flex");
    document.getElementById("closeHelpBtn").addEventListener("click", () => helpModal.style.display = "none");
    helpModal.addEventListener("click", e => { if (e.target === helpModal) helpModal.style.display = "none"; });
    document.addEventListener("keydown", e => { if (e.key === "Escape") helpModal.style.display = "none"; });
  </script>
</body>
</html>
