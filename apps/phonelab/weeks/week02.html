<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week 02 â€” PhoneLab</title>
  <link rel="stylesheet" href="../assets/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">Week 02 â€” Noise Compliance Checker</div>
      <div class="brand-sub"><a href="../index.html">â† Back to PhoneLab Hub</a></div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h1 style="margin:0 0 4px;">ğŸ”Š Workplace Noise Compliance Checker</h1>
      <p class="muted" style="margin:0 0 12px;">
        Does your environment pass <em>industrial safety standards</em>?
        Measure noise at 4 locations and build an automated compliance inspector.
      </p>

      <div class="concepts-box">
        <b>ğŸ“š Concepts you'll practice (from Week 02):</b>
        <span class="concept-tag">if / elif / else</span>
        <span class="concept-tag">comparison (&lt; &gt; == !=)</span>
        <span class="concept-tag">and / or / not</span>
        <span class="concept-tag">boolean variables</span>
        <span class="concept-tag">nested if</span>
      </div>

      <!-- Step indicator -->
      <div class="steps" style="margin-top:14px;">
        <div class="step-pill active" data-step="1">â‘  Identity</div>
        <div class="step-pill" data-step="2">â‘¡ Data</div>
        <div class="step-pill" data-step="3">â‘¢ Code</div>
        <div class="step-pill" data-step="4">â‘£ Run & Submit</div>
      </div>

      <details open id="sec1">
        <summary><b>1) Identity</b> <span class="muted">(required)</span></summary>
        <div class="row">
          <div>
            <label>Student ID (6â€“12 digits)</label>
            <input id="studentId" inputmode="numeric" minlength="6" maxlength="12"
                   pattern="^\d{6,12}$" required placeholder="e.g., 202612345" />
          </div>
          <div>
            <label>Name Surname</label>
            <input id="nameSurname" required placeholder="e.g., Arif Solmaz" />
          </div>
        </div>
        <label>Email (@istun.edu.tr)</label>
        <input id="email" type="email"
               pattern="^[A-Za-z0-9._%+-]+@istun\.edu\.tr$"
               required placeholder="name@istun.edu.tr" />
        <small class="hint">Draft auto-saves on this device.</small>
      </details>

      <hr />

      <details open id="sec2">
        <summary><b>2) Collect your data</b> <span class="muted">(from your phone)</span></summary>

        <div class="scenario-box">
          <b>ğŸ”¬ What to do:</b>
          <ol class="muted" style="margin:6px 0 0; padding-left:20px;">
            <li>Install a free <b>sound level meter (dB) app</b> on your phone
              (<a href="https://apps.apple.com/app/niosh-sound-level-meter/id1096545820" target="_blank">iOS â€” NIOSH SLM</a> /
               <a href="https://play.google.com/store/apps/details?id=com.gamebasic.decibel" target="_blank">Android â€” Sound Meter</a>).
            </li>
            <li>Measure noise (in <b>dB</b>) at <b>4 different locations</b>:
              <ul style="margin-top:4px;">
                <li><b>Location 1:</b> Your study desk / bedroom (quiet spot)</li>
                <li><b>Location 2:</b> Kitchen / living room</li>
                <li><b>Location 3:</b> Near a window or balcony (outdoor noise)</li>
                <li><b>Location 4:</b> Near a speaker, TV, or noisy appliance (loud spot)</li>
              </ul>
            </li>
            <li>Hold your phone at <b>ear height</b> and wait <b>10 seconds</b> for the reading to stabilize.</li>
            <li>Enter the 4 readings below.</li>
          </ol>
          <small>ğŸ’¡ <b>Reference:</b> Whisper â‰ˆ 30 dB, conversation â‰ˆ 60 dB, vacuum â‰ˆ 75 dB, concert â‰ˆ 100 dB. OSHA danger threshold = <b>85 dB</b>.</small>
        </div>

        <label>Your measurements (edit the numbers)</label>
        <textarea id="dataBox" spellcheck="false"></textarea>
        <small class="hint">âš ï¸ Change the numbers to <b>your own</b> readings. Default values will be rejected.</small>
      </details>

      <hr />

      <details id="sec3">
        <summary><b>3) Python code</b> <span class="muted">(write the if/elif/else logic)</span></summary>
        <label>Python â€” build the compliance classifier</label>
        <textarea id="codeBox" class="codebox" spellcheck="false"></textarea>
        <small class="hint">
          Use <b>if/elif/else</b> to classify each reading by OSHA standard.
          Combine with <b>and/or/not</b> for the compliance verdict.
        </small>
      </details>

      <hr />

      <details id="sec4">
        <summary><b>4) Output</b> <span class="muted">(auto-captured after Run)</span></summary>
        <pre id="output" class="out">Click "â–¶ Run Python" to see output here.</pre>
      </details>

      <div class="stickybar">
        <div class="bar-actions">
          <button id="helpBtn" class="helpbtn" type="button">?</button>
          <button id="runBtn" type="button">â–¶ Run Python</button>
          <button id="submitBtn" class="primary" type="button">Submit âœ“</button>
        </div>
        <small id="status" class="hint"></small>
      </div>
    </section>
  </main>

  <!-- Help Modal -->
  <div id="helpModal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>ğŸ”Š Week 02 â€” Instructions</h3>
      <ol class="muted">
        <li><b>Identity:</b> Student ID (6â€“12 digits), Name Surname, <b>@istun.edu.tr</b> email.</li>
        <li><b>Get a dB meter app:</b> Search "sound meter" or "decibel" in your app store. The NIOSH SLM app (iOS) is recommended for accuracy.</li>
        <li><b>Measure:</b> Record noise in dB at 4 locations â€” one quiet, one moderate, one with outdoor noise, one near something loud.</li>
        <li><b>Enter data:</b> Type your 4 dB readings into the Data box.</li>
        <li><b>Write code:</b> Complete the TODO lines â€” classify each reading and combine with boolean logic.</li>
        <li><b>Run:</b> Tap "â–¶ Run Python" and check the compliance report.</li>
        <li><b>Submit:</b> One submission only. Confirmation opens in a new tab.</li>
      </ol>
      <p class="muted" style="margin-top:10px;">
        <b>ğŸ“ The engineering:</b> OSHA (Occupational Safety &amp; Health Administration) sets
        <b>85 dB</b> as the maximum safe level for 8-hour exposure. Every +3 dB doubles the
        sound energy and halves the safe exposure time. Factory engineers must classify
        zones exactly like you're doing here!
      </p>
      <div class="modal-actions">
        <button id="closeHelpBtn" type="button">Got it</button>
      </div>
    </div>
  </div>

  <script src="../assets/app.js"></script>
  <script>
    const WEEK = "week02";
    const DEADLINE = new Date("2026-02-25T23:59:00+03:00");

    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxu_JAL7pMXz_7bSGC7kIYvs76UGJji8ubbmr6h7rnLY-M2deKSubTxTiekeKecMclC/exec";

    const studentIdEl   = document.getElementById("studentId");
    const nameSurnameEl = document.getElementById("nameSurname");
    const emailEl       = document.getElementById("email");
    const dataEl        = document.getElementById("dataBox");
    const codeEl        = document.getElementById("codeBox");
    const outEl         = document.getElementById("output");
    const statusEl      = document.getElementById("status");

    // â”€â”€ Default data â”€â”€
    const defaultData =
`desk_dB=42
kitchen_dB=58
outdoor_dB=72
speaker_dB=88`;

    // â”€â”€ Starter code: ONLY Week 02 concepts â”€â”€
    // if/elif/else, comparisons, and/or/not, boolean variables
    // NO lists, NO loops, NO functions, NO dicts
    const starterCode =
`# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Week 02 â€” Workplace Noise Compliance Checker
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# DATA is a string with your 4 dB readings.
# The lines below read them into variables.

_lines = DATA.strip().split("\\n")
desk_dB    = float(_lines[0].split("=")[1])
kitchen_dB = float(_lines[1].split("=")[1])
outdoor_dB = float(_lines[2].split("=")[1])
speaker_dB = float(_lines[3].split("=")[1])

print("=" * 50)
print("ğŸ”Š NOISE COMPLIANCE REPORT")
print("=" * 50)
print(f"Location 1 (Desk)    : {desk_dB:.0f} dB")
print(f"Location 2 (Kitchen) : {kitchen_dB:.0f} dB")
print(f"Location 3 (Outdoor) : {outdoor_dB:.0f} dB")
print(f"Location 4 (Speaker) : {speaker_dB:.0f} dB")
print("-" * 50)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# OSHA Noise Exposure Standards:
#   < 70 dB  â†’ SAFE       (no risk, even for long periods)
#  70â€“84 dB  â†’ CAUTION    (safe for short periods, monitor exposure)
#  85â€“99 dB  â†’ HAZARDOUS  (hearing protection required!)
#   â‰¥ 100 dB â†’ DANGEROUS  (immediate hearing damage risk!)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# TODO 1: Classify DESK noise level
if desk_dB < 70:
    desk_status = "âœ… SAFE"
elif desk_dB < 85:
    desk_status = "ğŸŸ¡ CAUTION"
elif desk_dB < 100:
    desk_status = "ğŸ”´ HAZARDOUS"
else:
    desk_status = "ğŸš¨ DANGEROUS"

print(f"Desk       : {desk_status}")

# TODO 2: Classify KITCHEN noise level
if kitchen_dB < 70:
    kitchen_status = "âœ… SAFE"
elif kitchen_dB < 85:
    kitchen_status = "ğŸŸ¡ CAUTION"
elif kitchen_dB < 100:
    kitchen_status = "ğŸ”´ HAZARDOUS"
else:
    kitchen_status = "ğŸš¨ DANGEROUS"

print(f"Kitchen    : {kitchen_status}")

# TODO 3: Classify OUTDOOR noise level
if outdoor_dB < 70:
    outdoor_status = "âœ… SAFE"
elif outdoor_dB < 85:
    outdoor_status = "ğŸŸ¡ CAUTION"
elif outdoor_dB < 100:
    outdoor_status = "ğŸ”´ HAZARDOUS"
else:
    outdoor_status = "ğŸš¨ DANGEROUS"

print(f"Outdoor    : {outdoor_status}")

# TODO 4: Classify SPEAKER noise level
if speaker_dB < 70:
    speaker_status = "âœ… SAFE"
elif speaker_dB < 85:
    speaker_status = "ğŸŸ¡ CAUTION"
elif speaker_dB < 100:
    speaker_status = "ğŸ”´ HAZARDOUS"
else:
    speaker_status = "ğŸš¨ DANGEROUS"

print(f"Speaker    : {speaker_status}")

print("-" * 50)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 5: Create BOOLEAN variables for each location
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# A location is "safe" if it's below 85 dB (OSHA 8-hour limit)

desk_safe    = desk_dB < 85
kitchen_safe = kitchen_dB < 85
outdoor_safe = outdoor_dB < 85
speaker_safe = speaker_dB < 85

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 6: Combine with AND / OR / NOT
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Are ALL locations safe?
all_safe = desk_safe and kitchen_safe and outdoor_safe and speaker_safe

# Is ANY location hazardous (â‰¥ 85 dB)?
any_hazardous = not desk_safe or not kitchen_safe or not outdoor_safe or not speaker_safe

# Is ANY location dangerously loud (â‰¥ 100 dB)?
any_dangerous = desk_dB >= 100 or kitchen_dB >= 100 or outdoor_dB >= 100 or speaker_dB >= 100

# Would an 8-hour work shift here be safe?
# (all locations must be under 85 dB AND no area above 70 dB for prolonged use)
shift_safe = all_safe and desk_dB < 70

print(f"All locations safe     : {all_safe}")
print(f"Any hazardous (â‰¥85dB)  : {any_hazardous}")
print(f"Any dangerous (â‰¥100dB) : {any_dangerous}")
print(f"Safe for 8-hour shift  : {shift_safe}")

print("-" * 50)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 7: Count how many locations are safe
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
safe_count = 0
if desk_safe:
    safe_count = safe_count + 1
if kitchen_safe:
    safe_count = safe_count + 1
if outdoor_safe:
    safe_count = safe_count + 1
if speaker_safe:
    safe_count = safe_count + 1

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 8: Find the LOUDEST reading (no max() â€” just if/else!)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loudest = desk_dB
if kitchen_dB > loudest:
    loudest = kitchen_dB
if outdoor_dB > loudest:
    loudest = outdoor_dB
if speaker_dB > loudest:
    loudest = speaker_dB

print(f"Loudest reading        : {loudest:.0f} dB")
print(f"Safe locations         : {safe_count}/4")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TODO 9: OSHA COMPLIANCE VERDICT
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("-" * 50)

if any_dangerous:
    print("ğŸš¨ OSHA VERDICT: FAIL â€” IMMEDIATE DANGER!")
    print("   Evacuate or use hearing protection NOW.")
elif any_hazardous:
    print("âš ï¸  OSHA VERDICT: PARTIAL FAIL")
    print("   Hearing protection required in loud zones.")
    if not desk_safe:
        print("   âŒ Your DESK is too loud to work at safely!")
elif not shift_safe:
    print("ğŸŸ¡ OSHA VERDICT: CONDITIONAL PASS")
    print("   Safe for short periods, not for 8-hour shifts.")
else:
    print("âœ… OSHA VERDICT: FULL COMPLIANCE")
    print("   All zones safe for extended work periods.")

print(f"   Rating: {safe_count}/4 zones compliant")
print("=" * 50)
`;

    // â”€â”€ Wiring â”€â”€
    function save(){
      PhoneLabUI.saveDraft(WEEK, {
        studentId: studentIdEl.value, nameSurname: nameSurnameEl.value,
        email: emailEl.value, data: dataEl.value, code: codeEl.value,
        output: outEl.textContent, savedAt: new Date().toISOString()
      });
      statusEl.textContent = "Draft saved.";
    }

    function submitViaForm(payload){
      const form = document.createElement("form");
      form.method = "POST"; form.action = SCRIPT_URL; form.target = "_blank";
      const inp = document.createElement("input");
      inp.type = "hidden"; inp.name = "payload"; inp.value = JSON.stringify(payload);
      form.appendChild(inp); document.body.appendChild(form); form.submit(); form.remove();
    }

    const draft = PhoneLabUI.loadDraft(WEEK);
    if (draft){
      studentIdEl.value   = draft.studentId || "";
      nameSurnameEl.value = draft.nameSurname || "";
      emailEl.value       = draft.email || "";
      dataEl.value        = draft.data || defaultData;
      codeEl.value        = draft.code || starterCode;
      outEl.textContent   = draft.output || 'Click "â–¶ Run Python" to see output here.';
      statusEl.textContent = "Draft loaded.";
    } else {
      dataEl.value = defaultData;
      codeEl.value = starterCode;
    }

    [studentIdEl, nameSurnameEl, emailEl, dataEl, codeEl].forEach(el =>
      el.addEventListener("input", save));

    document.getElementById("runBtn").addEventListener("click", async () => {
      statusEl.textContent = "Loading Python runtimeâ€¦";
      const dataLiteral = JSON.stringify(dataEl.value);
      const codeToRun = `DATA = ${dataLiteral}\n\n` + codeEl.value;
      try {
        const out = await PhoneLabUI.runPythonCapture(codeToRun);
        outEl.textContent = out || "(no output)";
        statusEl.textContent = "âœ… Run complete.";
        save();
      } catch (e) {
        outEl.textContent = String(e);
        statusEl.textContent = "âŒ Error â€” check your code.";
        save();
      }
    });

    document.getElementById("submitBtn").addEventListener("click", () => {
      const studentId   = studentIdEl.value.trim();
      const nameSurname = nameSurnameEl.value.trim();
      const email       = emailEl.value.trim().toLowerCase();

      if (!/^\d{6,12}$/.test(studentId))
        { statusEl.textContent = "Student ID must be 6â€“12 digits."; return; }
      if (nameSurname.split(/\s+/).filter(Boolean).length < 2)
        { statusEl.textContent = "Enter Name and Surname."; return; }
      if (!/^[A-Za-z0-9._%+-]+@istun\.edu\.tr$/.test(email))
        { statusEl.textContent = "Email must be @istun.edu.tr"; return; }

      // Block after deadline
      if (new Date() > DEADLINE) {
        statusEl.textContent = "â° Submission closed â€” deadline was Feb 25, 23:59.";
        return;
      }

      // Block default data
      if (dataEl.value.replace(/\s+/g,"") === defaultData.replace(/\s+/g,"")) {
        statusEl.textContent = "âš ï¸ Enter YOUR OWN dB readings â€” default values are not accepted.";
        dataEl.style.outline = "2px solid #ef4444";
        setTimeout(() => dataEl.style.outline = "", 3000);
        return;
      }

      if (!outEl.textContent || outEl.textContent.includes("Click") || outEl.textContent === "(no output)")
        { statusEl.textContent = "âš ï¸ Run your code first before submitting."; return; }

      const payload = {
        week: WEEK, studentId, nameSurname, email,
        data: dataEl.value, code: codeEl.value, output: outEl.textContent,
        userAgent: navigator.userAgent, submittedAt: new Date().toISOString()
      };
      statusEl.textContent = "Submittingâ€¦";
      submitViaForm(payload);
      PhoneLabUI.setStatus(WEEK, "submitted");
    });

    // Help modal
    const helpModal = document.getElementById("helpModal");
    document.getElementById("helpBtn").addEventListener("click", () => helpModal.style.display = "flex");
    document.getElementById("closeHelpBtn").addEventListener("click", () => helpModal.style.display = "none");
    helpModal.addEventListener("click", e => { if (e.target === helpModal) helpModal.style.display = "none"; });
    document.addEventListener("keydown", e => { if (e.key === "Escape") helpModal.style.display = "none"; });
  </script>
</body>
</html>
