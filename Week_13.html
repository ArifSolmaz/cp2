<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 13: Working with External Data | Computer Programming II</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-cream: #faf9f7;
            --bg-dark: #1a1a2e;
            --bg-code: #1e1e2e;
            --text-primary: #1a1a2e;
            --text-secondary: #444;
            --text-muted: #666;
            --accent: #7c3aed;
            --accent-light: rgba(124, 58, 237, 0.1);
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --border: #e5e5e5;
            --card-bg: #ffffff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Crimson Pro', Georgia, serif; font-size: 19px; line-height: 1.8; background: var(--bg-cream); color: var(--text-primary); }
        /* Topbar */
        .topbar { background: var(--bg-dark); color: white; padding: 0 20px; height: 48px; position: sticky; top: 0; z-index: 100; display: flex; align-items: center; justify-content: space-between; }
        .topbar a { color: white; text-decoration: none; font-family: system-ui, sans-serif; font-size: 0.85rem; opacity: 0.85; transition: opacity 0.2s; }
        .topbar a:hover { opacity: 1; }
        .home-link { white-space: nowrap; }
        .topbar-right { display: flex; align-items: center; gap: 16px; font-family: system-ui, sans-serif; font-size: 0.82rem; }
        .topbar-progress { position: absolute; bottom: 0; left: 0; height: 2px; background: linear-gradient(90deg, var(--accent), #a78bfa); transition: width 0.15s ease-out; border-radius: 0 1px 1px 0; }
        .topbar-toc-center { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); }
        .topbar-toc-current { display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 4px 14px; border-radius: 6px; transition: background 0.2s; font-family: system-ui, sans-serif; font-size: 0.82rem; color: rgba(255,255,255,0.9); user-select: none; }
        .topbar-toc-current:hover { background: rgba(255,255,255,0.08); }
        .topbar-toc-current .cur-num { opacity: 0.5; margin-right: 2px; }
        .topbar-toc-current .cur-label { max-width: 220px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .topbar-toc-current .cur-arrow { font-size: 0.6rem; opacity: 0.5; transition: transform 0.2s; }
        .topbar-toc-center.open .cur-arrow { transform: rotate(180deg); }
        .topbar-toc-dropdown { display: none; position: absolute; top: calc(100% + 8px); left: 50%; transform: translateX(-50%); background: var(--bg-dark); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; min-width: 300px; max-height: 70vh; overflow-y: auto; padding: 8px 0; box-shadow: 0 12px 40px rgba(0,0,0,0.4); }
        .topbar-toc-center.open .topbar-toc-dropdown { display: block; }
        .toc-item { display: flex; align-items: center; gap: 10px; padding: 8px 18px; font-family: system-ui, sans-serif; font-size: 0.82rem; color: rgba(255,255,255,0.6); cursor: pointer; transition: all 0.15s; text-decoration: none; }
        .toc-item:hover { background: rgba(255,255,255,0.06); color: #fff; }
        .toc-item.active { color: #a78bfa; font-weight: 600; }
        .toc-item.visited .toc-check { opacity: 1; color: #4ade80; }
        .toc-num { opacity: 0.4; min-width: 22px; }
        .toc-check { opacity: 0; font-size: 0.7rem; margin-left: auto; transition: opacity 0.3s; }
        .scroll-progress { position: fixed; bottom: 20px; right: 20px; width: 44px; height: 44px; border-radius: 50%; background: var(--bg-dark); display: flex; align-items: center; justify-content: center; font-family: system-ui, sans-serif; font-size: 0.7rem; font-weight: 600; color: rgba(255,255,255,0.9); box-shadow: 0 4px 16px rgba(0,0,0,0.2); z-index: 90; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .scroll-progress.visible { opacity: 1; }
        .scroll-progress svg { position: absolute; top: 0; left: 0; width: 44px; height: 44px; transform: rotate(-90deg); }
        .scroll-progress circle { fill: none; stroke-width: 3; }
        .scroll-progress .bg { stroke: rgba(255,255,255,0.1); }
        .scroll-progress .fg { stroke: var(--accent); stroke-linecap: round; transition: stroke-dashoffset 0.15s ease-out; }
        .run-all-btn { background: transparent; color: rgba(255,255,255,0.7); border: 1px solid rgba(255,255,255,0.2); padding: 4px 14px; border-radius: 4px; font-family: system-ui, sans-serif; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; white-space: nowrap; margin-left: 10px; }
        .run-all-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .run-all-btn.running { color: #a78bfa; border-color: rgba(124,58,237,0.4); pointer-events: none; }
        .run-all-btn.success { color: #4ade80; border-color: rgba(74,222,128,0.4); background: rgba(74,222,128,0.1); }
        .run-all-btn.failure { color: #f87171; border-color: rgba(248,113,113,0.4); background: rgba(248,113,113,0.1); }
        .code-run-status { display: inline-flex; align-items: center; gap: 5px; font-family: system-ui, sans-serif; font-size: 0.7rem; margin-left: 10px; opacity: 0; transition: opacity 0.3s; }
        .code-run-status.visible { opacity: 1; }
        .code-run-status.pass { color: #4ade80; }
        .code-run-status.fail { color: #f87171; }
        .container { max-width: 1100px; margin: 0 auto; padding: 50px 24px 80px; }
        .chapter-header { text-align: center; margin-bottom: 50px; padding-bottom: 40px; border-bottom: 2px solid var(--border); }
        .chapter-label { display: inline-block; background: var(--accent); color: white; padding: 6px 18px; border-radius: 20px; font-size: 0.85rem; font-family: system-ui, sans-serif; font-weight: 500; margin-bottom: 20px; }
        .chapter-header h1 { font-size: 2.8rem; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; }
        .chapter-meta { display: flex; justify-content: center; gap: 30px; color: var(--text-muted); font-size: 1rem; }
        .objectives-box { background: linear-gradient(135deg, var(--accent-light), rgba(124, 58, 237, 0.05)); border: 1px solid rgba(124, 58, 237, 0.2); border-left: 4px solid var(--accent); border-radius: 8px; padding: 28px; margin-bottom: 50px; }
        .objectives-box h3 { font-size: 1.2rem; margin-bottom: 16px; color: var(--accent); }
        .objectives-box ul { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px 30px; list-style: none; }
        .objectives-box li { color: var(--text-secondary); font-size: 0.95rem; padding-left: 28px; position: relative; }
        .objectives-box li::before { content: '‚úì'; position: absolute; left: 0; color: var(--success); font-weight: bold; }
        .section { margin-bottom: 60px; scroll-margin-top: 70px; }
        .section-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid var(--border); }
        .section-number { display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; background: var(--accent); color: white; border-radius: 10px; font-size: 1.2rem; font-weight: 700; font-family: system-ui, sans-serif; }
        .section-header h2 { font-size: 1.6rem; font-weight: 600; color: var(--text-primary); }
        .content p { color: var(--text-secondary); margin-bottom: 18px; }
        .content h3 { font-size: 1.25rem; font-weight: 600; margin: 35px 0 16px; color: var(--text-primary); }
        .content h4 { font-size: 1.1rem; font-weight: 600; margin: 25px 0 12px; color: var(--accent); }
        .content ul, .content ol { color: var(--text-secondary); margin: 16px 0 20px 28px; }
        .content li { margin-bottom: 8px; }
        code { font-family: 'JetBrains Mono', monospace; background: rgba(124, 58, 237, 0.1); padding: 2px 8px; border-radius: 4px; font-size: 0.85em; color: var(--accent); }
        .code-figure { background: var(--bg-code); border-radius: 10px; margin: 20px 0; overflow: hidden; border: 1px solid #333; }
        .code-figure-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 16px; background: rgba(255,255,255,0.05); border-bottom: 1px solid #333; }
        .code-figure-label { font-family: system-ui, sans-serif; font-size: 0.8rem; color: #a78bfa; font-weight: 500; }
        .code-figure-run { background: var(--success); color: white; border: none; padding: 6px 14px; border-radius: 6px; font-family: system-ui, sans-serif; font-size: 0.8rem; font-weight: 600; cursor: pointer; }
        .code-figure-run:hover { background: #047857; }
        .code-editor { width: 100%; min-height: 80px; max-height: 300px; padding: 16px; background: var(--bg-code); border: none; color: #e4e4e7; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; line-height: 1.6; resize: vertical; outline: none; overflow-y: auto; }
        .code-output { background: rgba(5, 150, 105, 0.1); border-top: 1px solid #333; padding: 14px 16px; display: none; max-height: 200px; overflow-y: auto; }
        .code-output.show { display: block; }
        .code-output-label { font-family: system-ui, sans-serif; font-size: 0.75rem; font-weight: 600; color: var(--success); text-transform: uppercase; margin-bottom: 8px; }
        .code-output-content { font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: #d4d4d8; white-space: pre-wrap; }
        
        .code-figure .code-split { display: flex; flex-direction: row; align-items: stretch; border-radius: 0 0 4px 4px; }
        .code-figure .code-split .code-input-sizer { flex: 1 1 50%; min-width: 0; display: grid; border-right: 1px solid #28283c; background: #1e1e2e; }
        .code-figure .code-split .code-input-sizer > textarea,
        .code-figure .code-split .code-input-sizer > .code-input-mirror { grid-area: 1 / 1; font-size: 0.82rem; line-height: 1.7; padding: 14px 16px; white-space: pre-wrap; word-wrap: break-word; box-sizing: border-box; font-family: 'JetBrains Mono', monospace; min-height: 60px; }
        .code-figure .code-split .code-input-sizer > textarea { resize: none; overflow: hidden; color: #e0e0e0; background: transparent; border: none; outline: none; z-index: 1; max-height: none; }
        .code-figure .code-split .code-input-sizer > .code-input-mirror { visibility: hidden; pointer-events: none; }
        .code-figure .code-split .code-output { flex: 1 1 50%; min-width: 0; border-top: none; display: block; overflow-y: auto; padding: 0; box-sizing: border-box; max-height: none; }
        .code-figure .code-split .code-output .code-output-label { display: none; }
        .code-figure .code-split .code-output .code-output-content { font-size: 0.82rem; line-height: 1.7; padding: 14px 16px; white-space: pre-wrap; word-wrap: break-word; box-sizing: border-box; font-family: 'JetBrains Mono', monospace; min-height: 60px; }
        .code-figure .code-split .code-output.show { display: block; opacity: 1; }
        .code-figure .code-split .code-output:not(.show) { display: block; opacity: 0.4; }
        .code-figure .code-split .code-output:not(.show) .code-output-content::before { content: '\2190 Click \25b6 Run to see aligned output'; color: #555; font-style: italic; }
        
        .exercise-body { padding: 0 !important; display: grid; grid-template-columns: 1fr 1fr; min-height: 280px; }
        .exercise-info-panel { padding: 24px; border-right: 1px solid var(--border); overflow-y: auto; max-height: 450px; background: rgba(249,115,22,0.02); }
        .exercise-info-panel .exercise-description { margin-bottom: 16px; }
        .exercise-info-panel .expected-output { margin: 12px 0 16px; }
        .exercise-info-panel .hints-container { margin-top: 12px; }
        .exercise-code-panel { display: flex; flex-direction: column; }
        .exercise-code-panel .code-figure { margin: 0; border: none; border-radius: 0; flex: 1; display: flex; flex-direction: column; }
        .exercise-code-panel .code-figure-header { border-radius: 0; }
        .exercise-code-panel .code-editor { flex: 1; min-height: 150px; max-height: none; resize: none; }
        .exercise-code-panel .code-output { max-height: 180px; }
        .exercise-code-panel .code-figure-caption { border-top: 1px solid #28283c; }

        @media (max-width: 900px) {
            .exercise-body { grid-template-columns: 1fr; }
            .exercise-info-panel { border-right: none; border-bottom: 1px solid var(--border); max-height: none; }
            .code-figure .code-split { flex-direction: column; }
            .code-figure .code-split .code-input-sizer { flex: none; width: 100%; border-right: none; border-bottom: 1px solid #28283c; }
            .code-figure .code-split .code-output { flex: none; width: 100%; }
        }
        .info-box { padding: 18px 24px; border-radius: 8px; margin: 24px 0; border-left: 4px solid; }
        .info-box p { margin: 0; color: var(--text-secondary); font-size: 0.95rem; }
        .tip-box { background: rgba(5, 150, 105, 0.08); border-color: var(--success); }
        .tip-box::before { content: 'üí° Tip'; display: block; font-weight: 600; color: var(--success); margin-bottom: 8px; font-size: 0.9rem; }
        .warning-box { background: rgba(217, 119, 6, 0.08); border-color: var(--warning); }
        .warning-box::before { content: '‚ö†Ô∏è Important'; display: block; font-weight: 600; color: var(--warning); margin-bottom: 8px; font-size: 0.9rem; }
        .note-box { background: rgba(124, 58, 237, 0.08); border-color: var(--accent); }
        .note-box::before { content: 'üìù Note'; display: block; font-weight: 600; color: var(--accent); margin-bottom: 8px; font-size: 0.9rem; }
        .table-container { overflow-x: auto; margin: 24px 0; border-radius: 10px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        th { background: var(--bg-dark); color: white; padding: 14px 18px; text-align: left; font-weight: 600; font-family: system-ui, sans-serif; }
        td { padding: 14px 18px; border-bottom: 1px solid var(--border); color: var(--text-secondary); }
        tr:last-child td { border-bottom: none; }
        .danger-box { padding: 18px 24px; border-radius: 8px; margin: 16px 0; border-left: 4px solid var(--danger); background: rgba(220, 38, 38, 0.05); }
        .danger-box::before { content: '‚ùå Common Mistake'; display: block; font-weight: 600; color: var(--danger); margin-bottom: 8px; font-size: 0.9rem; }
        .danger-box p { margin: 0; color: var(--text-secondary); font-size: 0.95rem; }
        .quiz-box { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; margin: 30px 0; overflow: hidden; }
        .quiz-header { padding: 14px 20px; background: linear-gradient(135deg, rgba(5,150,105,0.1), rgba(5,150,105,0.03)); border-bottom: 1px solid var(--border); font-family: system-ui, sans-serif; font-weight: 600; color: var(--success); font-size: 0.95rem; }
        .quiz-body { padding: 20px; }
        .quiz-q { margin: 12px 0; padding: 14px 18px; background: rgba(124, 58, 237, 0.03); border-radius: 8px; border: 1px solid var(--border); }
        .quiz-q strong { color: var(--accent); font-family: system-ui, sans-serif; }
        .quiz-q .answer { color: var(--accent); font-size: 0.9rem; margin-top: 8px; cursor: pointer; display: inline-block; padding: 4px 12px; border-radius: 6px; background: var(--accent-light); border: 1px solid rgba(124,58,237,0.2); font-family: system-ui, sans-serif; }
        .quiz-q .answer:hover { background: rgba(124, 58, 237, 0.15); }
        .quiz-q .answer-text { display: none; color: var(--success); margin-top: 8px; font-size: 0.93rem; padding: 10px 14px; background: rgba(5,150,105,0.06); border-radius: 6px; border-left: 3px solid var(--success); }
        .case-study-box { background: var(--card-bg); border: 2px solid rgba(124, 58, 237, 0.3); border-radius: 12px; margin: 30px 0; overflow: hidden; }
        .case-study-header { padding: 16px 20px; background: linear-gradient(135deg, rgba(124,58,237,0.12), rgba(124,58,237,0.04)); border-bottom: 1px solid rgba(124,58,237,0.2); font-family: system-ui, sans-serif; font-weight: 600; color: var(--accent); font-size: 1rem; display: flex; align-items: center; gap: 10px; }
        .case-study-body { padding: 24px; }
        .case-study-body p { color: var(--text-secondary); margin-bottom: 14px; }
        .exercise-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; margin: 28px 0; overflow: hidden; }
        .exercise-header { display: flex; justify-content: space-between; align-items: center; padding: 18px 24px; background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(124, 58, 237, 0.05)); border-bottom: 1px solid var(--border); }
        .exercise-title { font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: 12px; }
        .exercise-number { background: linear-gradient(135deg, #7c3aed, #7c3aed); color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 700; font-family: system-ui, sans-serif; }
        .difficulty { padding: 5px 14px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; font-family: system-ui, sans-serif; }
        .difficulty.easy { background: rgba(5, 150, 105, 0.12); color: var(--success); }
        .difficulty.medium { background: rgba(217, 119, 6, 0.12); color: var(--warning); }
        .difficulty.hard { background: rgba(220, 38, 38, 0.12); color: var(--danger); }
        .expected-output { background: rgba(5, 150, 105, 0.06); border: 1px solid rgba(5, 150, 105, 0.15); border-radius: 8px; padding: 16px 20px; margin: 20px 0; }
        .expected-output-label { font-size: 0.8rem; font-weight: 600; color: var(--success); text-transform: uppercase; margin-bottom: 10px; font-family: system-ui, sans-serif; }
        .expected-output pre { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: var(--text-secondary); margin: 0; background: transparent; padding: 0; }
        .hints-toggle { display: inline-flex; align-items: center; gap: 8px; padding: 10px 18px; background: var(--accent-light); border: 1px solid rgba(124, 58, 237, 0.2); border-radius: 8px; color: var(--accent); font-size: 0.9rem; cursor: pointer; font-family: inherit; }
        .hints-content { display: none; background: rgba(124, 58, 237, 0.05); border: 1px solid rgba(124, 58, 237, 0.12); border-radius: 8px; padding: 18px 24px; margin-top: 14px; }
        .hints-content.show { display: block; }
        .hints-content ul { margin: 0; padding-left: 20px; }
        .submit-section { background: var(--bg-dark); border-radius: 14px; padding: 40px; margin: 60px 0; color: white; }
        .submit-section h2 { font-size: 1.6rem; margin-bottom: 10px; color: white; }
        .submit-section > p { color: rgba(255,255,255,0.7); margin-bottom: 28px; }
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 18px; margin-bottom: 24px; }
        .form-group label { display: block; font-size: 0.85rem; font-weight: 500; margin-bottom: 8px; color: rgba(255,255,255,0.8); font-family: system-ui, sans-serif; }
        .form-group input { width: 100%; padding: 14px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-size: 1rem; font-family: inherit; }
        .form-group input:focus { outline: none; border-color: var(--accent); }
        .honeypot { position: absolute; left: -9999px; }
        .submit-btn { background: var(--accent); color: white; border: none; padding: 16px 40px; border-radius: 8px; font-size: 1.05rem; font-weight: 600; cursor: pointer; font-family: system-ui, sans-serif; }
        .submit-status { margin-top: 20px; padding: 16px 20px; border-radius: 8px; font-family: system-ui, sans-serif; display: none; }
        .week-nav { display: flex; justify-content: space-between; align-items: center; margin-top: 60px; padding: 30px 0; border-top: 1px solid #ddd; }
        .week-nav a { display: flex; flex-direction: column; text-decoration: none; color: #7c3aed; font-family: system-ui, sans-serif; font-size: 0.9rem; padding: 12px 20px; border-radius: 8px; transition: background 0.2s; max-width: 45%; }
        .week-nav a:hover { background: #f3f0ff; }
        .week-nav a .nav-direction { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: #999; margin-bottom: 4px; }
        .week-nav a .nav-title { font-weight: 600; }
        .week-nav a.nav-next { text-align: right; margin-left: auto; }
        .week-nav a.nav-prev { text-align: left; margin-right: auto; }
        .summary-box { background: linear-gradient(135deg, var(--accent-light), rgba(124, 58, 237, 0.05)); border: 1px solid rgba(124, 58, 237, 0.2); border-radius: 12px; padding: 30px; margin: 50px 0; }
        .summary-box h3 { color: var(--accent); margin-bottom: 20px; font-size: 1.3rem; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; }
        .summary-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--card-bg); border-radius: 8px; font-size: 0.95rem; }
        .file-tree { background: var(--bg-code); border-radius: 10px; padding: 20px; margin: 20px 0; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: #e4e4e7; white-space: pre; }
        @media (max-width: 700px) {
            .chapter-header h1 { font-size: 2rem; }
            .form-grid { grid-template-columns: 1fr; }
            .topbar { padding: 0 15px; }
            .topbar-toc-current .cur-label { max-width: 140px; }
            .topbar-toc-dropdown { min-width: 260px; }
            .scroll-progress { bottom: 12px; right: 14px; }
            .run-all-btn { font-size: 0.7rem; padding: 3px 10px; }
            .topbar-right span { display: none; }
        }
    </style>
</head>
<body>
    <nav class="topbar">
        <a class="home-link" href="index.html?home=true">‚Üê Course Home</a>
        <div class="topbar-toc-center" id="tocCenter">
            <div class="topbar-toc-current" onclick="document.getElementById('tocCenter').classList.toggle('open')">
                <span class="cur-num" id="tocCurNum">1.</span>
                <span class="cur-label" id="tocCurLabel">Working with CSV Files</span>
                <span class="cur-arrow">‚ñº</span>
            </div>
            <div class="topbar-toc-dropdown" id="tocDropdown"></div>
        </div>
        <div class="topbar-right">
            <button class="run-all-btn" id="runAllBtn" onclick="runAllCode()">‚ñ∂ Run All</button>
            <a href="Week_12.html">‚Üê Week 12</a>
            <a href="Week_14.html">Week 14 ‚Üí</a>
        </div>
        <div class="topbar-progress" id="topbarProgress"></div>
    </nav>

    <div class="scroll-progress" id="scrollProgress">
        <svg viewBox="0 0 44 44"><circle class="bg" cx="22" cy="22" r="19"/><circle class="fg" id="scrollCircle" cx="22" cy="22" r="19" stroke-dasharray="119.38" stroke-dashoffset="119.38"/></svg>
        <span id="scrollPct">0%</span>
    </div>
    <div class="container">
        <header class="chapter-header">
            <span class="chapter-label">Week 13</span>
            <h1>Working with External Data</h1>
            <div class="chapter-meta">
                <span>üìö Computer Programming II</span>
                <span>üë®‚Äçüè´ Dr. Arif Solmaz</span>
            </div>
        </header>
        <div class="objectives-box">
            <h3>üéØ Learning Objectives</h3>
            <ul>
                <li>Read and write CSV files for data logging</li>
                <li>Work with JSON data for configuration and APIs</li>
                <li>Parse and create XML files for data interchange</li>
                <li>Make HTTP requests to web APIs</li>
                <li>Handle API responses and errors gracefully</li>
                <li>Work with SQLite databases for data storage</li>
                <li>Validate and clean external data</li>
                <li>Build data pipelines for engineering applications</li>
            </ul>
        </div>

        <!-- Recap Quiz: Week 12 Review -->
        <section id="recap" class="section" style="scroll-margin-top: 70px;">
            <div class="section-header">
                <div class="section-number" style="background: var(--success);">üß†</div>
                <h2>Recap Quiz: Week 12 Review</h2>
            </div>
            <p>Before learning external data formats, let's check your modules and packages knowledge.</p>
            <div class="quiz-box">
                <div class="quiz-header">üß† Quick Review ‚Äî Test Your Week 12 Knowledge</div>
                <div class="quiz-body">
                    <div class="quiz-q">
                        <strong>Q1:</strong> What's the difference between a module and a package?<br>
                        <span class="answer" onclick="this.nextElementSibling.style.display='block'; this.style.display='none';">üëÅ Show Answer</span>
                        <div class="answer-text">‚úÖ A <strong>module</strong> is a single <code>.py</code> file. A <strong>package</strong> is a directory containing modules and an <code>__init__.py</code> file.</div>
                    </div>
                    <div class="quiz-q">
                        <strong>Q2:</strong> What does <code>if __name__ == "__main__":</code> do?<br>
                        <span class="answer" onclick="this.nextElementSibling.style.display='block'; this.style.display='none';">üëÅ Show Answer</span>
                        <div class="answer-text">‚úÖ Code inside this block only runs when the file is executed directly, NOT when imported as a module. It prevents test/demo code from running on import.</div>
                    </div>
                    <div class="quiz-q">
                        <strong>Q3:</strong> Why is <code>from module import *</code> discouraged?<br>
                        <span class="answer" onclick="this.nextElementSibling.style.display='block'; this.style.display='none';">üëÅ Show Answer</span>
                        <div class="answer-text">‚úÖ It imports everything into your namespace, causing name collisions and making it impossible to trace where a function came from. Use explicit imports instead.</div>
                    </div>
                    <div class="quiz-q">
                        <strong>Q4:</strong> What is a virtual environment and why use one?<br>
                        <span class="answer" onclick="this.nextElementSibling.style.display='block'; this.style.display='none';">üëÅ Show Answer</span>
                        <div class="answer-text">‚úÖ An isolated Python environment with its own packages. It prevents version conflicts between projects. Create with <code>python -m venv .venv</code>.</div>
                    </div>
                    <div class="quiz-q">
                        <strong>Q5:</strong> What happens if you name your file <code>random.py</code>?<br>
                        <span class="answer" onclick="this.nextElementSibling.style.display='block'; this.style.display='none';">üëÅ Show Answer</span>
                        <div class="answer-text">‚úÖ It shadows Python's built-in <code>random</code> module! <code>import random</code> will load YOUR file instead of the standard library, causing confusing errors.</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="content">
            <!-- Section 1: Working with CSV Files -->
            <section id="part1" class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <h2>Working with CSV Files</h2>
                </div>
                <p>CSV (Comma-Separated Values) is one of the most common data formats used in engineering and data science. Python's built-in <code>csv</code> module makes it easy to read and write CSV files. CSV files are simple, human-readable, and compatible with spreadsheet software like Excel.</p>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr><th>Method</th><th>Description</th><th>Use Case</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><code>csv.reader()</code></td><td>Read CSV as lists of values</td><td>Simple row-by-row processing</td></tr>
                            <tr><td><code>csv.writer()</code></td><td>Write lists to CSV format</td><td>Creating data logs</td></tr>
                            <tr><td><code>csv.DictReader()</code></td><td>Read CSV as dictionaries</td><td>Working with named columns</td></tr>
                            <tr><td><code>csv.DictWriter()</code></td><td>Write dictionaries to CSV</td><td>Structured data output</td></tr>
                        </tbody>
                    </table>
                </div>

                <h3>Writing CSV Data</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 1.1: Creating CSV Data</span>
                        <button class="code-figure-run" onclick="runCode('code1')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code1">import csv
from io import StringIO

# Create sample sensor data
sensor_data = [
    ['timestamp', 'sensor_id', 'temperature', 'humidity', 'pressure'],
    ['2025-01-15 10:00:00', 'SENSOR_001', 25.5, 65.2, 1013.25],
    ['2025-01-15 10:01:00', 'SENSOR_001', 25.7, 64.8, 1013.30],
    ['2025-01-15 10:02:00', 'SENSOR_001', 25.6, 65.0, 1013.28],
    ['2025-01-15 10:03:00', 'SENSOR_002', 22.3, 70.1, 1012.95],
]

# Write to a string buffer (simulates file writing)
output = StringIO()
writer = csv.writer(output)
writer.writerows(sensor_data)

# Display the CSV content
print("Generated CSV:")
print(output.getvalue())</textarea>
                    <div class="code-output" id="outputcode1">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Reading CSV with csv.reader</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 1.2: Reading CSV as Lists</span>
                        <button class="code-figure-run" onclick="runCode('code2')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code2">import csv
from io import StringIO

# Sample CSV data
csv_data = """timestamp,sensor_id,temperature,humidity
2025-01-15 10:00:00,TEMP_001,25.5,65.2
2025-01-15 10:01:00,TEMP_001,25.7,64.8
2025-01-15 10:02:00,PRES_001,25.6,65.0"""

# Read CSV data
reader = csv.reader(StringIO(csv_data))

# Get header
header = next(reader)
print(f"Columns: {header}")
print()

# Process rows
for row in reader:
    timestamp, sensor_id, temp, humidity = row
    print(f"{sensor_id}: {temp}¬∞C, {humidity}% at {timestamp}")</textarea>
                    <div class="code-output" id="outputcode2">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Using DictReader for Named Access</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 1.3: DictReader for Named Columns</span>
                        <button class="code-figure-run" onclick="runCode('code3')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code3">import csv
from io import StringIO

csv_data = """sensor_id,value,unit,timestamp
TEMP_001,25.5,celsius,2025-01-15 10:00
TEMP_001,26.0,celsius,2025-01-15 10:01
PRES_001,1013.25,hPa,2025-01-15 10:00
HUMI_001,65.2,percent,2025-01-15 10:00"""

# DictReader automatically uses first row as keys
reader = csv.DictReader(StringIO(csv_data))

print("Readings by sensor:")
for row in reader:
    print(f"  {row['sensor_id']}: {row['value']} {row['unit']}")</textarea>
                    <div class="code-output" id="outputcode3">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Writing with DictWriter</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 1.4: DictWriter for Structured Output</span>
                        <button class="code-figure-run" onclick="runCode('code4')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code4">import csv
from io import StringIO

# Sensor readings as dictionaries
readings = [
    {'sensor_id': 'TEMP_001', 'value': 25.5, 'unit': 'celsius', 'valid': True},
    {'sensor_id': 'TEMP_002', 'value': 26.0, 'unit': 'celsius', 'valid': True},
    {'sensor_id': 'PRES_001', 'value': 1013.25, 'unit': 'hPa', 'valid': True},
]

# Define fieldnames (column order)
fieldnames = ['sensor_id', 'value', 'unit', 'valid']

# Write to CSV
output = StringIO()
writer = csv.DictWriter(output, fieldnames=fieldnames)

writer.writeheader()  # Write column headers
writer.writerows(readings)  # Write all rows

print("Generated CSV with DictWriter:")
print(output.getvalue())</textarea>
                    <div class="code-output" id="outputcode4">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Engineering Example: Sensor Data Analysis</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 1.5: Analyzing CSV Sensor Data</span>
                        <button class="code-figure-run" onclick="runCode('code5')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code5">import csv
from io import StringIO
from collections import defaultdict

csv_data = """sensor_id,temperature
TEMP_001,25.5
TEMP_001,25.7
TEMP_001,25.6
TEMP_001,26.0
TEMP_002,22.1
TEMP_002,22.3
TEMP_002,22.0"""

# Group readings by sensor
sensor_readings = defaultdict(list)

reader = csv.DictReader(StringIO(csv_data))
for row in reader:
    sensor_id = row['sensor_id']
    temp = float(row['temperature'])
    sensor_readings[sensor_id].append(temp)

# Calculate statistics
print("Sensor Statistics:")
print("-" * 50)
for sensor_id, temps in sensor_readings.items():
    count = len(temps)
    min_t = min(temps)
    max_t = max(temps)
    avg_t = sum(temps) / count
    print(f"{sensor_id}:")
    print(f"  Count: {count} readings")
    print(f"  Range: {min_t:.1f}¬∞C - {max_t:.1f}¬∞C")
    print(f"  Average: {avg_t:.2f}¬∞C")</textarea>
                    <div class="code-output" id="outputcode5">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <div class="tip-box">
                    <p>Always use <code>newline=''</code> when opening files for CSV writing on Windows to prevent extra blank lines between rows!</p>
                </div>
            </section>

            <!-- Section 2: Working with JSON -->
            <section id="part2" class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <h2>Working with JSON</h2>
                </div>
                <p>JSON (JavaScript Object Notation) is widely used for APIs, configuration files, and data exchange. Python's <code>json</code> module provides easy serialization and deserialization. JSON maps directly to Python dictionaries and lists.</p>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr><th>Function</th><th>Input</th><th>Output</th><th>Use Case</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><code>json.dumps()</code></td><td>Python object</td><td>JSON string</td><td>Convert to string</td></tr>
                            <tr><td><code>json.loads()</code></td><td>JSON string</td><td>Python object</td><td>Parse string</td></tr>
                            <tr><td><code>json.dump()</code></td><td>Python object + file</td><td>Write to file</td><td>Save to disk</td></tr>
                            <tr><td><code>json.load()</code></td><td>File object</td><td>Python object</td><td>Read from disk</td></tr>
                        </tbody>
                    </table>
                </div>

                <h3>Python Dict to JSON String</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 2.1: Converting Python to JSON</span>
                        <button class="code-figure-run" onclick="runCode('code6')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code6">import json

# Python dictionary
sensor_data = {
    'sensor_id': 'TEMP_001',
    'readings': [25.5, 26.0, 25.8, 25.9],
    'metadata': {
        'location': 'Room A',
        'unit': 'celsius',
        'calibrated': True
    },
    'active': True,
    'error_count': 0
}

# Convert to JSON string with pretty formatting
json_str = json.dumps(sensor_data, indent=2)
print("JSON Output:")
print(json_str)

# Compact JSON (no whitespace)
compact = json.dumps(sensor_data, separators=(',', ':'))
print(f"\nCompact: {len(compact)} chars")</textarea>
                    <div class="code-output" id="outputcode6">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>JSON String to Python Dict</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 2.2: Parsing JSON to Python</span>
                        <button class="code-figure-run" onclick="runCode('code7')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code7">import json

# JSON string (could come from API or file)
json_string = '''
{
    "sensor_id": "PRES_001",
    "value": 1013.25,
    "unit": "hPa",
    "valid": true,
    "error": null,
    "readings": [1013.2, 1013.3, 1013.25]
}
'''

# Parse JSON to Python
data = json.loads(json_string)

print(f"Type: {type(data)}")
print(f"Sensor: {data['sensor_id']}")
print(f"Value: {data['value']} {data['unit']}")
print(f"Valid: {data['valid']}")
print(f"Readings: {data['readings']}")

# JSON null becomes Python None
print(f"Error: {data['error']} (type: {type(data['error']).__name__})")</textarea>
                    <div class="code-output" id="outputcode7">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>JSON Type Mapping</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr><th>JSON Type</th><th>Python Type</th><th>Example</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>object</td><td>dict</td><td><code>{"key": "value"}</code></td></tr>
                            <tr><td>array</td><td>list</td><td><code>[1, 2, 3]</code></td></tr>
                            <tr><td>string</td><td>str</td><td><code>"hello"</code></td></tr>
                            <tr><td>number (int)</td><td>int</td><td><code>42</code></td></tr>
                            <tr><td>number (real)</td><td>float</td><td><code>3.14</code></td></tr>
                            <tr><td>true/false</td><td>True/False</td><td><code>true</code></td></tr>
                            <tr><td>null</td><td>None</td><td><code>null</code></td></tr>
                        </tbody>
                    </table>
                </div>

                <h3>Configuration Manager with JSON</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 2.3: JSON Configuration Manager</span>
                        <button class="code-figure-run" onclick="runCode('code8')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code8">import json

class ConfigManager:
    """Manage application configuration with JSON."""
    
    def __init__(self, defaults=None):
        self.config = defaults or {}
    
    def get(self, key, default=None):
        """Get a configuration value."""
        keys = key.split('.')
        value = self.config
        for k in keys:
            if isinstance(value, dict) and k in value:
                value = value[k]
            else:
                return default
        return value
    
    def set(self, key, value):
        """Set a configuration value."""
        self.config[key] = value
    
    def to_json(self):
        """Export configuration as JSON."""
        return json.dumps(self.config, indent=2)
    
    def from_json(self, json_str):
        """Import configuration from JSON."""
        self.config = json.loads(json_str)

# Create config with defaults
config = ConfigManager({
    'sensor': {
        'sampling_rate': 1.0,
        'timeout': 30
    },
    'logging': {
        'level': 'INFO',
        'file': 'sensor.log'
    }
})

print(f"Sampling rate: {config.get('sensor.sampling_rate')}")
print(f"Log level: {config.get('logging.level')}")
print(f"\nFull config:\n{config.to_json()}")</textarea>
                    <div class="code-output" id="outputcode8">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Handling Custom Objects</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 2.4: Custom JSON Encoding</span>
                        <button class="code-figure-run" onclick="runCode('code9')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code9">import json
from datetime import datetime

class SensorReading:
    def __init__(self, sensor_id, value, timestamp=None):
        self.sensor_id = sensor_id
        self.value = value
        self.timestamp = timestamp or datetime.now()

# Custom encoder for complex objects
class SensorEncoder(json.JSONEncoder):
    def default(self, obj):
        if isinstance(obj, SensorReading):
            return {
                '__type__': 'SensorReading',
                'sensor_id': obj.sensor_id,
                'value': obj.value,
                'timestamp': obj.timestamp.isoformat()
            }
        if isinstance(obj, datetime):
            return obj.isoformat()
        return super().default(obj)

# Create readings
readings = [
    SensorReading('TEMP_001', 25.5),
    SensorReading('PRES_001', 1013.25)
]

# Encode with custom encoder
json_output = json.dumps(readings, cls=SensorEncoder, indent=2)
print("Encoded sensor readings:")
print(json_output)</textarea>
                    <div class="code-output" id="outputcode9">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <div class="warning-box">
                    <p>Remember: <code>dumps</code>/<code>loads</code> work with <strong>s</strong>trings, while <code>dump</code>/<code>load</code> work with files directly!</p>
                </div>
            </section>

            <!-- Section 3: Working with XML -->
            <section id="part3" class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <h2>Working with XML</h2>
                </div>
                <p>XML (eXtensible Markup Language) is used in many engineering applications, especially for configuration files, data interchange between systems, and industry standards like OPC-UA. Python's <code>xml.etree.ElementTree</code> module provides a simple API for parsing and creating XML.</p>

                <h3>Creating XML Elements</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 3.1: Building XML Structure</span>
                        <button class="code-figure-run" onclick="runCode('code10')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code10">import xml.etree.ElementTree as ET

# Create root element
root = ET.Element('sensors')
root.set('version', '1.0')
root.set('timestamp', '2025-01-15T10:00:00')

# Add sensor elements
sensor1 = ET.SubElement(root, 'sensor')
sensor1.set('id', 'TEMP_001')
sensor1.set('type', 'temperature')

value1 = ET.SubElement(sensor1, 'value')
value1.text = '25.5'

unit1 = ET.SubElement(sensor1, 'unit')
unit1.text = 'celsius'

# Add another sensor
sensor2 = ET.SubElement(root, 'sensor')
sensor2.set('id', 'PRES_001')
sensor2.set('type', 'pressure')

value2 = ET.SubElement(sensor2, 'value')
value2.text = '1013.25'

unit2 = ET.SubElement(sensor2, 'unit')
unit2.text = 'hPa'

# Convert to string
xml_str = ET.tostring(root, encoding='unicode')
print("Generated XML:")
print(xml_str)</textarea>
                    <div class="code-output" id="outputcode10">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Parsing XML</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 3.2: Parsing XML Data</span>
                        <button class="code-figure-run" onclick="runCode('code11')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code11">import xml.etree.ElementTree as ET

# XML data to parse
xml_string = '''
<readings timestamp="2025-01-15T10:00:00">
    <reading sensor="TEMP_001">
        <value>25.5</value>
        <unit>celsius</unit>
    </reading>
    <reading sensor="TEMP_001">
        <value>25.7</value>
        <unit>celsius</unit>
    </reading>
    <reading sensor="PRES_001">
        <value>1013.25</value>
        <unit>hPa</unit>
    </reading>
</readings>
'''

# Parse XML
root = ET.fromstring(xml_string)

# Get root attributes
print(f"Timestamp: {root.get('timestamp')}")
print()

# Find all readings
print("Parsed readings:")
for reading in root.findall('reading'):
    sensor = reading.get('sensor')
    value = float(reading.find('value').text)
    unit = reading.find('unit').text
    print(f"  {sensor}: {value} {unit}")</textarea>
                    <div class="code-output" id="outputcode11">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>XML to Dictionary Converter</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 3.3: Converting XML to Dict</span>
                        <button class="code-figure-run" onclick="runCode('code12')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code12">import xml.etree.ElementTree as ET
import json

def xml_to_dict(element):
    """Convert XML element to dictionary recursively."""
    result = {}
    
    # Add attributes with @ prefix
    for key, value in element.attrib.items():
        result[f'@{key}'] = value
    
    # Process child elements
    for child in element:
        child_data = xml_to_dict(child)
        
        # Handle multiple children with same tag
        if child.tag in result:
            if not isinstance(result[child.tag], list):
                result[child.tag] = [result[child.tag]]
            result[child.tag].append(child_data)
        else:
            result[child.tag] = child_data
    
    # If no children, use text content
    if not result and element.text:
        return element.text.strip()
    
    return result

xml_string = '''
<sensor id="TEMP_001" type="temperature">
    <value>25.5</value>
    <unit>celsius</unit>
    <config>
        <min>-40</min>
        <max>85</max>
    </config>
</sensor>
'''

root = ET.fromstring(xml_string)
sensor_dict = xml_to_dict(root)

print("XML converted to dictionary:")
print(json.dumps(sensor_dict, indent=2))</textarea>
                    <div class="code-output" id="outputcode12">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>XPath Queries</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 3.4: Using XPath for Queries</span>
                        <button class="code-figure-run" onclick="runCode('code13')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code13">import xml.etree.ElementTree as ET

xml_data = '''
<system>
    <sensors>
        <sensor id="TEMP_001" type="temperature">
            <value>25.5</value>
        </sensor>
        <sensor id="TEMP_002" type="temperature">
            <value>26.0</value>
        </sensor>
        <sensor id="PRES_001" type="pressure">
            <value>1013.25</value>
        </sensor>
    </sensors>
    <config>
        <interval>5</interval>
    </config>
</system>
'''

root = ET.fromstring(xml_data)

# Find all sensors
print("All sensors:")
for sensor in root.findall('.//sensor'):
    print(f"  {sensor.get('id')}: {sensor.get('type')}")

# Find temperature sensors only
print("\nTemperature sensors:")
for sensor in root.findall(".//sensor[@type='temperature']"):
    sid = sensor.get('id')
    value = sensor.find('value').text
    print(f"  {sid}: {value}¬∞C")

# Find specific element
interval = root.find('.//config/interval')
print(f"\nInterval: {interval.text}s")</textarea>
                    <div class="code-output" id="outputcode13">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <div class="tip-box">
                    <p>Use XPath expressions like <code>.//element</code> to find elements anywhere in the tree, and <code>[@attr='value']</code> to filter by attributes!</p>
                </div>
            </section>

            <!-- Section 4: HTTP Requests -->
            <section id="part4" class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <h2>Making HTTP Requests</h2>
                </div>
                <p>HTTP requests allow your Python programs to communicate with web APIs, fetch data from servers, and interact with web services. While the <code>requests</code> library is popular, Python's built-in <code>urllib</code> can also handle HTTP operations.</p>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr><th>Method</th><th>Description</th><th>Engineering Use Case</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><code>GET</code></td><td>Retrieve data</td><td>Fetch sensor readings from API</td></tr>
                            <tr><td><code>POST</code></td><td>Send/create data</td><td>Submit new sensor reading</td></tr>
                            <tr><td><code>PUT</code></td><td>Update existing data</td><td>Update sensor configuration</td></tr>
                            <tr><td><code>DELETE</code></td><td>Remove data</td><td>Remove old sensor from system</td></tr>
                            <tr><td><code>PATCH</code></td><td>Partial update</td><td>Update specific sensor field</td></tr>
                        </tbody>
                    </table>
                </div>

                <h3>Simulated REST API Client</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 4.1: REST API Client Pattern</span>
                        <button class="code-figure-run" onclick="runCode('code14')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code14"># Simulated REST API client (for demonstration)
import json

class MockAPIClient:
    """Simulated REST API client for sensor data."""
    
    def __init__(self, base_url):
        self.base_url = base_url
        self._data = {
            'sensors': [
                {'id': 'TEMP_001', 'value': 25.5, 'unit': 'celsius'},
                {'id': 'PRES_001', 'value': 1013.25, 'unit': 'hPa'},
            ]
        }
    
    def get(self, endpoint):
        """Simulate GET request."""
        print(f"GET {self.base_url}{endpoint}")
        
        if endpoint == '/sensors':
            return {'status': 200, 'data': self._data['sensors']}
        elif endpoint.startswith('/sensors/'):
            sensor_id = endpoint.split('/')[-1]
            for s in self._data['sensors']:
                if s['id'] == sensor_id:
                    return {'status': 200, 'data': s}
            return {'status': 404, 'error': 'Sensor not found'}
        return {'status': 404, 'error': 'Unknown endpoint'}
    
    def post(self, endpoint, data):
        """Simulate POST request."""
        print(f"POST {self.base_url}{endpoint}")
        print(f"  Body: {json.dumps(data)}")
        
        if endpoint == '/sensors':
            self._data['sensors'].append(data)
            return {'status': 201, 'data': data}
        return {'status': 400, 'error': 'Bad request'}

# Use the API client
api = MockAPIClient('http://api.sensors.io')

# GET all sensors
print("--- Fetching all sensors ---")
response = api.get('/sensors')
print(f"Response: {response}\n")

# GET specific sensor
print("--- Fetching TEMP_001 ---")
response = api.get('/sensors/TEMP_001')
print(f"Response: {response}\n")

# POST new sensor
print("--- Adding new sensor ---")
new_sensor = {'id': 'HUMI_001', 'value': 65.0, 'unit': 'percent'}
response = api.post('/sensors', new_sensor)
print(f"Response: {response}")</textarea>
                    <div class="code-output" id="outputcode14">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>API Response Handler</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 4.2: Handling API Responses</span>
                        <button class="code-figure-run" onclick="runCode('code15')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code15">class APIResponse:
    """Wrapper for API responses."""
    
    def __init__(self, status_code, data=None, error=None):
        self.status_code = status_code
        self.data = data
        self.error = error
    
    @property
    def ok(self):
        """Check if request was successful."""
        return 200 <= self.status_code < 300
    
    def json(self):
        """Return data as JSON."""
        return self.data
    
    def raise_for_status(self):
        """Raise exception if request failed."""
        if not self.ok:
            raise Exception(f"HTTP {self.status_code}: {self.error}")

def fetch_sensor_data(sensor_id):
    """Fetch sensor data with error handling."""
    # Simulate API responses
    responses = {
        'TEMP_001': APIResponse(200, {'id': 'TEMP_001', 'value': 25.5}),
        'TEMP_002': APIResponse(200, {'id': 'TEMP_002', 'value': 26.0}),
        'UNKNOWN': APIResponse(404, error='Sensor not found'),
    }
    
    return responses.get(sensor_id, APIResponse(404, error='Not found'))

# Test with different sensors
test_ids = ['TEMP_001', 'TEMP_002', 'UNKNOWN']

for sensor_id in test_ids:
    print(f"Fetching {sensor_id}...")
    response = fetch_sensor_data(sensor_id)
    
    if response.ok:
        data = response.json()
        print(f"  Success: {data}")
    else:
        print(f"  Error ({response.status_code}): {response.error}")
    print()</textarea>
                    <div class="code-output" id="outputcode15">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Retry Logic Pattern</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 4.3: Implementing Retry Logic</span>
                        <button class="code-figure-run" onclick="runCode('code16')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code16">import time
import random

def retry_request(func, max_retries=3, delay=1.0):
    """Retry a function with exponential backoff."""
    last_exception = None
    
    for attempt in range(max_retries):
        try:
            result = func()
            return result
        except Exception as e:
            last_exception = e
            wait_time = delay * (2 ** attempt)  # Exponential backoff
            print(f"  Attempt {attempt + 1} failed: {e}")
            print(f"  Retrying in {wait_time}s...")
            time.sleep(0.1)  # Short sleep for demo
    
    raise last_exception

# Simulate unreliable API
call_count = 0

def unreliable_api_call():
    """Simulates an API that fails sometimes."""
    global call_count
    call_count += 1
    
    # Succeed on 3rd attempt
    if call_count < 3:
        raise ConnectionError("Server temporarily unavailable")
    
    return {'status': 'success', 'data': {'value': 25.5}}

# Test retry logic
print("Testing retry logic:")
try:
    result = retry_request(unreliable_api_call)
    print(f"Final result: {result}")
except Exception as e:
    print(f"All retries failed: {e}")</textarea>
                    <div class="code-output" id="outputcode16">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <div class="warning-box">
                    <p>Always implement timeout and retry logic for production API clients to handle network failures gracefully!</p>
                </div>
            </section>

            <!-- Section 5: SQLite Databases -->
            <section id="part5" class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <h2>Working with SQLite Databases</h2>
                </div>
                <p>SQLite is a lightweight, serverless database included with Python. It's perfect for embedded applications, local data storage, and engineering data logging. The entire database is stored in a single file.</p>

                <h3>Database Operations</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 5.1: Simulated Database Operations</span>
                        <button class="code-figure-run" onclick="runCode('code17')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code17"># Simulated SQLite operations (actual sqlite3 not available in browser)
class MockDatabase:
    """Simulated database for demonstration."""
    
    def __init__(self, name):
        self.name = name
        self.tables = {}
        print(f"Connected to database: {name}")
    
    def create_table(self, name, columns):
        """Create a table with specified columns."""
        self.tables[name] = {'columns': columns, 'rows': []}
        print(f"Created table '{name}' with columns: {columns}")
    
    def insert(self, table, values):
        """Insert a row into a table."""
        if table in self.tables:
            row_id = len(self.tables[table]['rows']) + 1
            self.tables[table]['rows'].append((row_id, *values))
            return row_id
        raise ValueError(f"Table '{table}' not found")
    
    def select_all(self, table):
        """Get all rows from a table."""
        if table in self.tables:
            return self.tables[table]['rows']
        return []

# Create database and table
db = MockDatabase('sensors.db')
db.create_table('readings', ['id', 'sensor_id', 'value', 'unit', 'timestamp'])

# Insert data
print("\nInserting readings...")
readings = [
    ('TEMP_001', 25.5, 'celsius', '2025-01-15 10:00'),
    ('TEMP_001', 25.7, 'celsius', '2025-01-15 10:01'),
    ('PRES_001', 1013.25, 'hPa', '2025-01-15 10:00'),
]

for r in readings:
    row_id = db.insert('readings', r)
    print(f"  Inserted row {row_id}: {r[0]} = {r[1]}")

# Query data
print("\nAll readings:")
for row in db.select_all('readings'):
    print(f"  {row}")</textarea>
                    <div class="code-output" id="outputcode17">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>SQL Query Patterns</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 5.2: Common SQL Patterns</span>
                        <button class="code-figure-run" onclick="runCode('code18')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code18"># Common SQL patterns for sensor data applications
sql_patterns = {
    'Create Table': '''
CREATE TABLE IF NOT EXISTS readings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sensor_id TEXT NOT NULL,
    value REAL NOT NULL,
    unit TEXT NOT NULL,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
)''',
    
    'Insert (Parameterized)': '''
INSERT INTO readings (sensor_id, value, unit) 
VALUES (?, ?, ?)''',
    
    'Select All': '''
SELECT * FROM readings 
ORDER BY timestamp DESC''',
    
    'Select by Sensor': '''
SELECT * FROM readings 
WHERE sensor_id = ? 
ORDER BY timestamp DESC''',
    
    'Aggregate Statistics': '''
SELECT 
    sensor_id,
    COUNT(*) as reading_count,
    AVG(value) as avg_value,
    MIN(value) as min_value,
    MAX(value) as max_value
FROM readings
GROUP BY sensor_id''',
    
    'Time Range Query': '''
SELECT * FROM readings
WHERE timestamp BETWEEN ? AND ?
ORDER BY timestamp'''
}

print("Common SQL Patterns for Sensor Data:")
print("=" * 50)

for name, sql in sql_patterns.items():
    print(f"\n{name}:")
    print(sql.strip())</textarea>
                    <div class="code-output" id="outputcode18">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Database Wrapper Class</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 5.3: Sensor Database Class</span>
                        <button class="code-figure-run" onclick="runCode('code19')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code19">class SensorDatabase:
    """Database wrapper for sensor readings."""
    
    def __init__(self):
        self.readings = []
        self._id_counter = 0
    
    def add_reading(self, sensor_id, value, unit):
        """Add a new reading."""
        self._id_counter += 1
        reading = {
            'id': self._id_counter,
            'sensor_id': sensor_id,
            'value': value,
            'unit': unit
        }
        self.readings.append(reading)
        return self._id_counter
    
    def get_readings(self, sensor_id=None, limit=100):
        """Get readings, optionally filtered by sensor."""
        if sensor_id:
            result = [r for r in self.readings if r['sensor_id'] == sensor_id]
        else:
            result = self.readings
        return result[:limit]
    
    def get_statistics(self, sensor_id):
        """Calculate statistics for a sensor."""
        values = [r['value'] for r in self.readings 
                  if r['sensor_id'] == sensor_id]
        
        if not values:
            return None
        
        return {
            'sensor_id': sensor_id,
            'count': len(values),
            'min': min(values),
            'max': max(values),
            'avg': sum(values) / len(values)
        }
    
    def get_all_statistics(self):
        """Get statistics for all sensors."""
        sensor_ids = set(r['sensor_id'] for r in self.readings)
        return [self.get_statistics(sid) for sid in sensor_ids]

# Test the database wrapper
db = SensorDatabase()

# Add readings
for i in range(5):
    db.add_reading('TEMP_001', 25.0 + i * 0.2, 'celsius')

for i in range(3):
    db.add_reading('PRES_001', 1013.0 + i * 0.1, 'hPa')

# Get readings for specific sensor
print("TEMP_001 readings:")
for r in db.get_readings('TEMP_001'):
    print(f"  {r}")

# Get statistics
print("\nAll sensor statistics:")
for stats in db.get_all_statistics():
    print(f"  {stats['sensor_id']}: avg={stats['avg']:.2f}, count={stats['count']}")</textarea>
                    <div class="code-output" id="outputcode19">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <div class="warning-box">
                    <p>Always use <strong>parameterized queries</strong> (<code>?</code> placeholders) to prevent SQL injection attacks. Never concatenate user input directly into SQL strings!</p>
                </div>
            </section>

            <!-- Section 6: Data Validation -->
            <section id="part6" class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <h2>Data Validation</h2>
                </div>
                <p>Always validate external data before processing. Invalid data can cause crashes, security issues, and incorrect results. Good validation catches problems early and provides clear error messages.</p>

                <h3>Basic Validation Functions</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 6.1: Field Validation</span>
                        <button class="code-figure-run" onclick="runCode('code20')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code20">def validate_sensor_id(sensor_id):
    """Validate sensor ID format."""
    if not isinstance(sensor_id, str):
        return False, "Sensor ID must be a string"
    if len(sensor_id) < 3:
        return False, "Sensor ID too short (min 3 chars)"
    if not sensor_id.replace('_', '').isalnum():
        return False, "Sensor ID contains invalid characters"
    return True, "Valid"

def validate_temperature(value, min_val=-40, max_val=85):
    """Validate temperature reading."""
    if not isinstance(value, (int, float)):
        return False, "Temperature must be a number"
    if value < min_val or value > max_val:
        return False, f"Temperature out of range [{min_val}, {max_val}]"
    return True, "Valid"

def validate_timestamp(timestamp):
    """Validate timestamp format."""
    import re
    pattern = r'^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$'
    if not isinstance(timestamp, str):
        return False, "Timestamp must be a string"
    if not re.match(pattern, timestamp):
        return False, "Invalid format (expected: YYYY-MM-DD HH:MM:SS)"
    return True, "Valid"

# Test validation
test_cases = [
    ('TEMP_001', 25.5, '2025-01-15 10:00:00'),  # Valid
    ('T', 25.5, '2025-01-15 10:00:00'),          # Invalid ID
    ('TEMP_002', 100, '2025-01-15 10:00:00'),    # Out of range
    ('TEMP_003', 25.5, '2025/01/15'),            # Invalid timestamp
]

print("Validation Results:")
print("-" * 60)
for sensor_id, temp, ts in test_cases:
    id_ok, id_msg = validate_sensor_id(sensor_id)
    temp_ok, temp_msg = validate_temperature(temp)
    ts_ok, ts_msg = validate_timestamp(ts)
    
    status = "‚úì" if all([id_ok, temp_ok, ts_ok]) else "‚úó"
    print(f"{status} ID={sensor_id}, Temp={temp}, TS={ts}")
    if not id_ok: print(f"   ‚Üí ID: {id_msg}")
    if not temp_ok: print(f"   ‚Üí Temp: {temp_msg}")
    if not ts_ok: print(f"   ‚Üí TS: {ts_msg}")</textarea>
                    <div class="code-output" id="outputcode20">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Validation with Dataclasses</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 6.2: Structured Validation</span>
                        <button class="code-figure-run" onclick="runCode('code21')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code21">from dataclasses import dataclass, field
from typing import Optional, List

class ValidationError(Exception):
    """Raised when data validation fails."""
    pass

@dataclass
class SensorReading:
    """Validated sensor reading."""
    sensor_id: str
    value: float
    unit: str
    timestamp: Optional[str] = None
    
    def __post_init__(self):
        """Validate fields after initialization."""
        errors = []
        
        # Validate sensor_id
        if not self.sensor_id or len(self.sensor_id) < 3:
            errors.append("sensor_id must be at least 3 characters")
        
        # Validate value
        if not isinstance(self.value, (int, float)):
            errors.append("value must be a number")
        elif self.value < -1000 or self.value > 10000:
            errors.append("value out of reasonable range")
        
        # Validate unit
        valid_units = ['celsius', 'fahrenheit', 'hPa', 'percent', 'psi']
        if self.unit not in valid_units:
            errors.append(f"unit must be one of: {valid_units}")
        
        if errors:
            raise ValidationError("; ".join(errors))

# Test validation
test_data = [
    {'sensor_id': 'TEMP_001', 'value': 25.5, 'unit': 'celsius'},
    {'sensor_id': 'T', 'value': 25.5, 'unit': 'celsius'},
    {'sensor_id': 'TEMP_002', 'value': 25.5, 'unit': 'kelvin'},
]

print("Creating validated readings:")
for data in test_data:
    try:
        reading = SensorReading(**data)
        print(f"  ‚úì {reading}")
    except ValidationError as e:
        print(f"  ‚úó {data} -> {e}")</textarea>
                    <div class="code-output" id="outputcode21">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Schema Validation</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 6.3: Schema-Based Validation</span>
                        <button class="code-figure-run" onclick="runCode('code22')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code22">class SchemaValidator:
    """Validate data against a schema definition."""
    
    def __init__(self, schema):
        self.schema = schema
    
    def validate(self, data):
        """Validate data against schema."""
        errors = []
        
        # Check required fields
        for field, rules in self.schema.items():
            if rules.get('required', False) and field not in data:
                errors.append(f"Missing required field: {field}")
                continue
            
            if field not in data:
                continue
            
            value = data[field]
            
            # Type check
            expected_type = rules.get('type')
            if expected_type and not isinstance(value, expected_type):
                errors.append(f"{field}: expected {expected_type.__name__}, got {type(value).__name__}")
            
            # Range check
            if 'min' in rules and value < rules['min']:
                errors.append(f"{field}: value {value} below minimum {rules['min']}")
            if 'max' in rules and value > rules['max']:
                errors.append(f"{field}: value {value} above maximum {rules['max']}")
            
            # Allowed values
            if 'allowed' in rules and value not in rules['allowed']:
                errors.append(f"{field}: '{value}' not in allowed values {rules['allowed']}")
        
        return len(errors) == 0, errors

# Define schema
sensor_schema = {
    'sensor_id': {'required': True, 'type': str},
    'value': {'required': True, 'type': (int, float), 'min': -100, 'max': 200},
    'unit': {'required': True, 'type': str, 'allowed': ['celsius', 'hPa', 'percent']},
}

validator = SchemaValidator(sensor_schema)

# Test data
test_records = [
    {'sensor_id': 'TEMP_001', 'value': 25.5, 'unit': 'celsius'},
    {'sensor_id': 'TEMP_002', 'value': 250, 'unit': 'celsius'},
    {'value': 25.5, 'unit': 'kelvin'},
]

print("Schema Validation Results:")
for record in test_records:
    valid, errors = validator.validate(record)
    status = "‚úì" if valid else "‚úó"
    print(f"\n{status} {record}")
    for error in errors:
        print(f"   ‚Üí {error}")</textarea>
                    <div class="code-output" id="outputcode22">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <div class="tip-box">
                    <p>Validate data as early as possible - at the point of entry into your system. This prevents invalid data from propagating through your application.</p>
                </div>
            </section>

            <!-- Section 7: Data Pipelines -->
            <section id="part7" class="section">
                <div class="section-header">
                    <div class="section-number">7</div>
                    <h2>Building Data Pipelines</h2>
                </div>
                <p>A data pipeline processes data through a series of stages: extraction, transformation, validation, and loading (ETL). Well-designed pipelines are modular, testable, and handle errors gracefully.</p>

                <h3>Simple Pipeline Pattern</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 7.1: Basic Data Pipeline</span>
                        <button class="code-figure-run" onclick="runCode('code23')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code23">class DataPipeline:
    """Simple data processing pipeline."""
    
    def __init__(self):
        self.stages = []
        self.stats = {'input': 0, 'output': 0, 'errors': 0}
    
    def add_stage(self, stage_func, name=None):
        """Add a processing stage."""
        self.stages.append({
            'func': stage_func,
            'name': name or stage_func.__name__
        })
        return self
    
    def process(self, data):
        """Process data through all stages."""
        self.stats['input'] = len(data)
        results = []
        
        for item in data:
            try:
                processed = item
                for stage in self.stages:
                    processed = stage['func'](processed)
                    if processed is None:
                        break
                if processed is not None:
                    results.append(processed)
            except Exception as e:
                self.stats['errors'] += 1
                print(f"Error processing {item}: {e}")
        
        self.stats['output'] = len(results)
        return results

# Define pipeline stages
def clean_data(record):
    """Clean and normalize data."""
    record['sensor_id'] = record['sensor_id'].upper().strip()
    return record

def validate_data(record):
    """Validate record, return None if invalid."""
    if 'sensor_id' not in record or 'value' not in record:
        return None
    if not isinstance(record['value'], (int, float)):
        return None
    return record

def enrich_data(record):
    """Add computed fields."""
    record['processed'] = True
    return record

# Create and run pipeline
pipeline = DataPipeline()
pipeline.add_stage(clean_data, 'Clean')
pipeline.add_stage(validate_data, 'Validate')
pipeline.add_stage(enrich_data, 'Enrich')

# Test data
raw_data = [
    {'sensor_id': 'temp_001', 'value': 25.5},
    {'sensor_id': 'TEMP_002', 'value': 26.0},
    {'sensor_id': 'TEMP_003'},  # Missing value
    {'value': 25.5},  # Missing sensor_id
]

results = pipeline.process(raw_data)

print("Pipeline Results:")
print(f"  Input: {pipeline.stats['input']}")
print(f"  Output: {pipeline.stats['output']}")
print(f"  Errors: {pipeline.stats['errors']}")
print("\nProcessed records:")
for r in results:
    print(f"  {r}")</textarea>
                    <div class="code-output" id="outputcode23">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Pipeline with Logging</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 7.2: Pipeline with Stage Logging</span>
                        <button class="code-figure-run" onclick="runCode('code24')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code24">class LoggingPipeline:
    """Pipeline with detailed stage logging."""
    
    def __init__(self, name):
        self.name = name
        self.stages = []
        self.stage_stats = []
    
    def add_stage(self, func, name):
        """Add a processing stage."""
        self.stages.append({'func': func, 'name': name})
        return self
    
    def process(self, data):
        """Process data with logging."""
        print(f"Pipeline '{self.name}' starting with {len(data)} records")
        
        current_data = data
        
        for i, stage in enumerate(self.stages):
            input_count = len(current_data)
            
            # Process through stage
            results = []
            errors = 0
            
            for item in current_data:
                try:
                    result = stage['func'](item)
                    if result is not None:
                        results.append(result)
                except Exception as e:
                    errors += 1
            
            output_count = len(results)
            dropped = input_count - output_count - errors
            
            print(f"  Stage {i+1} [{stage['name']}]: {input_count} ‚Üí {output_count} ({dropped} dropped, {errors} errors)")
            
            current_data = results
        
        print(f"Pipeline complete: {len(current_data)} final records")
        return current_data

# Pipeline stages
def parse_value(record):
    record['value'] = float(record['value'])
    return record

def filter_range(record):
    if -50 <= record['value'] <= 100:
        return record
    return None

def add_quality(record):
    record['quality'] = 'good' if record['value'] > 0 else 'suspect'
    return record

# Build and run pipeline
pipeline = LoggingPipeline('SensorETL')
pipeline.add_stage(parse_value, 'Parse')
pipeline.add_stage(filter_range, 'Filter')
pipeline.add_stage(add_quality, 'Quality')

data = [
    {'sensor_id': 'T1', 'value': '25.5'},
    {'sensor_id': 'T2', 'value': '200'},  # Out of range
    {'sensor_id': 'T3', 'value': '-10'},
    {'sensor_id': 'T4', 'value': 'invalid'},  # Will error
]

results = pipeline.process(data)
print("\nFinal results:")
for r in results:
    print(f"  {r}")</textarea>
                    <div class="code-output" id="outputcode24">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <div class="tip-box">
                    <p>Good pipelines log statistics at each stage, making it easy to identify where data quality issues occur and monitor pipeline health!</p>
                </div>
            </section>

            <!-- Section 8: Binary Data and Serialization -->
            <section id="part8" class="section">
                <div class="section-header">
                    <div class="section-number">8</div>
                    <h2>Binary Data and Serialization</h2>
                </div>
                <p>Binary formats are more compact and faster than text formats. The <code>struct</code> module handles raw binary data, while <code>pickle</code> serializes Python objects. Binary formats are common in embedded systems and high-performance applications.</p>

                <h3>Working with struct</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 8.1: Binary Data with struct</span>
                        <button class="code-figure-run" onclick="runCode('code25')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code25">import struct

# Pack data into binary format
# Format: sensor_id (int), temperature (float), pressure (float)
sensor_id = 1
temperature = 25.5
pressure = 1013.25

# Format string: i = int (4 bytes), f = float (4 bytes)
format_str = 'iff'
binary_data = struct.pack(format_str, sensor_id, temperature, pressure)

print(f"Format: {format_str}")
print(f"Record size: {struct.calcsize(format_str)} bytes")
print(f"Packed data (hex): {binary_data.hex()}")
print(f"Packed data (bytes): {len(binary_data)} bytes")

# Unpack the binary data
unpacked = struct.unpack(format_str, binary_data)
print(f"\nUnpacked values:")
print(f"  sensor_id: {unpacked[0]}")
print(f"  temperature: {unpacked[1]:.1f}")
print(f"  pressure: {unpacked[2]:.2f}")</textarea>
                    <div class="code-output" id="outputcode25">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Format Characters Reference</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr><th>Format</th><th>C Type</th><th>Python Type</th><th>Size (bytes)</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><code>b</code></td><td>signed char</td><td>int</td><td>1</td></tr>
                            <tr><td><code>B</code></td><td>unsigned char</td><td>int</td><td>1</td></tr>
                            <tr><td><code>h</code></td><td>short</td><td>int</td><td>2</td></tr>
                            <tr><td><code>H</code></td><td>unsigned short</td><td>int</td><td>2</td></tr>
                            <tr><td><code>i</code></td><td>int</td><td>int</td><td>4</td></tr>
                            <tr><td><code>I</code></td><td>unsigned int</td><td>int</td><td>4</td></tr>
                            <tr><td><code>f</code></td><td>float</td><td>float</td><td>4</td></tr>
                            <tr><td><code>d</code></td><td>double</td><td>float</td><td>8</td></tr>
                        </tbody>
                    </table>
                </div>

                <h3>Binary Sensor Logger</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 8.2: Binary Data Logger Class</span>
                        <button class="code-figure-run" onclick="runCode('code26')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code26">import struct
import time

class BinarySensorLogger:
    """Log sensor data in compact binary format."""
    
    # Record format: timestamp (double), sensor_id (int), value (float)
    RECORD_FORMAT = 'dif'
    RECORD_SIZE = struct.calcsize(RECORD_FORMAT)
    
    def __init__(self):
        self.buffer = bytearray()
        self.record_count = 0
    
    def write(self, timestamp, sensor_id, value):
        """Write a reading to the log."""
        record = struct.pack(self.RECORD_FORMAT, timestamp, sensor_id, value)
        self.buffer.extend(record)
        self.record_count += 1
    
    def read_all(self):
        """Read all records from the log."""
        records = []
        offset = 0
        
        while offset + self.RECORD_SIZE <= len(self.buffer):
            data = self.buffer[offset:offset + self.RECORD_SIZE]
            timestamp, sensor_id, value = struct.unpack(self.RECORD_FORMAT, data)
            records.append({
                'timestamp': timestamp,
                'sensor_id': sensor_id,
                'value': value
            })
            offset += self.RECORD_SIZE
        
        return records
    
    def get_stats(self):
        """Return buffer statistics."""
        return {
            'records': self.record_count,
            'buffer_size': len(self.buffer),
            'bytes_per_record': self.RECORD_SIZE
        }

# Test the binary logger
logger = BinarySensorLogger()

# Write some readings
base_time = time.time()
for i in range(10):
    logger.write(base_time + i, 1, 25.0 + i * 0.5)

# Get statistics
stats = logger.get_stats()
print("Binary Logger Statistics:")
print(f"  Records: {stats['records']}")
print(f"  Buffer size: {stats['buffer_size']} bytes")
print(f"  Bytes per record: {stats['bytes_per_record']}")

# Compare to JSON
import json
json_size = len(json.dumps(logger.read_all()))
print(f"\nSize comparison:")
print(f"  Binary: {stats['buffer_size']} bytes")
print(f"  JSON: {json_size} bytes")
print(f"  Savings: {(1 - stats['buffer_size']/json_size)*100:.1f}%")</textarea>
                    <div class="code-output" id="outputcode26">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Data Format Summary</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr><th>Format</th><th>Module</th><th>Read</th><th>Write</th><th>Best For</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>CSV</td><td><code>csv</code></td><td><code>csv.reader()</code></td><td><code>csv.writer()</code></td><td>Tabular data, spreadsheets</td></tr>
                            <tr><td>JSON</td><td><code>json</code></td><td><code>json.load()</code></td><td><code>json.dump()</code></td><td>APIs, configs, nested data</td></tr>
                            <tr><td>XML</td><td><code>xml.etree</code></td><td><code>ET.parse()</code></td><td><code>tree.write()</code></td><td>Industry standards, complex structure</td></tr>
                            <tr><td>SQLite</td><td><code>sqlite3</code></td><td><code>cursor.fetchall()</code></td><td><code>cursor.execute()</code></td><td>Relational data, queries</td></tr>
                            <tr><td>Binary</td><td><code>struct</code></td><td><code>struct.unpack()</code></td><td><code>struct.pack()</code></td><td>Embedded systems, performance</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="warning-box">
                    <p>Never use <code>pickle</code> to load data from untrusted sources - it can execute arbitrary code! Use JSON or other safe formats for external data.</p>
                </div>
            </section>

            <!-- Summary Box -->
            <div class="summary-box">
                <h3>üìã Week 13 Summary</h3>
                <div class="summary-grid">
                    <div class="summary-item">üìÑ CSV for tabular data</div>
                    <div class="summary-item">üìã JSON for APIs and configs</div>
                    <div class="summary-item">üè∑Ô∏è XML for structured interchange</div>
                    <div class="summary-item">üåê HTTP for web APIs</div>
                    <div class="summary-item">üóÉÔ∏è SQLite for local storage</div>
                    <div class="summary-item">‚úÖ Validation for data quality</div>
                    <div class="summary-item">üîÑ Pipelines for ETL</div>
                    <div class="summary-item">üì¶ Binary for performance</div>
                </div>
            </div>

            <!-- Common Mistakes: External Data -->
            <section id="mistakes" class="section" style="scroll-margin-top: 70px;">
                <div class="section-header">
                    <div class="section-number" style="background: var(--danger);">‚ùå</div>
                    <h2>Common Mistakes to Avoid</h2>
                </div>
                <p>These are the most frequent errors students make with external data formats. Study them before the exercises!</p>
                
                <div class="danger-box">
                    <p><strong>Using <code>json.load()</code> vs <code>json.loads()</code></strong><br>
                    <code>json.load(file_object)</code> reads from a file. <code>json.loads(string)</code> parses a string. Mixing them up gives <code>TypeError</code> or <code>AttributeError</code>. Same for <code>json.dump()</code> vs <code>json.dumps()</code>.</p>
                </div>
                <div class="danger-box">
                    <p><strong>Not handling encoding when reading CSV/JSON</strong><br>
                    <code>open("data.csv")</code> uses system default encoding. Files from other systems may use UTF-8 with BOM, Latin-1, etc. Always specify: <code>open("data.csv", encoding="utf-8-sig")</code>.</p>
                </div>
                <div class="danger-box">
                    <p><strong>Assuming JSON preserves Python types</strong><br>
                    JSON has no <code>tuple</code>, <code>set</code>, or <code>datetime</code>. Tuples become lists, sets can't be serialized at all, and dates need manual conversion. Always validate after loading.</p>
                </div>
                <div class="danger-box">
                    <p><strong>Not validating external data</strong><br>
                    Data from files or APIs can be missing fields, have wrong types, or contain unexpected values. Never trust external data ‚Äî always validate before processing.</p>
                </div>
                <div class="danger-box">
                    <p><strong>Hardcoding file paths</strong><br>
                    <code>open("C:\\Users\\student\\data.csv")</code> breaks on any other machine. Use <code>os.path.join()</code> or <code>pathlib.Path()</code> for portable paths, and relative paths where possible.</p>
                </div>
            </section>

            <!-- Exercises Section -->
            <section id="exercises" class="section">
                <div class="section-header">
                    <div class="section-number">üèãÔ∏è</div>
                    <h2>Practice Exercises</h2>
                </div>

                <!-- Exercise 1 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">1</span>CSV Reader</div>
                        <span class="difficulty easy">Easy</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a function that reads CSV data and returns a list of dictionaries.</p>
                        <div class="expected-output">
                            <div class="expected-output-label">Expected Output</div>
                            <pre>Record 1: {'name': 'Alice', 'score': '95'}
Record 2: {'name': 'Bob', 'score': '87'}</pre>
                        </div>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints1')">üí° Show Hints</button>
                            <div class="hints-content" id="hints1">
                                <ul>
                                    <li>Use csv.DictReader</li>
                                    <li>Use StringIO to create a file-like object from string</li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex1')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex1">import csv
from io import StringIO

csv_data = """name,score
Alice,95
Bob,87"""

def read_csv_to_dicts(csv_string):
    # Your code here
    pass

records = read_csv_to_dicts(csv_data)
for i, record in enumerate(records, 1):
    print(f"Record {i}: {record}")</textarea>
                            <div class="code-output" id="outputex1">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 2 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">2</span>JSON Parser</div>
                        <span class="difficulty easy">Easy</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Parse JSON data and extract sensor values.</p>
                        <div class="expected-output">
                            <div class="expected-output-label">Expected Output</div>
                            <pre>TEMP_001: 25.5 celsius
PRES_001: 1013.25 hPa</pre>
                        </div>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints2')">üí° Show Hints</button>
                            <div class="hints-content" id="hints2">
                                <ul>
                                    <li>Use <code>json.loads()</code> to parse JSON string</li>
                                    <li>Access nested data: <code>data['sensors']</code></li>
                                    <li>Loop through list and access dict keys</li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex2')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex2">import json

json_data = '''
{
    "sensors": [
        {"id": "TEMP_001", "value": 25.5, "unit": "celsius"},
        {"id": "PRES_001", "value": 1013.25, "unit": "hPa"}
    ]
}
'''

# Parse and print sensor values
# Your code here
data = json.loads(json_data)
for sensor in data['sensors']:
    print(f"{sensor['id']}: {sensor['value']} {sensor['unit']}")</textarea>
                            <div class="code-output" id="outputex2">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 3 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">3</span>Data Validator</div>
                        <span class="difficulty medium">Medium</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a validate_reading function that checks sensor_id (non-empty string) and value (number in range -50 to 150).</p>
                        <div class="expected-output">
                            <div class="expected-output-label">Expected Output</div>
                            <pre>TEMP_001, 25.5: Valid
TEMP_002, 200: Invalid - value out of range
, 25.5: Invalid - missing sensor_id</pre>
                        </div>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints3')">üí° Show Hints</button>
                            <div class="hints-content" id="hints3">
                                <ul>
                                    <li>Check if sensor_id exists and is non-empty</li>
                                    <li>Use isinstance() to check if value is a number</li>
                                    <li>Return tuple of (is_valid, message)</li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex3')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex3">def validate_reading(sensor_id, value):
    """Validate sensor reading. Returns (is_valid, message)."""
    # Your code here
    if not sensor_id:
        return False, "missing sensor_id"
    if not isinstance(value, (int, float)):
        return False, "value must be a number"
    if value < -50 or value > 150:
        return False, "value out of range"
    return True, "Valid"

# Test cases
test_cases = [
    ('TEMP_001', 25.5),
    ('TEMP_002', 200),
    ('', 25.5),
]

for sensor_id, value in test_cases:
    valid, msg = validate_reading(sensor_id, value)
    print(f"{sensor_id}, {value}: {msg}")</textarea>
                            <div class="code-output" id="outputex3">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 4 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">4</span>Simple Database</div>
                        <span class="difficulty medium">Medium</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a SimpleDB class with insert, select_all, and select_by_sensor methods.</p>
                        <div class="expected-output">
                            <div class="expected-output-label">Expected Output</div>
                            <pre>Inserted 3 records
All: 3 records
TEMP_001: 2 records</pre>
                        </div>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints4')">üí° Show Hints</button>
                            <div class="hints-content" id="hints4">
                                <ul>
                                    <li>Store records in <code>self.records = []</code></li>
                                    <li>insert: append dict with auto-increment id</li>
                                    <li>select_by_sensor: filter with list comprehension</li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex4')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex4">class SimpleDB:
    def __init__(self):
        self.records = []
        self._id = 0
    
    def insert(self, sensor_id, value, unit):
        self._id += 1
        self.records.append({
            'id': self._id,
            'sensor_id': sensor_id,
            'value': value,
            'unit': unit
        })
        return self._id
    
    def select_all(self):
        return self.records
    
    def select_by_sensor(self, sensor_id):
        return [r for r in self.records if r['sensor_id'] == sensor_id]

# Test
db = SimpleDB()
db.insert('TEMP_001', 25.5, 'celsius')
db.insert('TEMP_001', 25.7, 'celsius')
db.insert('PRES_001', 1013.25, 'hPa')

print(f"Inserted 3 records")
print(f"All: {len(db.select_all())} records")
print(f"TEMP_001: {len(db.select_by_sensor('TEMP_001'))} records")</textarea>
                            <div class="code-output" id="outputex4">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 5 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">5</span>CSV Statistics</div>
                        <span class="difficulty medium">Medium</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Calculate min, max, and average from CSV temperature data.</p>
                        <div class="expected-output">
                            <div class="expected-output-label">Expected Output</div>
                            <pre>Statistics: min=22.1, max=26.0, avg=24.50</pre>
                        </div>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints5')">üí° Show Hints</button>
                            <div class="hints-content" id="hints5">
                                <ul>
                                    <li>Extract values: <code>[float(row['temp']) for row in reader]</code></li>
                                    <li>Use <code>min()</code>, <code>max()</code>, <code>sum()/len()</code></li>
                                    <li>Return dict with min, max, avg keys</li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex5')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex5">import csv
from io import StringIO

csv_data = """sensor,temperature
T1,25.5
T1,26.0
T2,22.1
T2,24.5"""

def calculate_stats(csv_string):
    reader = csv.DictReader(StringIO(csv_string))
    temps = [float(row['temperature']) for row in reader]
    return {
        'min': min(temps),
        'max': max(temps),
        'avg': sum(temps) / len(temps)
    }

stats = calculate_stats(csv_data)
print(f"Statistics: min={stats['min']}, max={stats['max']}, avg={stats['avg']:.2f}")</textarea>
                            <div class="code-output" id="outputex5">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 6 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">6</span>JSON Configuration</div>
                        <span class="difficulty medium">Medium</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a Config class that loads settings from JSON and provides get/set methods.</p>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints6')">üí° Show Hints</button>
                            <div class="hints-content" id="hints6">
                                <ul>
                                    <li>__init__: <code>self.data = json.loads(json_str)</code></li>
                                    <li>get: <code>return self.data.get(key, default)</code></li>
                                    <li>to_json: <code>json.dumps(self.data, indent=2)</code></li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex6')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex6">import json

class Config:
    def __init__(self, json_str=None):
        self.data = json.loads(json_str) if json_str else {}
    
    def get(self, key, default=None):
        return self.data.get(key, default)
    
    def set(self, key, value):
        self.data[key] = value
    
    def to_json(self):
        return json.dumps(self.data, indent=2)

# Test
config = Config('{"debug": true, "timeout": 30}')
print(f"Debug: {config.get('debug')}")
print(f"Timeout: {config.get('timeout')}")
config.set('version', '1.0')
print(f"Config:\n{config.to_json()}")</textarea>
                            <div class="code-output" id="outputex6">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 7 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">7</span>XML Parser</div>
                        <span class="difficulty medium">Medium</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Parse XML and extract sensor readings into a list of dictionaries.</p>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints7')">üí° Show Hints</button>
                            <div class="hints-content" id="hints7">
                                <ul>
                                    <li>Parse: <code>ET.fromstring(xml_string)</code></li>
                                    <li>Find elements: <code>root.findall('sensor')</code></li>
                                    <li>Get attribute: <code>sensor.get('id')</code></li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex7')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex7">import xml.etree.ElementTree as ET

xml_data = '''
<sensors>
    <sensor id="T1"><value>25.5</value></sensor>
    <sensor id="T2"><value>26.0</value></sensor>
</sensors>
'''

def parse_sensors(xml_string):
    root = ET.fromstring(xml_string)
    readings = []
    for sensor in root.findall('sensor'):
        readings.append({
            'id': sensor.get('id'),
            'value': float(sensor.find('value').text)
        })
    return readings

sensors = parse_sensors(xml_data)
for s in sensors:
    print(f"{s['id']}: {s['value']}")</textarea>
                            <div class="code-output" id="outputex7">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 8 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">8</span>Binary Packer</div>
                        <span class="difficulty medium">Medium</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Use struct to pack and unpack sensor data (id: int, value: float, status: byte).</p>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints8')">üí° Show Hints</button>
                            <div class="hints-content" id="hints8">
                                <ul>
                                    <li>Format string: 'i'=int, 'f'=float, 'B'=byte</li>
                                    <li>Pack: <code>struct.pack(FORMAT, id, val, stat)</code></li>
                                    <li>Unpack: <code>struct.unpack(FORMAT, data)</code></li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex8')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex8">import struct

# Format: int (4 bytes), float (4 bytes), byte (1 byte)
FORMAT = 'ifB'

def pack_reading(sensor_id, value, status):
    return struct.pack(FORMAT, sensor_id, value, status)

def unpack_reading(data):
    return struct.unpack(FORMAT, data)

# Pack data
packed = pack_reading(1, 25.5, 1)
print(f"Packed size: {len(packed)} bytes")
print(f"Packed (hex): {packed.hex()}")

# Unpack data
sid, val, stat = unpack_reading(packed)
print(f"Unpacked: id={sid}, value={val}, status={stat}")</textarea>
                            <div class="code-output" id="outputex8">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 9 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">9</span>Data Pipeline</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a data pipeline that validates, cleans, and transforms sensor readings.</p>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints9')">üí° Show Hints</button>
                            <div class="hints-content" id="hints9">
                                <ul>
                                    <li>Clean: uppercase sensor_id, convert value to float</li>
                                    <li>Validate: check sensor_id exists, value in range</li>
                                    <li>Transform: add processed flag and timestamp</li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex9')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex9">class DataPipeline:
    def __init__(self):
        self.stats = {'input': 0, 'output': 0, 'dropped': 0}
    
    def clean(self, record):
        record['sensor_id'] = record.get('sensor_id', '').upper()
        try:
            record['value'] = float(record.get('value', 0))
        except:
            record['value'] = None
        return record
    
    def validate(self, record):
        if not record['sensor_id']:
            return None
        if record['value'] is None or record['value'] < -50 or record['value'] > 150:
            return None
        return record
    
    def transform(self, record):
        record['processed'] = True
        return record
    
    def process(self, data):
        self.stats['input'] = len(data)
        results = []
        for item in data:
            item = self.clean(item)
            item = self.validate(item)
            if item:
                item = self.transform(item)
                results.append(item)
            else:
                self.stats['dropped'] += 1
        self.stats['output'] = len(results)
        return results

# Test
pipeline = DataPipeline()
data = [
    {'sensor_id': 'temp_001', 'value': '25.5'},
    {'sensor_id': 'temp_002', 'value': 200},
    {'sensor_id': '', 'value': 25},
]

results = pipeline.process(data)
print(f"Input: {pipeline.stats['input']}, Output: {pipeline.stats['output']}, Dropped: {pipeline.stats['dropped']}")
for r in results:
    print(f"  {r}")</textarea>
                            <div class="code-output" id="outputex9">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 10 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">10</span>API Client</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a mock API client with GET and POST methods and error handling.</p>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints10')">üí° Show Hints</button>
                            <div class="hints-content" id="hints10">
                                <ul>
                                    <li>Store data in <code>self.data = []</code></li>
                                    <li>GET: check endpoint and return matching data</li>
                                    <li>Return dict with 'status' and 'data' or 'error'</li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex10')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex10">class MockAPI:
    def __init__(self):
        self.data = [
            {'id': 'T1', 'value': 25.5},
            {'id': 'T2', 'value': 26.0}
        ]
    
    def get(self, endpoint):
        if endpoint == '/sensors':
            return {'status': 200, 'data': self.data}
        elif endpoint.startswith('/sensors/'):
            sid = endpoint.split('/')[-1]
            for s in self.data:
                if s['id'] == sid:
                    return {'status': 200, 'data': s}
            return {'status': 404, 'error': 'Not found'}
        return {'status': 400, 'error': 'Bad request'}
    
    def post(self, endpoint, data):
        if endpoint == '/sensors':
            self.data.append(data)
            return {'status': 201, 'data': data}
        return {'status': 400, 'error': 'Bad request'}

# Test
api = MockAPI()

# GET all
resp = api.get('/sensors')
print(f"GET /sensors: {resp['status']}, {len(resp['data'])} sensors")

# GET one
resp = api.get('/sensors/T1')
print(f"GET /sensors/T1: {resp}")

# POST new
resp = api.post('/sensors', {'id': 'T3', 'value': 27.0})
print(f"POST: {resp['status']}, added {resp['data']}")</textarea>
                            <div class="code-output" id="outputex10">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 11 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">11</span>Schema Validator</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Implement a schema validator that checks required fields, types, and value ranges.</p>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints11')">üí° Show Hints</button>
                            <div class="hints-content" id="hints11">
                                <ul>
                                    <li>Schema: dict of field names to rules</li>
                                    <li>Check required, type with <code>isinstance()</code></li>
                                    <li>Return tuple: <code>(is_valid, error_list)</code></li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex11')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex11">class SchemaValidator:
    def __init__(self, schema):
        self.schema = schema
    
    def validate(self, data):
        errors = []
        for field, rules in self.schema.items():
            # Check required
            if rules.get('required') and field not in data:
                errors.append(f"Missing: {field}")
                continue
            if field not in data:
                continue
            
            value = data[field]
            
            # Check type
            if 'type' in rules and not isinstance(value, rules['type']):
                errors.append(f"{field}: wrong type")
            
            # Check range
            if 'min' in rules and value < rules['min']:
                errors.append(f"{field}: below min")
            if 'max' in rules and value > rules['max']:
                errors.append(f"{field}: above max")
        
        return len(errors) == 0, errors

# Test
schema = {
    'sensor_id': {'required': True, 'type': str},
    'value': {'required': True, 'type': (int, float), 'min': -50, 'max': 150}
}

validator = SchemaValidator(schema)

test_data = [
    {'sensor_id': 'T1', 'value': 25.5},
    {'sensor_id': 'T2', 'value': 200},
    {'value': 25.5},
]

for data in test_data:
    valid, errors = validator.validate(data)
    print(f"{data}: {'‚úì' if valid else '‚úó ' + str(errors)}")</textarea>
                            <div class="code-output" id="outputex11">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Exercise 12 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">12</span>Data Converter</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create functions to convert between CSV, JSON, and XML formats.</p>
                        <div class="hints-container">
                            <button class="hints-toggle" onclick="toggleHints('hints12')">üí° Show Hints</button>
                            <div class="hints-content" id="hints12">
                                <ul>
                                    <li>CSV to JSON: DictReader ‚Üí list ‚Üí json.dumps</li>
                                    <li>JSON to CSV: json.loads ‚Üí DictWriter</li>
                                    <li>Use StringIO for string ‚Üî file conversion</li>
                                </ul>
                            </div>
                        </div></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('ex12')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="ex12">import csv
import json
import xml.etree.ElementTree as ET
from io import StringIO

def csv_to_json(csv_str):
    reader = csv.DictReader(StringIO(csv_str))
    return json.dumps(list(reader), indent=2)

def json_to_csv(json_str, fieldnames):
    data = json.loads(json_str)
    output = StringIO()
    writer = csv.DictWriter(output, fieldnames=fieldnames)
    writer.writeheader()
    writer.writerows(data)
    return output.getvalue()

# Test CSV to JSON
csv_data = """id,value
T1,25.5
T2,26.0"""

json_output = csv_to_json(csv_data)
print("CSV to JSON:")
print(json_output)

# Test JSON to CSV
json_data = '[{"id": "T1", "value": 25.5}, {"id": "T2", "value": 26.0}]'
csv_output = json_to_csv(json_data, ['id', 'value'])
print("\nJSON to CSV:")
print(csv_output)</textarea>
                            <div class="code-output" id="outputex12">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>
            </section>


            <!-- Section 9: Advanced Data Patterns -->
            <section id="part9" class="section">
                <div class="section-header">
                    <div class="section-number">9</div>
                    <h2>Advanced Data Patterns</h2>
                </div>
                <p>Advanced patterns for building robust, scalable data processing systems in engineering applications.</p>

                <h3>Repository Pattern</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 9.1: Repository Pattern</span>
                        <button class="code-figure-run" onclick="runCode('code27')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code27">from abc import ABC, abstractmethod

class SensorRepository(ABC):
    """Abstract repository for sensor data."""
    
    @abstractmethod
    def add(self, reading):
        pass
    
    @abstractmethod
    def get_by_id(self, sensor_id):
        pass
    
    @abstractmethod
    def get_all(self):
        pass

class MemoryRepository(SensorRepository):
    """In-memory implementation."""
    
    def __init__(self):
        self.data = []
    
    def add(self, reading):
        self.data.append(reading)
        return len(self.data)
    
    def get_by_id(self, sensor_id):
        return [r for r in self.data if r['sensor_id'] == sensor_id]
    
    def get_all(self):
        return self.data.copy()

# Test repository
repo = MemoryRepository()
repo.add({'sensor_id': 'T1', 'value': 25.5})
repo.add({'sensor_id': 'T1', 'value': 26.0})
repo.add({'sensor_id': 'T2', 'value': 22.1})

print(f"All readings: {len(repo.get_all())}")
print(f"T1 readings: {repo.get_by_id('T1')}")</textarea>
                    <div class="code-output" id="outputcode27">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Observer Pattern for Data Streams</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 9.2: Observer Pattern</span>
                        <button class="code-figure-run" onclick="runCode('code28')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code28">class DataSubject:
    """Observable data source."""
    
    def __init__(self):
        self._observers = []
    
    def subscribe(self, observer):
        self._observers.append(observer)
    
    def unsubscribe(self, observer):
        self._observers.remove(observer)
    
    def notify(self, data):
        for observer in self._observers:
            observer(data)

class SensorMonitor:
    """Sensor data monitor with observers."""
    
    def __init__(self, sensor_id):
        self.sensor_id = sensor_id
        self.subject = DataSubject()
        self.latest_value = None
    
    def on_reading(self, callback):
        self.subject.subscribe(callback)
    
    def record(self, value):
        self.latest_value = value
        self.subject.notify({
            'sensor_id': self.sensor_id,
            'value': value
        })

# Set up monitoring
monitor = SensorMonitor('TEMP_001')

# Add observers
def log_reading(data):
    print(f"LOG: {data['sensor_id']} = {data['value']}")

def check_alert(data):
    if data['value'] > 30:
        print(f"‚ö†Ô∏è ALERT: High temperature!")

monitor.on_reading(log_reading)
monitor.on_reading(check_alert)

# Record some values
for val in [25.5, 28.0, 32.0, 24.0]:
    print(f"Recording: {val}")
    monitor.record(val)
    print()</textarea>
                    <div class="code-output" id="outputcode28">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Data Transform Chain</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 9.3: Transform Chain Pattern</span>
                        <button class="code-figure-run" onclick="runCode('code29')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code29">class Transform:
    """Base transform class."""
    
    def __init__(self, next_transform=None):
        self.next = next_transform
    
    def process(self, data):
        result = self.transform(data)
        if self.next and result is not None:
            return self.next.process(result)
        return result
    
    def transform(self, data):
        return data

class NormalizeTransform(Transform):
    """Normalize sensor ID to uppercase."""
    def transform(self, data):
        data['sensor_id'] = data.get('sensor_id', '').upper()
        return data

class ValidateTransform(Transform):
    """Validate data, return None if invalid."""
    def transform(self, data):
        if not data.get('sensor_id'):
            return None
        if not isinstance(data.get('value'), (int, float)):
            return None
        return data

class EnrichTransform(Transform):
    """Add computed fields."""
    def transform(self, data):
        data['processed'] = True
        data['status'] = 'valid'
        return data

# Build transform chain
chain = NormalizeTransform(
    ValidateTransform(
        EnrichTransform()
    )
)

# Process data
test_data = [
    {'sensor_id': 'temp_001', 'value': 25.5},
    {'sensor_id': '', 'value': 25.5},
    {'sensor_id': 'temp_002', 'value': 'invalid'},
]

print("Transform Chain Results:")
for data in test_data:
    result = chain.process(data.copy())
    print(f"  Input: {data}")
    print(f"  Output: {result}")
    print()</textarea>
                    <div class="code-output" id="outputcode29">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Data Aggregator</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 9.4: Rolling Aggregator</span>
                        <button class="code-figure-run" onclick="runCode('code30')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code30">from collections import deque

class RollingAggregator:
    """Calculate rolling statistics over a window."""
    
    def __init__(self, window_size=10):
        self.window_size = window_size
        self.values = deque(maxlen=window_size)
    
    def add(self, value):
        self.values.append(value)
    
    @property
    def count(self):
        return len(self.values)
    
    @property
    def mean(self):
        if not self.values:
            return 0
        return sum(self.values) / len(self.values)
    
    @property
    def min(self):
        return min(self.values) if self.values else 0
    
    @property
    def max(self):
        return max(self.values) if self.values else 0
    
    def stats(self):
        return {
            'count': self.count,
            'mean': round(self.mean, 2),
            'min': self.min,
            'max': self.max
        }

# Test rolling aggregator
agg = RollingAggregator(window_size=5)

readings = [25.0, 25.5, 26.0, 25.8, 26.2, 27.0, 26.5, 26.0]

print("Rolling Statistics (window=5):")
for i, value in enumerate(readings):
    agg.add(value)
    print(f"  After {value}: {agg.stats()}")</textarea>
                    <div class="code-output" id="outputcode30">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Batch Processor</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 9.5: Batch Processing Pattern</span>
                        <button class="code-figure-run" onclick="runCode('code31')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code31">class BatchProcessor:
    """Process data in batches for efficiency."""
    
    def __init__(self, batch_size=5, process_func=None):
        self.batch_size = batch_size
        self.process_func = process_func or self._default_process
        self.buffer = []
        self.results = []
        self.batches_processed = 0
    
    def _default_process(self, batch):
        return batch
    
    def add(self, item):
        self.buffer.append(item)
        if len(self.buffer) >= self.batch_size:
            self._process_batch()
    
    def _process_batch(self):
        if self.buffer:
            result = self.process_func(self.buffer)
            self.results.extend(result if isinstance(result, list) else [result])
            self.batches_processed += 1
            print(f"  Processed batch {self.batches_processed}: {len(self.buffer)} items")
            self.buffer = []
    
    def flush(self):
        self._process_batch()
    
    def get_results(self):
        return self.results

# Process function that calculates batch statistics
def calculate_batch_stats(batch):
    values = [item['value'] for item in batch]
    return [{
        'batch_avg': sum(values) / len(values),
        'batch_count': len(values),
        'batch_sensors': list(set(item['sensor_id'] for item in batch))
    }]

# Test batch processor
processor = BatchProcessor(batch_size=3, process_func=calculate_batch_stats)

print("Adding readings to batch processor:")
readings = [
    {'sensor_id': 'T1', 'value': 25.0},
    {'sensor_id': 'T1', 'value': 25.5},
    {'sensor_id': 'T2', 'value': 26.0},
    {'sensor_id': 'T1', 'value': 25.2},
    {'sensor_id': 'T2', 'value': 26.5},
]

for r in readings:
    processor.add(r)

processor.flush()

print(f"\nResults: {processor.get_results()}")</textarea>
                    <div class="code-output" id="outputcode31">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Data Quality Monitor</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 9.6: Data Quality Monitoring</span>
                        <button class="code-figure-run" onclick="runCode('code32')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code32">class DataQualityMonitor:
    """Monitor data quality metrics."""
    
    def __init__(self):
        self.metrics = {
            'total': 0,
            'valid': 0,
            'invalid': 0,
            'missing_fields': 0,
            'out_of_range': 0,
            'type_errors': 0
        }
        self.issues = []
    
    def check(self, record, schema):
        """Check record against schema."""
        self.metrics['total'] += 1
        issues = []
        
        for field, rules in schema.items():
            # Check required
            if rules.get('required') and field not in record:
                issues.append(f"Missing: {field}")
                self.metrics['missing_fields'] += 1
                continue
            
            if field not in record:
                continue
            
            value = record[field]
            
            # Check type
            if 'type' in rules and not isinstance(value, rules['type']):
                issues.append(f"Type error: {field}")
                self.metrics['type_errors'] += 1
            
            # Check range
            if isinstance(value, (int, float)):
                if 'min' in rules and value < rules['min']:
                    issues.append(f"Below min: {field}")
                    self.metrics['out_of_range'] += 1
                if 'max' in rules and value > rules['max']:
                    issues.append(f"Above max: {field}")
                    self.metrics['out_of_range'] += 1
        
        if issues:
            self.metrics['invalid'] += 1
            self.issues.append({'record': record, 'issues': issues})
        else:
            self.metrics['valid'] += 1
        
        return len(issues) == 0
    
    def report(self):
        valid_pct = (self.metrics['valid'] / self.metrics['total'] * 100) if self.metrics['total'] > 0 else 0
        return {
            **self.metrics,
            'valid_pct': round(valid_pct, 1)
        }

# Test quality monitor
schema = {
    'sensor_id': {'required': True, 'type': str},
    'value': {'required': True, 'type': (int, float), 'min': -50, 'max': 150}
}

monitor = DataQualityMonitor()

test_records = [
    {'sensor_id': 'T1', 'value': 25.5},
    {'sensor_id': 'T2', 'value': 200},
    {'value': 25.5},
    {'sensor_id': 'T3', 'value': 'invalid'},
    {'sensor_id': 'T4', 'value': 30.0},
]

print("Checking data quality:")
for record in test_records:
    valid = monitor.check(record, schema)
    status = "‚úì" if valid else "‚úó"
    print(f"  {status} {record}")

print(f"\nQuality Report: {monitor.report()}")</textarea>
                    <div class="code-output" id="outputcode32">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>
            </section>

            <!-- Section 10: Data Integration Patterns -->
            <section id="part10" class="section">
                <div class="section-header">
                    <div class="section-number">10</div>
                    <h2>Data Integration Patterns</h2>
                </div>
                <p>Patterns for integrating data from multiple sources and formats in engineering systems.</p>

                <h3>Data Adapter Pattern</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 10.1: Data Adapter</span>
                        <button class="code-figure-run" onclick="runCode('code33')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code33">from abc import ABC, abstractmethod

class DataAdapter(ABC):
    """Abstract adapter for different data sources."""
    
    @abstractmethod
    def read(self):
        pass
    
    @abstractmethod
    def to_standard_format(self, data):
        pass

class CSVAdapter(DataAdapter):
    """Adapter for CSV data."""
    
    def __init__(self, csv_data):
        self.csv_data = csv_data
    
    def read(self):
        import csv
        from io import StringIO
        reader = csv.DictReader(StringIO(self.csv_data))
        return list(reader)
    
    def to_standard_format(self, data):
        return [{
            'sensor_id': row.get('id', row.get('sensor_id', '')),
            'value': float(row.get('value', row.get('reading', 0))),
            'source': 'csv'
        } for row in data]

class JSONAdapter(DataAdapter):
    """Adapter for JSON data."""
    
    def __init__(self, json_data):
        self.json_data = json_data
    
    def read(self):
        import json
        return json.loads(self.json_data)
    
    def to_standard_format(self, data):
        return [{
            'sensor_id': item.get('sensor_id', item.get('name', '')),
            'value': float(item.get('value', item.get('reading', 0))),
            'source': 'json'
        } for item in data]

# Test adapters
csv_data = """id,value
T1,25.5
T2,26.0"""

json_data = '[{"sensor_id": "T3", "value": 27.0}, {"name": "T4", "reading": 28.0}]'

csv_adapter = CSVAdapter(csv_data)
json_adapter = JSONAdapter(json_data)

# Process both sources
all_data = []
for adapter in [csv_adapter, json_adapter]:
    raw = adapter.read()
    normalized = adapter.to_standard_format(raw)
    all_data.extend(normalized)

print("Integrated data from multiple sources:")
for item in all_data:
    print(f"  {item}")</textarea>
                    <div class="code-output" id="outputcode33">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Data Merger</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 10.2: Merging Data Sources</span>
                        <button class="code-figure-run" onclick="runCode('code34')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code34">class DataMerger:
    """Merge data from multiple sources by key."""
    
    def __init__(self, key_field='sensor_id'):
        self.key_field = key_field
    
    def merge(self, *sources):
        """Merge multiple data sources."""
        merged = {}
        
        for source in sources:
            for record in source:
                key = record.get(self.key_field)
                if key not in merged:
                    merged[key] = {}
                merged[key].update(record)
        
        return list(merged.values())

# Data from different sources
readings_source = [
    {'sensor_id': 'T1', 'value': 25.5, 'timestamp': '10:00'},
    {'sensor_id': 'T2', 'value': 26.0, 'timestamp': '10:00'},
]

metadata_source = [
    {'sensor_id': 'T1', 'location': 'Room A', 'unit': 'celsius'},
    {'sensor_id': 'T2', 'location': 'Room B', 'unit': 'celsius'},
]

calibration_source = [
    {'sensor_id': 'T1', 'offset': 0.1, 'last_calibration': '2025-01-01'},
    {'sensor_id': 'T2', 'offset': -0.2, 'last_calibration': '2025-01-01'},
]

# Merge all sources
merger = DataMerger()
combined = merger.merge(readings_source, metadata_source, calibration_source)

print("Merged sensor data:")
for record in combined:
    print(f"  {record['sensor_id']}:")
    print(f"    Value: {record['value']} {record['unit']}")
    print(f"    Location: {record['location']}")
    print(f"    Offset: {record['offset']}")</textarea>
                    <div class="code-output" id="outputcode34">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>

                <h3>Data Export Manager</h3>
                <div class="code-figure">
                    <div class="code-figure-header">
                        <span class="code-figure-label">Figure 10.3: Multi-Format Export</span>
                        <button class="code-figure-run" onclick="runCode('code35')">‚ñ∂ Run</button>
                    </div>
                    <textarea class="code-editor" id="code35">import json
import csv
from io import StringIO

class DataExporter:
    """Export data to multiple formats."""
    
    def __init__(self, data):
        self.data = data
    
    def to_json(self, indent=2):
        return json.dumps(self.data, indent=indent)
    
    def to_csv(self):
        if not self.data:
            return ""
        output = StringIO()
        writer = csv.DictWriter(output, fieldnames=self.data[0].keys())
        writer.writeheader()
        writer.writerows(self.data)
        return output.getvalue()
    
    def to_xml(self, root_tag='data', item_tag='record'):
        lines = [f'<{root_tag}>']
        for item in self.data:
            lines.append(f'  <{item_tag}>')
            for key, value in item.items():
                lines.append(f'    <{key}>{value}</{key}>')
            lines.append(f'  </{item_tag}>')
        lines.append(f'</{root_tag}>')
        return '\n'.join(lines)

# Test exporter
data = [
    {'sensor_id': 'T1', 'value': 25.5, 'unit': 'celsius'},
    {'sensor_id': 'T2', 'value': 26.0, 'unit': 'celsius'},
]

exporter = DataExporter(data)

print("=== JSON Export ===")
print(exporter.to_json())

print("\n=== CSV Export ===")
print(exporter.to_csv())

print("=== XML Export ===")
print(exporter.to_xml('sensors', 'sensor'))</textarea>
                    <div class="code-output" id="outputcode35">
                        <div class="code-output-label">Output</div>
                        <div class="code-output-content"></div>
                    </div>
                </div>
            </section>
            <!-- Bonus Exercises -->
            <section id="bonus" class="section">
                <div class="section-header">
                    <div class="section-number">üìö</div>
                    <h2>Bonus Exercises</h2>
                </div>

                <!-- Bonus 1 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">B1</span>Retry Decorator</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a decorator that retries a function up to N times on failure.</p></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('exB1')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exB1">import functools

def retry(max_attempts=3):
    def decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            last_error = None
            for attempt in range(max_attempts):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    last_error = e
                    print(f"Attempt {attempt + 1} failed: {e}")
            raise last_error
        return wrapper
    return decorator

# Test
counter = 0

@retry(max_attempts=3)
def unreliable_function():
    global counter
    counter += 1
    if counter < 3:
        raise ConnectionError("Temporary failure")
    return "Success!"

try:
    result = unreliable_function()
    print(f"Result: {result}")
except Exception as e:
    print(f"All attempts failed: {e}")</textarea>
                            <div class="code-output" id="outputexB1">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Bonus 2 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">B2</span>Data Cache</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Implement a cache that stores data with TTL (time-to-live).</p></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('exB2')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exB2">import time

class TTLCache:
    def __init__(self, ttl_seconds=60):
        self.ttl = ttl_seconds
        self.cache = {}
    
    def set(self, key, value):
        self.cache[key] = {
            'value': value,
            'expires': time.time() + self.ttl
        }
    
    def get(self, key, default=None):
        if key not in self.cache:
            return default
        entry = self.cache[key]
        if time.time() > entry['expires']:
            del self.cache[key]
            return default
        return entry['value']
    
    def clear_expired(self):
        now = time.time()
        expired = [k for k, v in self.cache.items() if now > v['expires']]
        for k in expired:
            del self.cache[k]
        return len(expired)

# Test
cache = TTLCache(ttl_seconds=2)
cache.set('sensor_1', 25.5)
cache.set('sensor_2', 26.0)

print(f"sensor_1: {cache.get('sensor_1')}")
print(f"sensor_2: {cache.get('sensor_2')}")
print(f"sensor_3: {cache.get('sensor_3', 'not found')}")</textarea>
                            <div class="code-output" id="outputexB2">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Bonus 3 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">B3</span>Data Stream</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a DataStream class that simulates real-time sensor data with callbacks.</p></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('exB3')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exB3">import random
import time

class DataStream:
    def __init__(self, sensor_id):
        self.sensor_id = sensor_id
        self.callbacks = []
        self.running = False
    
    def subscribe(self, callback):
        self.callbacks.append(callback)
    
    def emit(self, value):
        for callback in self.callbacks:
            callback(self.sensor_id, value)
    
    def generate(self, count=5):
        """Generate simulated readings."""
        base_value = 25.0
        for i in range(count):
            value = base_value + random.uniform(-2, 2)
            self.emit(round(value, 2))

# Test
def on_reading(sensor_id, value):
    print(f"Received: {sensor_id} = {value}")

def on_alert(sensor_id, value):
    if value > 26:
        print(f"  ‚ö†Ô∏è High temperature alert!")

stream = DataStream('TEMP_001')
stream.subscribe(on_reading)
stream.subscribe(on_alert)

print("Generating stream data:")
stream.generate(5)</textarea>
                            <div class="code-output" id="outputexB3">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Bonus 4 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">B4</span>Event Logger</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create an EventLogger that records events with timestamps and supports filtering.</p></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('exB4')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exB4">import time

class EventLogger:
    """Event logging system."""
    
    def __init__(self):
        self.events = []
    
    def log(self, event_type, message, **data):
        self.events.append({
            'timestamp': time.time(),
            'type': event_type,
            'message': message,
            **data
        })
    
    def get_by_type(self, event_type):
        return [e for e in self.events if e['type'] == event_type]
    
    def get_recent(self, count=10):
        return self.events[-count:]
    
    def count_by_type(self):
        counts = {}
        for e in self.events:
            counts[e['type']] = counts.get(e['type'], 0) + 1
        return counts

# Test
logger = EventLogger()
logger.log('INFO', 'System started')
logger.log('DATA', 'Reading received', sensor_id='T1', value=25.5)
logger.log('WARNING', 'High temperature', sensor_id='T2', value=35.0)
logger.log('DATA', 'Reading received', sensor_id='T1', value=26.0)
logger.log('ERROR', 'Connection lost', device='gateway')

print(f"Total events: {len(logger.events)}")
print(f"Event counts: {logger.count_by_type()}")
print(f"DATA events: {len(logger.get_by_type('DATA'))}")</textarea>
                            <div class="code-output" id="outputexB4">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Bonus 5 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">B5</span>Config Validator</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a configuration validator that checks JSON configs against a schema.</p></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('exB5')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exB5">import json

class ConfigValidator:
    """Validate configuration against schema."""
    
    def __init__(self, schema):
        self.schema = schema
    
    def validate(self, config):
        errors = []
        self._check(config, self.schema, '', errors)
        return len(errors) == 0, errors
    
    def _check(self, value, schema, path, errors):
        # Check type
        expected_type = schema.get('type')
        if expected_type == 'object' and not isinstance(value, dict):
            errors.append(f"{path}: expected object")
            return
        if expected_type == 'string' and not isinstance(value, str):
            errors.append(f"{path}: expected string")
        if expected_type == 'number' and not isinstance(value, (int, float)):
            errors.append(f"{path}: expected number")
        
        # Check nested properties
        if 'properties' in schema and isinstance(value, dict):
            for key, prop_schema in schema['properties'].items():
                if key in value:
                    self._check(value[key], prop_schema, f"{path}.{key}", errors)
                elif prop_schema.get('required'):
                    errors.append(f"{path}.{key}: required")

# Test
schema = {
    'type': 'object',
    'properties': {
        'name': {'type': 'string', 'required': True},
        'port': {'type': 'number', 'required': True},
        'debug': {'type': 'boolean'}
    }
}

validator = ConfigValidator(schema)

configs = [
    {'name': 'sensor_api', 'port': 8080},
    {'name': 123, 'port': 8080},
    {'port': 8080},
]

for config in configs:
    valid, errors = validator.validate(config)
    print(f"{config}: {'‚úì' if valid else '‚úó ' + str(errors)}")</textarea>
                            <div class="code-output" id="outputexB5">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Bonus 6 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">B6</span>Data Buffer</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Implement a circular buffer for sensor data with overflow handling.</p></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('exB6')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exB6">class CircularBuffer:
    """Fixed-size circular buffer."""
    
    def __init__(self, capacity):
        self.capacity = capacity
        self.buffer = [None] * capacity
        self.head = 0
        self.count = 0
    
    def push(self, item):
        self.buffer[self.head] = item
        self.head = (self.head + 1) % self.capacity
        if self.count < self.capacity:
            self.count += 1
    
    def get_all(self):
        if self.count < self.capacity:
            return self.buffer[:self.count]
        # Return in order from oldest to newest
        start = self.head
        return self.buffer[start:] + self.buffer[:start]
    
    def is_full(self):
        return self.count == self.capacity

# Test
buffer = CircularBuffer(5)

for i in range(8):
    buffer.push(f"Reading_{i}")
    print(f"After push {i}: {buffer.get_all()}")

print(f"\nBuffer full: {buffer.is_full()}")</textarea>
                            <div class="code-output" id="outputexB6">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Bonus 7 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">B7</span>Data Compressor</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a simple run-length encoding compressor for repeated sensor values.</p></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('exB7')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exB7">class RLECompressor:
    """Run-length encoding for data compression."""
    
    def compress(self, data):
        if not data:
            return []
        
        compressed = []
        current = data[0]
        count = 1
        
        for item in data[1:]:
            if item == current:
                count += 1
            else:
                compressed.append((current, count))
                current = item
                count = 1
        
        compressed.append((current, count))
        return compressed
    
    def decompress(self, compressed):
        result = []
        for value, count in compressed:
            result.extend([value] * count)
        return result

# Test
compressor = RLECompressor()

# Sensor data with repeated values
data = [25, 25, 25, 26, 26, 27, 27, 27, 27, 25]

compressed = compressor.compress(data)
decompressed = compressor.decompress(compressed)

print(f"Original: {data}")
print(f"Compressed: {compressed}")
print(f"Decompressed: {decompressed}")
print(f"Size reduction: {len(data)} -> {len(compressed)} tuples")</textarea>
                            <div class="code-output" id="outputexB7">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Bonus 8 -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title"><span class="exercise-number">B8</span>Query Builder</div>
                        <span class="difficulty hard">Challenge</span>
                    </div>
                    <div class="exercise-body"><div class="exercise-info-panel"><p class="exercise-description">Create a fluent query builder for filtering sensor data.</p></div><div class="exercise-code-panel"><div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Your Solution</span>
                                <button class="code-figure-run" onclick="runCode('exB8')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exB8">class QueryBuilder:
    """Fluent query builder for data filtering."""
    
    def __init__(self, data):
        self.data = data
        self.filters = []
    
    def where(self, field, op, value):
        def make_filter(f, o, v):
            if o == '==':
                return lambda r: r.get(f) == v
            elif o == '!=':
                return lambda r: r.get(f) != v
            elif o == '>':
                return lambda r: r.get(f, 0) > v
            elif o == '<':
                return lambda r: r.get(f, 0) < v
            elif o == 'in':
                return lambda r: r.get(f) in v
            return lambda r: True
        
        self.filters.append(make_filter(field, op, value))
        return self
    
    def execute(self):
        result = self.data
        for f in self.filters:
            result = [r for r in result if f(r)]
        return result
    
    def first(self):
        results = self.execute()
        return results[0] if results else None

# Test
data = [
    {'sensor_id': 'T1', 'value': 25.5, 'location': 'A'},
    {'sensor_id': 'T2', 'value': 35.0, 'location': 'A'},
    {'sensor_id': 'T3', 'value': 22.0, 'location': 'B'},
    {'sensor_id': 'T4', 'value': 28.0, 'location': 'A'},
]

# Query with method chaining
results = (QueryBuilder(data)
    .where('location', '==', 'A')
    .where('value', '>', 26)
    .execute())

print("Sensors in location A with value > 26:")
for r in results:
    print(f"  {r}")</textarea>
                            <div class="code-output" id="outputexB8">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div></div></div>
                </div>

                <!-- Bridge Exercise ‚Üí Week 14 -->
                <div class="exercise-card" style="border: 2px solid rgba(217, 119, 6, 0.35); background: linear-gradient(135deg, rgba(217,119,6,0.04), transparent);">
                    <div class="exercise-header" style="background: linear-gradient(135deg, rgba(217,119,6,0.12), rgba(217,119,6,0.04));">
                        <div class="exercise-title"><span class="exercise-number" style="background: linear-gradient(135deg, #d97706, #f59e0b);">üåâ</span>Bridge Exercise: Sneak Peek at Week 14</div>
                        <span class="difficulty medium">Preview</span>
                    </div>
                    <div class="exercise-body">
                        <div class="exercise-info-panel">
                            <p class="exercise-description"><strong>Next week: Final Project!</strong> You've learned every piece of the puzzle ‚Äî variables, loops, functions, files, error handling, OOP, inheritance, modules, and data formats. Now it's time to combine them ALL into one cohesive engineering project.</p>
                            <div class="expected-output">
                                <div class="expected-output-label">‚úì What You've Built</div>
                                <pre>Week  1-4:  Python fundamentals (variables, control flow, functions)
Week  5-7:  Data structures (lists, dicts, strings)
Week  8:    File I/O ‚Äî read/write data
Week  9:    Error handling ‚Äî survive bad data
Week 10:    OOP ‚Äî organize with classes
Week 11:    Inheritance ‚Äî specialize with subclasses
Week 12:    Modules ‚Äî structure into packages
Week 13:    External data ‚Äî JSON configs, CSV reports

Week 14:    üéØ FINAL PROJECT ‚Äî combine everything!</pre>
                            </div>
                            <div class="hints-container">
                                <button class="hints-toggle" onclick="toggleHints('hintsBridge')">üí° Show Hints</button>
                                <div class="hints-content" id="hintsBridge">
                                    <ul>
                                        <li>Your final project should demonstrate skills from at least 5 different weeks</li>
                                        <li>Think about a real-world engineering problem you'd like to solve</li>
                                        <li>The Sensor Data Logger case study is a great template for structuring your project</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="exercise-code-panel">
                        <div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Bridge Exercise ‚Äî Preview of Week 14: Final Project Planning</span>
                                <button class="code-figure-run" onclick="runCode('exBridge')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="exBridge"># Bridge Exercise: Final Project Planning
# Review everything you've learned!

skills = {
    "Weeks 1-4": ["Variables", "Conditionals", "Loops", "Functions"],
    "Weeks 5-7": ["Lists/Tuples", "Dictionaries/Sets", "String Methods"],
    "Week 8":    ["File I/O", "CSV/JSON reading", "Report generation"],
    "Week 9":    ["try/except", "Custom exceptions", "Validation"],
    "Week 10":   ["Classes", "Properties", "Composition"],
    "Week 11":   ["Inheritance", "Polymorphism", "ABC"],
    "Week 12":   ["Modules", "Packages", "Virtual environments"],
    "Week 13":   ["JSON configs", "CSV export", "Data pipelines"],
}

print("üéì YOUR PYTHON SKILL TREE\n")
total = 0
for week, topics in skills.items():
    total += len(topics)
    print(f"  {week}: {', '.join(topics)}")

print(f"\n  Total skills mastered: {total} üèÜ")
print(f"\n{'='*50}")
print("  üéØ FINAL PROJECT IDEAS:")
print("="*50)

ideas = [
    "üå°Ô∏è Weather Station Monitor ‚Äî read sensors, log data, generate alerts",
    "üè≠ Factory Production Tracker ‚Äî CSV input, OOP models, PDF reports",
    "üìä Student Grade Manager ‚Äî JSON config, data validation, statistics",
    "ü§ñ Robot Arm Controller ‚Äî command parsing, state machine, error handling",
    "‚ö° Energy Usage Analyzer ‚Äî CSV data, time analysis, trend detection",
]

for i, idea in enumerate(ideas, 1):
    print(f"  {i}. {idea}")

print(f"\nüí° Pick a project that excites you!")
print("   Next week: build it from scratch!")
</textarea>
                            <div class="code-output" id="outputexBridge">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>

                <div class="tip-box info-box">
                    <p>You've mastered every building block of Python programming! Next week's <strong>final project</strong> is your chance to combine everything into one impressive engineering application. Start thinking about what you'd like to build!</p>
                </div>
            </section>

            <!-- Case Study Part 6: Sensor Data Logger ‚Äî Complete System -->
            <section id="casestudy" class="section" style="scroll-margin-top: 70px;">
                <div class="section-header">
                    <div class="section-number" style="background: linear-gradient(135deg, #7c3aed, #a78bfa);">üî¨</div>
                    <h2>Case Study: Sensor Data Logger (Part 6 of 6 ‚Äî Final!)</h2>
                </div>
                <p>The grand finale! We combine <strong>all previous parts</strong> into a production-ready system: JSON configuration, CSV data ingestion, validated processing through our OOP hierarchy, and formatted report output.</p>

                <div class="case-study-box">
                    <div class="case-study-header">üî¨ Part 6 ‚Äî Complete System: JSON Config ‚Üí CSV Data ‚Üí Report</div>
                    <div class="case-study-body">
                        <p><strong>Goal:</strong> Build the complete end-to-end pipeline: load sensor configuration from JSON, read measurement data from CSV, process through validated sensor classes, and generate a comprehensive report.</p>
                        <p><strong>What's new:</strong> JSON config loading, CSV data parsing with <code>csv.DictReader</code>, complete integration of all 13 weeks of concepts.</p>
                        
                        <div class="code-figure">
                            <div class="code-figure-header">
                                <span class="code-figure-label">Case Study 6 ‚Äî Sensor Data Logger: Complete System</span>
                                <button class="code-figure-run" onclick="runCode('cs6')">‚ñ∂ Run</button>
                            </div>
                            <textarea class="code-editor" id="cs6"># === CASE STUDY Part 6: Complete Sensor Data Logger ===
# Integrating ALL concepts from Weeks 8-13!
import json
import csv
from io import StringIO
from abc import ABC, abstractmethod

# --- exceptions.py (Week 9) ---
class SensorError(Exception):
    pass
class InvalidReadingError(SensorError):
    def __init__(self, sid, val, rng):
        super().__init__(f"{sid}: {val} outside {rng}")

# --- base.py (Week 10) ---
class Sensor(ABC):
    def __init__(self, sensor_id, unit, valid_range):
        self.sensor_id = sensor_id
        self.unit = unit
        self.valid_range = valid_range
        self._readings = []
    
    @property
    @abstractmethod
    def sensor_type(self): pass
    
    def validate(self, value):
        lo, hi = self.valid_range
        if not (lo <= value <= hi):
            raise InvalidReadingError(self.sensor_id, value, self.valid_range)
    
    def add_reading(self, ts, value):
        self.validate(value)
        self._readings.append((ts, value))
    
    def get_stats(self):
        if not self._readings:
            return {"count": 0}
        vals = [v for _, v in self._readings]
        return {"min": min(vals), "max": max(vals),
                "avg": sum(vals)/len(vals), "count": len(vals)}
    
    def __str__(self):
        return f"{self.sensor_type}({self.sensor_id})"

# --- sensors.py (Week 11) ---
class TemperatureSensor(Sensor):
    def __init__(self, sid):
        super().__init__(sid, "¬∞C", (-40, 80))
    @property
    def sensor_type(self): return "Temperature"

class HumiditySensor(Sensor):
    def __init__(self, sid):
        super().__init__(sid, "%", (0, 100))
    @property
    def sensor_type(self): return "Humidity"

class PressureSensor(Sensor):
    def __init__(self, sid):
        super().__init__(sid, "hPa", (300, 1100))
    @property
    def sensor_type(self): return "Pressure"

# --- utils.py (Week 12) ---
SENSOR_MAP = {"temperature": TemperatureSensor,
              "humidity": HumiditySensor,
              "pressure": PressureSensor}

def create_sensor(cfg):
    cls = SENSOR_MAP.get(cfg["type"].lower())
    if not cls:
        raise SensorError(f"Unknown type: {cfg['type']}")
    return cls(cfg["id"])

# === STEP 1: Load JSON Config (Week 13 NEW!) ===
config_json = '''{
    "project": "Lab Station Alpha",
    "version": "2.0",
    "sensors": [
        {"id": "T01", "type": "temperature", "location": "Room A"},
        {"id": "T02", "type": "temperature", "location": "Room B"},
        {"id": "H01", "type": "humidity", "location": "Room A"},
        {"id": "P01", "type": "pressure", "location": "Roof"}
    ],
    "alert_thresholds": {
        "temperature": {"warn": 30, "critical": 40},
        "humidity": {"warn": 70, "critical": 90}
    }
}'''

config = json.loads(config_json)
print(f"üìã Loaded config: {config['project']} v{config['version']}")

# Create sensors from config
sensors = {}
for cfg in config["sensors"]:
    s = create_sensor(cfg)
    sensors[s.sensor_id] = s
    print(f"  üì° {s} @ {cfg['location']}")

# === STEP 2: Read CSV Data (Week 13 NEW!) ===
csv_data = """timestamp,sensor_id,value
2024-03-15 08:00,T01,22.5
2024-03-15 08:00,T02,24.1
2024-03-15 08:00,H01,45.2
2024-03-15 08:00,P01,1013.2
2024-03-15 08:05,T01,23.1
2024-03-15 08:05,T02,N/A
2024-03-15 08:05,H01,46.8
2024-03-15 08:05,P01,1013.0
2024-03-15 08:10,T01,22.8
2024-03-15 08:10,T02,35.2
2024-03-15 08:10,H01,110.5
2024-03-15 08:10,P01,1012.8"""

# === STEP 3: Process with Error Handling (Week 9) ===
print(f"\nüìù Processing CSV data...\n")
errors = []
reader = csv.DictReader(StringIO(csv_data))
for row in reader:
    sid = row["sensor_id"]
    ts = row["timestamp"]
    val_str = row["value"]
    try:
        sensor = sensors[sid]
        sensor.add_reading(ts, float(val_str))
        print(f"  ‚úÖ {sid} @ {ts}: {val_str}")
    except KeyError:
        errors.append(f"Unknown sensor: {sid}")
    except ValueError:
        errors.append(f"{sid} @ {ts}: invalid value '{val_str}'")
        print(f"  ‚ö†Ô∏è {sid} @ {ts}: SKIP ‚Äî invalid '{val_str}'")
    except InvalidReadingError as e:
        errors.append(str(e))
        print(f"  ‚ö†Ô∏è {sid} @ {ts}: SKIP ‚Äî {e}")

# === STEP 4: Generate Report ===
thresholds = config.get("alert_thresholds", {})
print(f"\n{'='*55}")
print(f"  üìä {config['project']} ‚Äî SENSOR REPORT")
print(f"{'='*55}")

for sid, sensor in sensors.items():
    stats = sensor.get_stats()
    loc = next((c["location"] for c in config["sensors"]
                if c["id"] == sid), "?")
    print(f"\n  [{sid}] {sensor.sensor_type} @ {loc}")
    if stats["count"] > 0:
        print(f"    Range: {stats['min']:.1f} ‚Äì {stats['max']:.1f} {sensor.unit}")
        print(f"    Average: {stats['avg']:.2f} {sensor.unit}")
        print(f"    Readings: {stats['count']}")
        # Check alerts
        t_cfg = thresholds.get(sensor.sensor_type.lower(), {})
        if t_cfg and stats["max"] >= t_cfg.get("critical", float("inf")):
            print(f"    üö® CRITICAL: max exceeds {t_cfg['critical']}")
        elif t_cfg and stats["max"] >= t_cfg.get("warn", float("inf")):
            print(f"    ‚ö†Ô∏è WARNING: max exceeds {t_cfg['warn']}")
    else:
        print(f"    No valid readings")

# === STEP 5: CSV Export ===
print(f"\n{'='*55}")
csv_output = StringIO()
writer = csv.writer(csv_output)
writer.writerow(["sensor_id", "type", "location", "min", "max",
                 "avg", "count", "unit", "status"])
for sid, sensor in sensors.items():
    stats = sensor.get_stats()
    loc = next((c["location"] for c in config["sensors"]
                if c["id"] == sid), "?")
    status = "OK"
    t_cfg = thresholds.get(sensor.sensor_type.lower(), {})
    if stats["count"] > 0:
        if t_cfg and stats["max"] >= t_cfg.get("critical", float("inf")):
            status = "CRITICAL"
        elif t_cfg and stats["max"] >= t_cfg.get("warn", float("inf")):
            status = "WARNING"
        writer.writerow([sid, sensor.sensor_type, loc,
                         f"{stats['min']:.1f}", f"{stats['max']:.1f}",
                         f"{stats['avg']:.2f}", stats["count"],
                         sensor.unit, status])

print("  üì§ CSV Export Preview:")
for line in csv_output.getvalue().strip().split("\n"):
    print(f"    {line}")

# Final summary
total = sum(s.get_stats()["count"] for s in sensors.values())
print(f"\n{'='*55}")
print(f"  ‚úÖ Processed: {total} valid readings")
print(f"  ‚ö†Ô∏è Errors: {len(errors)}")
print(f"  üìä Success rate: {total/(total+len(errors))*100:.0f}%")
print(f"{'='*55}")
print("\nüéâ CASE STUDY COMPLETE!")
print("   Weeks 8‚Üí13: File I/O ‚Üí Errors ‚Üí OOP ‚Üí Inheritance ‚Üí Modules ‚Üí Data")
print("   You've built a production-ready sensor monitoring system!")
</textarea>
                            <div class="code-output" id="outputcs6">
                                <div class="code-output-label">Output</div>
                                <div class="code-output-content"></div>
                            </div>
                        </div>
                        
                        <div class="warning-box info-box" style="margin-top: 20px;">
                            <p><strong>üéâ Case Study Complete!</strong> Over 6 weeks, you've built a full sensor monitoring system using every concept from CP2. Your <strong>final project</strong> next week should demonstrate this same level of integration ‚Äî combining multiple concepts into one cohesive application.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Submit Section -->
            <section id="submit" class="section">
                <div class="submit-section">
                    <h2>üì§ Submit Your Work</h2>
                    <p>Complete the exercises above, then fill out this form to record your attendance for Week 13.</p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Student ID</label>
                            <input type="text" id="studentId" placeholder="e.g., 2024001234" maxlength="10">
                        </div>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="studentName" placeholder="e.g., Ahmet Yƒ±lmaz">
                        </div>
                        <div class="form-group">
                            <label>Email (@istun.edu.tr)</label>
                            <input type="email" id="studentEmail" placeholder="e.g., ahmet.yilmaz@istun.edu.tr">
                        </div>
                        <div class="form-group">
                            <label>Class Code (from instructor)</label>
                            <input type="text" id="classCode" placeholder="Enter code from class">
                        </div>
                    </div>
                    <div class="honeypot">
                        <input type="text" id="website" tabindex="-1" autocomplete="off">
                    </div>
                    <button class="submit-btn" onclick="submitWork()">Submit Week 13</button>
                    <div class="submit-status" id="submitStatus"></div>
                </div>
            </section>

            <!-- Navigation -->
            <nav class="week-nav">
                <a class="nav-prev" href="Week_12.html">
                    <span class="nav-direction">‚Üê Previous</span>
                    <span class="nav-title">Week 12: Modules and Packages</span>
                </a>
                <a class="nav-next" href="Week_14.html">
                    <span class="nav-direction">Next ‚Üí</span>
                    <span class="nav-title">Week 14: Advanced Topics</span>
                </a>
            </nav>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.code-figure').forEach(figure => {
                if (figure.closest('.exercise-code-panel')) return;
                const editor = figure.querySelector('.code-editor');
                const output = figure.querySelector('.code-output');
                if (editor && output) {
                    const splitDiv = document.createElement('div');
                    splitDiv.className = 'code-split';
                    editor.parentNode.insertBefore(splitDiv, editor);
                    splitDiv.appendChild(editor);
                    splitDiv.appendChild(output);
                }
            });
        });

        function toggleHints(id) {
            const hints = document.getElementById(id);
            hints.classList.toggle('show');
            const btn = hints.previousElementSibling;
            btn.textContent = hints.classList.contains('show') ? 'üí° Hide Hints' : 'üí° Show Hints';
        }

        let pyodideReady = false;
        let pyodide = null;

        async function runCode(codeId) {
            const codeEl = document.getElementById(codeId);
            const outputEl = document.getElementById('output' + codeId);
            const code = codeEl.value;
            outputEl.classList.add('show');
            let success = true;
            const outputContent = outputEl.querySelector('.code-output-content') || outputEl;
            try {
                if (!pyodideReady) {
                    outputContent.textContent = 'Initializing Python (first run may take a moment)...';
                    pyodide = await loadPyodide();
                    pyodideReady = true;
                }
                outputContent.textContent = 'Running...';
                pyodide.runPython('import sys\nfrom io import StringIO\nsys.stdout = StringIO()');
                try { pyodide.runPython(code); }
                catch (pyErr) { outputContent.textContent = 'Error: ' + pyErr.message; if (typeof autoSizeCodeBlock === 'function') autoSizeCodeBlock(codeEl); return false; }
                const output = pyodide.runPython('sys.stdout.getvalue()');
                outputContent.textContent = output || '(no output)';
            } catch(e) { outputContent.textContent = 'Error: ' + e.message; success = false; }
            if (typeof autoSizeCodeBlock === 'function') autoSizeCodeBlock(codeEl);
            return success;
        }

        async function runAllCode() {
            const btn = document.getElementById('runAllBtn');
            btn.className = 'run-all-btn running'; btn.textContent = '‚è≥ Running...';
            const allTextareas = document.querySelectorAll('.code-split textarea[id^="code"]');
            let passed = 0, failed = 0, total = allTextareas.length;
            const failedListings = []; let firstFailedFigure = null;
            document.querySelectorAll('.code-run-status').forEach(el => el.remove());
            for (const ta of allTextareas) {
                const codeId = ta.id, figure = ta.closest('.code-figure');
                const header = figure.querySelector('.code-figure-header'), label = header.querySelector('.code-figure-label');
                const status = document.createElement('span'); status.className = 'code-run-status'; header.appendChild(status);
                try {
                    const ok = await runCode(codeId);
                    if (ok) { status.textContent = '‚úì'; status.classList.add('pass', 'visible'); passed++; }
                    else { const n = label ? label.textContent.trim() : codeId; status.textContent = '‚úó error'; status.classList.add('fail', 'visible'); failedListings.push(n); if (!firstFailedFigure) firstFailedFigure = figure; failed++; }
                } catch (e) { const n = label ? label.textContent.trim() : codeId; status.textContent = '‚úó error'; status.classList.add('fail', 'visible'); failedListings.push(n); if (!firstFailedFigure) firstFailedFigure = figure; failed++; }
            }
            if (failed === 0) { btn.className = 'run-all-btn success'; btn.textContent = `‚úì All ${passed} passed`; }
            else {
                btn.className = 'run-all-btn failure'; btn.textContent = `‚úó ${failed}/${total} failed`;
                if (firstFailedFigure) { firstFailedFigure.scrollIntoView({ behavior: 'smooth', block: 'center' }); firstFailedFigure.style.outline = '2px solid #f87171'; firstFailedFigure.style.outlineOffset = '4px'; firstFailedFigure.style.borderRadius = '8px'; setTimeout(() => { firstFailedFigure.style.outline = 'none'; }, 5000); }
                console.log('Failed listings:', failedListings);
            }
            setTimeout(() => { btn.className = 'run-all-btn'; btn.textContent = '‚ñ∂ Run All'; }, 10000);
        }

        const sections = [
            { id: 'recap',      label: 'üß† Recap Quiz: Week 12' },
            { id: 'part1',      label: 'Working with CSV Files' },
            { id: 'part2',      label: 'Working with JSON' },
            { id: 'part3',      label: 'Working with XML' },
            { id: 'part4',      label: 'Making HTTP Requests' },
            { id: 'part5',      label: 'Working with SQLite' },
            { id: 'part6',      label: 'Data Validation' },
            { id: 'part7',      label: 'Building Data Pipelines' },
            { id: 'part8',      label: 'Binary Data & Serialization' },
            { id: 'mistakes',   label: '‚ùå Common Mistakes' },
            { id: 'exercises',  label: 'Practice Exercises' },
            { id: 'part9',      label: 'Advanced Data Patterns' },
            { id: 'part10',     label: 'Data Integration Patterns' },
            { id: 'bonus',      label: 'Bonus Exercises' },
            { id: 'casestudy',  label: 'üî¨ Case Study: Part 6 (Final!)' },
            { id: 'submit',     label: 'Submit Your Work' }
        ];

        const visited = new Set(); let currentIdx = 0;
        const dropdown = document.getElementById('tocDropdown');
        sections.forEach((s, i) => {
            const a = document.createElement('a'); a.className = 'toc-item'; a.href = '#' + s.id;
            a.innerHTML = `<span class="toc-num">${i + 1}.</span> ${s.label} <span class="toc-check">‚úì</span>`;
            a.addEventListener('click', (e) => { e.preventDefault(); document.getElementById(s.id).scrollIntoView({ behavior: 'smooth' }); document.getElementById('tocCenter').classList.remove('open'); });
            dropdown.appendChild(a);
        });
        document.addEventListener('click', (e) => { const toc = document.getElementById('tocCenter'); if (!toc.contains(e.target)) toc.classList.remove('open'); });

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) { const idx = sections.findIndex(s => s.id === entry.target.id); if (idx !== -1) { currentIdx = idx; visited.add(idx); updateTOC(); } } });
        }, { rootMargin: '-20% 0px -60% 0px' });
        sections.forEach(s => { const el = document.getElementById(s.id); if (el) observer.observe(el); });

        function updateTOC() {
            document.getElementById('tocCurNum').textContent = (currentIdx + 1) + '.';
            document.getElementById('tocCurLabel').textContent = sections[currentIdx].label;
            dropdown.querySelectorAll('.toc-item').forEach((item, i) => { item.classList.toggle('active', i === currentIdx); if (visited.has(i)) item.classList.add('visited'); });
        }

        const C = 2 * Math.PI * 19;
        window.addEventListener('scroll', () => {
            const h = document.documentElement.scrollHeight - window.innerHeight;
            const pct = h > 0 ? Math.min(window.scrollY / h, 1) : 0;
            document.getElementById('topbarProgress').style.width = (pct * 100) + '%';
            const badge = document.getElementById('scrollProgress');
            badge.classList.toggle('visible', window.scrollY > 200);
            document.getElementById('scrollPct').textContent = Math.round(pct * 100) + '%';
            document.getElementById('scrollCircle').style.strokeDashoffset = C * (1 - pct);
        });

        function initAutoSize() {
            document.querySelectorAll('.code-split textarea').forEach(ta => {
                const sizer = document.createElement('div'); sizer.className = 'code-input-sizer';
                ta.parentNode.insertBefore(sizer, ta); sizer.appendChild(ta);
                const mirror = document.createElement('div'); mirror.className = 'code-input-mirror'; mirror.setAttribute('aria-hidden', 'true'); sizer.appendChild(mirror);
                function sync() { mirror.textContent = ta.value + '\n'; }
                ta.addEventListener('input', sync); sync();
            });
        }
        function autoSizeCodeBlock() {}
        if (document.fonts) { document.fonts.ready.then(initAutoSize); }
        else { window.addEventListener('load', initAutoSize); }

        var pageLoadTime = Date.now();

        // ============ ANTI-CHEAT SYSTEM ============
        // Store original/default code for each exercise
        const originalExerciseCode = {};
        // Track keystroke counts per exercise
        const keystrokeCounts = {};
        // Track if paste was attempted
        const pasteAttempts = {};
        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.code-editor[id^="ex"]').forEach(textarea => {
                const exId = textarea.id;
                
                // Store original code
                originalExerciseCode[exId] = textarea.value;
                keystrokeCounts[exId] = 0;
                pasteAttempts[exId] = 0;
                
                // Block paste
                textarea.addEventListener('paste', function(e) {
                    e.preventDefault();
                    pasteAttempts[exId]++;
                    // Show warning
                    const warning = document.createElement('div');
                    warning.textContent = '‚ö†Ô∏è Paste is disabled. Please type your code.';
                    warning.style.cssText = 'color:#f87171;font-size:12px;margin-top:5px;';
                    warning.className = 'paste-warning';
                    // Remove existing warning if any
                    const existingWarning = textarea.parentElement.querySelector('.paste-warning');
                    if (existingWarning) existingWarning.remove();
                    textarea.parentElement.appendChild(warning);
                    // Auto-remove warning after 3 seconds
                    setTimeout(() => warning.remove(), 3000);
                });
                
                // Block drag & drop
                textarea.addEventListener('drop', function(e) {
                    e.preventDefault();
                });
                
                // Count keystrokes (only actual typing keys)
                textarea.addEventListener('keydown', function(e) {
                    // Count printable characters, backspace, delete, enter, tab
                    if (e.key.length === 1 || ['Backspace', 'Delete', 'Enter', 'Tab'].includes(e.key)) {
                        keystrokeCounts[exId]++;
                    }
                });
            });
        });
        
        // Check if code was actually modified by student (with meaningful effort)
        function isCodeModified(exId, currentCode) {
            const original = originalExerciseCode[exId] || '';
            const keystrokes = keystrokeCounts[exId] || 0;
            
            // Normalize whitespace for comparison
            const normalizedOriginal = original.trim().replace(/\s+/g, ' ');
            const normalizedCurrent = currentCode.trim().replace(/\s+/g, ' ');
            
            // Must be different from original
            if (normalizedOriginal === normalizedCurrent) return false;
            
            // Must have typed at least 20 keystrokes (prevents minimal changes)
            if (keystrokes < 20) return false;
            
            // Remove comments and check if anything substantial remains
            const withoutComments = currentCode.replace(/#.*$/gm, '').replace(/"""[\s\S]*?"""/g, '').replace(/'''[\s\S]*?'''/g, '').trim();
            const originalWithoutComments = original.replace(/#.*$/gm, '').replace(/"""[\s\S]*?"""/g, '').replace(/'''[\s\S]*?'''/g, '').trim();
            
            // Must have added meaningful code (not just modified comments)
            if (withoutComments.length <= originalWithoutComments.length + 10) return false;
            
            return true;
        }
        // ============ END ANTI-CHEAT ============

        function validateStudentId(id) {

            if (id.length < 6 || id.length > 10) return false;
            if (!/^\d+$/.test(id)) return false;
            if (/^(\d)\1+$/.test(id)) return false;
            return true;
        }

        function validateName(name) {
            if (name.length < 5) return false;
            var words = name.trim().split(/\s+/);
            if (words.length < 2) return false;
            return true;
        }

        function validateEmail(email) {
            return email.endsWith('@istun.edu.tr') && email.length > 15;
        }

        async function submitWork() {
            const status = document.getElementById('submitStatus');
            status.style.display = 'none';
            
            const studentId = document.getElementById('studentId').value.trim();
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim().toLowerCase();
            const classCode = document.getElementById('classCode').value.trim().toUpperCase();
            const honeypot = document.getElementById('website').value;
            
            // Bot check
            if (honeypot) {
                status.textContent = '‚ùå Submission rejected.';
                status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                return;
            }
            
            // Time check
            const timeOnPage = Math.floor((Date.now() - pageLoadTime) / 1000);
            if (timeOnPage < 60) {
                status.textContent = '‚ùå Please spend more time reviewing the material.';
                status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                return;
            }
            
            // Required fields
            if (!studentId || !studentName || !studentEmail || !classCode) {
                status.textContent = '‚ùå All fields are required.';
                status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                return;
            }
            
            // Validate student ID
            if (!validateStudentId(studentId)) {
                status.textContent = '‚ùå Invalid Student ID (must be 6-10 digits).';
                status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                return;
            }
            
            // Validate name
            if (!validateName(studentName)) {
                status.textContent = '‚ùå Please enter your full name (first and last).';
                status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                return;
            }
            
            // Validate email
            if (!validateEmail(studentEmail)) {
                status.textContent = '‚ùå Please use your @istun.edu.tr email.';
                status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                return;
            }
            
            // Validate class code
            if (classCode.length < 4) {
                status.textContent = '‚ùå Invalid class code.';
                status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                return;
            }
            
            status.textContent = '‚è≥ Collecting answers and submitting...';
            status.style.cssText = 'display:block;background:rgba(124,58,237,0.2);color:#a78bfa';
            
            // Collect all exercise answers with anti-cheat data
            const answers = {};
            const exerciseCards = document.querySelectorAll('.exercise-card');
            exerciseCards.forEach((card, index) => {
                const exNum = index + 1;
                const titleEl = card.querySelector('.exercise-title');
                const descEl = card.querySelector('.exercise-description');
                const codeEl = card.querySelector('.code-editor[id^="ex"]');
                
                if (codeEl) {
                    const exId = codeEl.id;
                    const code = codeEl.value || '';
                    const wasModified = isCodeModified(exId, code);
                    
                    answers[exId] = {
                        title: titleEl ? titleEl.textContent.replace(/^\d+/, '').trim() : 'Exercise ' + exNum,
                        description: descEl ? descEl.textContent.trim() : '',
                        code: code,
                        modified: wasModified,
                        keystrokes: keystrokeCounts[exId] || 0,
                        pasteAttempts: pasteAttempts[exId] || 0
                    };
                }
            });

            
            // Fetch IP and location
            let ipAddress = 'Unknown';
            let location = 'Unknown';
            try {
                const ipResponse = await fetch('https://ipapi.co/json/', { timeout: 5000 });
                if (ipResponse.ok) {
                    const ipData = await ipResponse.json();
                    ipAddress = ipData.ip || 'Unknown';
                    location = (ipData.city && ipData.country_name) 
                        ? `${ipData.city}, ${ipData.country_name}` 
                        : (ipData.country_name || 'Unknown');
                }
            } catch (e) {
                console.log('Could not fetch IP info');
            }
            
            const data = {
                week: 'Week_13',
                studentId: studentId,
                studentName: studentName,
                studentEmail: studentEmail,
                classCode: classCode,
                timeOnPage: timeOnPage,
                source: 'cp2-web',
                answers: answers,
                ipAddress: ipAddress,
                location: location
            };
            
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbyf1D3HGSAX4MoIhNlAuWlGrFyyvbM5MIv7ZsLxrVDlATUihrRGEAaibvIZYlCfd8Me/exec';
            
            fetch(scriptUrl, {
                method: 'POST',
                mode: 'cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    status.textContent = '‚úÖ ' + result.message + ' Check your email for confirmation with your submitted answers.';
                    status.style.cssText = 'display:block;background:rgba(5,150,105,0.2);color:#6ee7b7';
                } else {
                    status.textContent = '‚ùå ' + result.message;
                    status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                }
            })
            .catch(error => {
                fetch(scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(data)
                })
                .then(() => {
                    status.textContent = '‚ö†Ô∏è Request sent. Check your email for confirmation.';
                    status.style.cssText = 'display:block;background:rgba(217,119,6,0.2);color:#fcd34d';
                })
                .catch(() => {
                    status.textContent = '‚ùå Connection error. Please try again.';
                    status.style.cssText = 'display:block;background:rgba(220,38,38,0.2);color:#fca5a5';
                });
            });
        }
    </script>
    <script src="course-addon.js"></script>
</body>
</html>
